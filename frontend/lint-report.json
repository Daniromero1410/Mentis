[{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\factores-riesgo\\PromediosFactoresRiesgo.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PromedioCategoria' is defined but never used.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  calcularTodosLosPromedios,\r\n  obtenerNivelRiesgoGeneral,\r\n  generarConceptoPsicologico,\r\n  type FactorRiesgo,\r\n  type PromedioCategoria\r\n} from '@/app/utils/factoresRiesgoCalculos';\r\nimport { TrendingUp, TrendingDown, Minus, FileText, Sparkles } from 'lucide-react';\r\n\r\ninterface PromediosFactoresRiesgoProps {\r\n  factoresRiesgo: Record<string, FactorRiesgo>;\r\n  categoriasConfig: Record<string, { titulo: string; items: string[] }>;\r\n  onGenerarConcepto?: (concepto: string) => void;\r\n  nombreTrabajador?: string;\r\n  diagnostico?: string;\r\n  mostrarBotonGenerar?: boolean;\r\n}\r\n\r\nexport function PromediosFactoresRiesgo({\r\n  factoresRiesgo,\r\n  categoriasConfig,\r\n  onGenerarConcepto,\r\n  nombreTrabajador = '',\r\n  diagnostico = '',\r\n  mostrarBotonGenerar = true,\r\n}: PromediosFactoresRiesgoProps) {\r\n  const promedios = calcularTodosLosPromedios(factoresRiesgo, categoriasConfig);\r\n  const riesgoGeneral = obtenerNivelRiesgoGeneral(promedios);\r\n\r\n  const getColorByNivel = (nivel: string) => {\r\n    switch (nivel.toLowerCase()) {\r\n      case 'alto':\r\n        return 'text-red-600 bg-red-50 border-red-200';\r\n      case 'medio':\r\n        return 'text-orange-600 bg-orange-50 border-orange-200';\r\n      case 'bajo':\r\n        return 'text-green-600 bg-green-50 border-green-200';\r\n      default:\r\n        return 'text-gray-600 bg-gray-50 border-gray-200';\r\n    }\r\n  };\r\n\r\n  const getIconByNivel = (nivel: string) => {\r\n    switch (nivel.toLowerCase()) {\r\n      case 'alto':\r\n        return <TrendingUp className=\"h-4 w-4\" />;\r\n      case 'medio':\r\n        return <Minus className=\"h-4 w-4\" />;\r\n      case 'bajo':\r\n        return <TrendingDown className=\"h-4 w-4\" />;\r\n      default:\r\n        return <Minus className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  const handleGenerarConcepto = () => {\r\n    const concepto = generarConceptoPsicologico(\r\n      promedios,\r\n      nombreTrabajador,\r\n      diagnostico\r\n    );\r\n    onGenerarConcepto?.(concepto);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Resumen General */}\r\n      <Card className=\"border-2 border-gray-200\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            <FileText className=\"h-5 w-5 text-indigo-500\" />\r\n            Resumen de Evaluación de Riesgos\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className={`p-4 rounded-lg border-2 ${getColorByNivel(riesgoGeneral.nivel)}`}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Nivel de Riesgo General</p>\r\n                <div className=\"flex items-center gap-2 mt-1\">\r\n                  {getIconByNivel(riesgoGeneral.nivel)}\r\n                  <span className=\"text-2xl font-bold uppercase\">\r\n                    {riesgoGeneral.nivel || 'Sin evaluar'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm text-gray-600\">Promedio General</p>\r\n                <p className=\"text-3xl font-bold\">\r\n                  {riesgoGeneral.promedio_general.toFixed(2)}<span className=\"text-lg text-gray-500\">/3.0</span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Promedios por Categoría */}\r\n      <Card className=\"border-2 border-gray-200\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-lg\">Promedios por Categoría</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-3\">\r\n            {Object.entries(promedios).map(([key, promedio]) => (\r\n              <div\r\n                key={key}\r\n                className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 border border-gray-200 hover:bg-gray-100 transition-colors\"\r\n              >\r\n                <div className=\"flex-1\">\r\n                  <p className=\"font-medium text-gray-900 text-sm\">\r\n                    {promedio.categoria}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-500 mt-0.5\">\r\n                    {promedio.items_evaluados} de {promedio.total_items} items evaluados\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"text-right\">\r\n                    <p className=\"text-lg font-bold text-gray-900\">\r\n                      {promedio.items_evaluados > 0 ? promedio.promedio_numerico.toFixed(2) : '-'}\r\n                    </p>\r\n                  </div>\r\n                  <div className={`px-3 py-1.5 rounded-lg border ${getColorByNivel(promedio.promedio_cualitativo)} min-w-[80px] text-center`}>\r\n                    <div className=\"flex items-center justify-center gap-1\">\r\n                      {getIconByNivel(promedio.promedio_cualitativo)}\r\n                      <span className=\"text-xs font-semibold uppercase\">\r\n                        {promedio.promedio_cualitativo || 'N/A'}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Categorías por Nivel de Riesgo */}\r\n      {riesgoGeneral.nivel && (\r\n        <Card className=\"border-2 border-gray-200\">\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-lg\">Categorización por Nivel de Riesgo</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {riesgoGeneral.categorias_alto_riesgo.length > 0 && (\r\n              <div>\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <TrendingUp className=\"h-4 w-4 text-red-600\" />\r\n                  <h4 className=\"font-semibold text-red-600\">Riesgo Alto ({riesgoGeneral.categorias_alto_riesgo.length})</h4>\r\n                </div>\r\n                <ul className=\"space-y-1 ml-6\">\r\n                  {riesgoGeneral.categorias_alto_riesgo.map((cat, idx) => (\r\n                    <li key={idx} className=\"text-sm text-gray-700\">• {cat}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n\r\n            {riesgoGeneral.categorias_riesgo_medio.length > 0 && (\r\n              <div>\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <Minus className=\"h-4 w-4 text-orange-600\" />\r\n                  <h4 className=\"font-semibold text-orange-600\">Riesgo Medio ({riesgoGeneral.categorias_riesgo_medio.length})</h4>\r\n                </div>\r\n                <ul className=\"space-y-1 ml-6\">\r\n                  {riesgoGeneral.categorias_riesgo_medio.map((cat, idx) => (\r\n                    <li key={idx} className=\"text-sm text-gray-700\">• {cat}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n\r\n            {riesgoGeneral.categorias_bajo_riesgo.length > 0 && (\r\n              <div>\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <TrendingDown className=\"h-4 w-4 text-green-600\" />\r\n                  <h4 className=\"font-semibold text-green-600\">Riesgo Bajo ({riesgoGeneral.categorias_bajo_riesgo.length})</h4>\r\n                </div>\r\n                <ul className=\"space-y-1 ml-6\">\r\n                  {riesgoGeneral.categorias_bajo_riesgo.map((cat, idx) => (\r\n                    <li key={idx} className=\"text-sm text-gray-700\">• {cat}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Botón de generar concepto */}\r\n      {mostrarBotonGenerar && riesgoGeneral.nivel && onGenerarConcepto && (\r\n        <div className=\"flex justify-center\">\r\n          <Button\r\n            onClick={handleGenerarConcepto}\r\n            className=\"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-500 shadow-lg shadow-indigo-500/25 gap-2\"\r\n            size=\"lg\"\r\n          >\r\n            <Sparkles className=\"h-5 w-5\" />\r\n            Generar Concepto Psicológico Automático\r\n          </Button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\guards\\ModuleGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\layout\\DashboardLayout.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\layout\\DashboardLayout.tsx:36:5\n  34 |\n  35 |   useEffect(() => {\n> 36 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  37 |   }, []);\n  38 |\n  39 |   useEffect(() => {","line":36,"column":5,"nodeType":null,"endLine":36,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { Sidebar } from './Sidebar';\r\nimport { Header } from './Header';\r\n\r\ninterface DashboardLayoutProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function DashboardLayout({ children }: DashboardLayoutProps) {\r\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n  const { isAuthenticated, isLoading } = useAuth();\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      if (window.innerWidth < 768) {\r\n        setSidebarCollapsed(true);\r\n      } else {\r\n        setSidebarCollapsed(false);\r\n      }\r\n    };\r\n\r\n    // Set initial state\r\n    handleResize();\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!isLoading && !isAuthenticated) {\r\n      router.push('/login');\r\n    }\r\n  }, [isLoading, isAuthenticated, router]);\r\n\r\n  // Inactivity Logout Logic\r\n  useEffect(() => {\r\n    if (!isAuthenticated) return;\r\n\r\n    const INACTIVITY_LIMIT = 2 * 60 * 60 * 1000; // 2 hours\r\n    let inactivityTimer: NodeJS.Timeout;\r\n\r\n    const logoutUser = () => {\r\n      console.log('Cerrando sesión por inactividad');\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      window.location.href = '/login?reason=inactivity';\r\n    };\r\n\r\n    const resetTimer = () => {\r\n      clearTimeout(inactivityTimer);\r\n      inactivityTimer = setTimeout(logoutUser, INACTIVITY_LIMIT);\r\n    };\r\n\r\n    // Events to track activity\r\n    const events = ['mousedown', 'keydown', 'scroll', 'touchstart'];\r\n    events.forEach(event => window.addEventListener(event, resetTimer));\r\n\r\n    // Initial start\r\n    resetTimer();\r\n\r\n    return () => {\r\n      clearTimeout(inactivityTimer);\r\n      events.forEach(event => window.removeEventListener(event, resetTimer));\r\n    };\r\n  }, [isAuthenticated]);\r\n\r\n  if (!mounted || isLoading) {\r\n    return (\r\n      <div className=\"flex h-screen items-center justify-center bg-[var(--background)]\">\r\n        <div className=\"flex flex-col items-center gap-4\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-16 h-16 rounded-full border-4 border-indigo-500/20\"></div>\r\n            <div className=\"absolute top-0 left-0 w-16 h-16 rounded-full border-4 border-indigo-500 border-t-transparent animate-spin\"></div>\r\n          </div>\r\n          <p className=\"text-sm text-gray-500 animate-pulse\">Cargando...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[var(--background)] transition-colors duration-300\">\r\n      <Sidebar collapsed={sidebarCollapsed} setCollapsed={setSidebarCollapsed} />\r\n\r\n      {/* Overlay for mobile when sidebar is open */}\r\n      {!sidebarCollapsed && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/50 z-30 md:hidden\"\r\n          onClick={() => setSidebarCollapsed(true)}\r\n        />\r\n      )}\r\n\r\n      <div className={`sidebar-transition ml-0 ${sidebarCollapsed ? 'md:ml-20' : 'md:ml-64'}`}>\r\n        <Header onToggleSidebar={() => setSidebarCollapsed(!sidebarCollapsed)} />\r\n        <main className=\"p-4 md:p-6\">{children}</main>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\layout\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":22,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1239,1242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1239,1242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1651,1654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1651,1654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { api } from '@/app/services/api';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu';\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Input } from '@/components/ui/input';\r\nimport { Modal } from '@/components/ui/modal';\r\nimport { Menu, Search, Bell, Settings, LogOut, UserCircle, Check, X, Loader2 } from 'lucide-react';\r\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\r\nimport { toast } from 'sonner';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\n\r\ninterface HeaderProps {\r\n  onToggleSidebar: () => void;\r\n}\r\n\r\nexport function Header({ onToggleSidebar }: HeaderProps) {\r\n\r\n  const { user, logout } = useAuth();\r\n  const [showLogoutModal, setShowLogoutModal] = useState(false);\r\n  const [showProfileModal, setShowProfileModal] = useState(false);\r\n  const [pendingRequests, setPendingRequests] = useState<any[]>([]);\r\n  const [loadingResolve, setLoadingResolve] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Solo fetching si el usuario es admin\r\n    if (user?.rol === 'admin') {\r\n      const fetchPendingRequests = async () => {\r\n        try {\r\n          // console.log(\"Fetching pending requests...\");\r\n          const response = await api.get('/auth/password-reset-requests?pending_only=true') as any[];\r\n          // console.log(\"Pending requests response:\", response);\r\n          setPendingRequests(response);\r\n        } catch (error) {\r\n          console.error(\"Error fetching requests\", error);\r\n        }\r\n      };\r\n\r\n      fetchPendingRequests();\r\n      // Polling cada 30 segundos\r\n      const interval = setInterval(fetchPendingRequests, 30000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [user]);\r\n\r\n  const handleResolveRequest = async (id: number) => {\r\n    setLoadingResolve(id);\r\n    try {\r\n      await api.post(`/auth/password-reset-requests/${id}/resolve`, {});\r\n      setPendingRequests(prev => prev.filter(req => req.id !== id));\r\n      toast.success('Solicitud marcada como resuelta');\r\n    } catch (error) {\r\n      console.error('Error resolving request', error);\r\n      toast.error('Error al resolver la solicitud');\r\n    } finally {\r\n      setLoadingResolve(null);\r\n    }\r\n  };\r\n\r\n  const getInitials = (nombre: string, apellido: string) => {\r\n    return `${nombre.charAt(0)}${apellido.charAt(0)}`.toUpperCase();\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    logout();\r\n    setShowLogoutModal(false);\r\n  };\r\n\r\n  return (\r\n    <header className=\"sticky top-0 z-30 h-16 bg-white border-b border-gray-200 transition-colors duration-300\">\r\n      <div className=\"flex h-full items-center justify-between px-4 lg:px-6\">\r\n        {/* Left Side */}\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={onToggleSidebar}\r\n            className=\"hover:bg-gray-100 rounded-lg\"\r\n          >\r\n            <Menu className=\"h-5 w-5 text-gray-600\" />\r\n          </Button>\r\n\r\n          {/* Search */}\r\n          <div className=\"hidden md:flex relative\">\r\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400\" />\r\n            <Input\r\n              type=\"search\"\r\n              placeholder=\"Buscar valoraciones...\"\r\n              className=\"w-72 pl-10 h-10 bg-gray-100 border-0 rounded-lg text-gray-900 placeholder-gray-500\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Side */}\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Notifications */}\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"relative hover:bg-gray-100 rounded-lg\">\r\n                <Bell className=\"h-5 w-5 text-gray-600\" />\r\n                {pendingRequests.length > 0 && (\r\n                  <span className=\"absolute top-1 right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white shadow-sm ring-1 ring-white\">\r\n                    {pendingRequests.length}\r\n                  </span>\r\n                )}\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-80 p-0 bg-white shadow-xl border border-gray-200\" align=\"end\">\r\n              <div className=\"p-4 border-b border-gray-100\">\r\n                <h4 className=\"font-semibold text-sm\">Notificaciones</h4>\r\n                <p className=\"text-xs text-gray-500\">Solicitudes de acceso pendientes</p>\r\n              </div>\r\n              <div className=\"max-h-[300px] overflow-y-auto\">\r\n                {pendingRequests.length === 0 ? (\r\n                  <div className=\"p-4 text-center text-sm text-gray-500\">\r\n                    No hay notificaciones nuevas\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"divide-y divide-gray-100\">\r\n                    {pendingRequests.map((req) => (\r\n                      <div key={req.id} className=\"p-4 flex items-start gap-3 hover:bg-gray-50 transition-colors\">\r\n                        <div className=\"bg-indigo-100 p-2 rounded-full\">\r\n                          <UserCircle className=\"h-4 w-4 text-indigo-600\" />\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"text-sm font-medium text-gray-900 truncate\">\r\n                            Restablecer Contraseña\r\n                          </p>\r\n                          <p className=\"text-xs text-gray-500 truncate\">\r\n                            {req.email}\r\n                          </p>\r\n                          <p className=\"text-[10px] text-gray-400 mt-1\">\r\n                            {formatDistanceToNow(new Date(req.created_at), { addSuffix: true, locale: es })}\r\n                          </p>\r\n                        </div>\r\n                        <Button\r\n                          size=\"icon\"\r\n                          variant=\"ghost\"\r\n                          className=\"h-8 w-8 text-green-600 hover:text-green-700 hover:bg-green-50\"\r\n                          onClick={() => handleResolveRequest(req.id)}\r\n                          disabled={loadingResolve === req.id}\r\n                        >\r\n                          {loadingResolve === req.id ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                          ) : (\r\n                            <Check className=\"h-4 w-4\" />\r\n                          )}\r\n                        </Button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </PopoverContent>\r\n          </Popover>\r\n\r\n          {/* Divider */}\r\n          <div className=\"hidden md:block w-px h-8 bg-gray-200\"></div>\r\n\r\n          {/* User Menu */}\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" className=\"gap-3 h-10 px-3 hover:bg-gray-100 rounded-lg\">\r\n                <Avatar className=\"h-8 w-8\">\r\n                  <AvatarFallback className=\"bg-gradient-to-br from-indigo-500 to-violet-600 text-white text-sm font-semibold\">\r\n                    {user ? getInitials(user.nombre, user.apellido) : 'U'}\r\n                  </AvatarFallback>\r\n                </Avatar>\r\n                <span className=\"hidden md:block text-sm font-medium text-gray-700\">\r\n                  {user?.nombre}\r\n                </span>\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-56 bg-white border border-gray-200\">\r\n              <div className=\"px-3 py-3 border-b border-gray-100\">\r\n                <p className=\"font-semibold text-gray-900\">{user?.nombre} {user?.apellido}</p>\r\n                <p className=\"text-xs text-gray-500 mt-0.5\">{user?.email}</p>\r\n              </div>\r\n              <div className=\"py-1\">\r\n                <DropdownMenuItem\r\n                  onClick={() => setShowProfileModal(true)}\r\n                  className=\"gap-2 cursor-pointer text-gray-700 hover:bg-gray-100\"\r\n                >\r\n                  <UserCircle className=\"h-4 w-4\" />\r\n                  Mi Perfil\r\n                </DropdownMenuItem>\r\n\r\n                <DropdownMenuItem asChild>\r\n                  <Link\r\n                    href=\"/dashboard/configuracion\"\r\n                    className=\"gap-2 cursor-pointer text-gray-700 hover:bg-gray-100 w-full flex items-center\"\r\n                  >\r\n                    <Settings className=\"h-4 w-4\" />\r\n                    Configuración\r\n                  </Link>\r\n                </DropdownMenuItem>\r\n              </div>\r\n              <DropdownMenuSeparator className=\"bg-gray-100\" />\r\n              <DropdownMenuItem\r\n                onClick={() => setShowLogoutModal(true)}\r\n                className=\"gap-2 text-red-600 cursor-pointer hover:bg-red-50\"\r\n              >\r\n                <LogOut className=\"h-4 w-4\" />\r\n                Cerrar Sesión\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal de Cerrar Sesión */}\r\n      <Modal\r\n        isOpen={showLogoutModal}\r\n        onClose={() => setShowLogoutModal(false)}\r\n        title=\"Cerrar Sesión\"\r\n        size=\"sm\"\r\n        footer={\r\n          <div className=\"flex justify-end gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowLogoutModal(false)}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={handleLogout}\r\n              className=\"bg-[#ff4444] hover:bg-red-600\"\r\n            >\r\n              Cerrar Sesión\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <p className=\"text-gray-600\">\r\n            ¿Estás seguro que deseas cerrar sesión?\r\n          </p>\r\n        </div>\r\n      </Modal>\r\n\r\n      {/* Modal de Mi Perfil (Antes Configuración) */}\r\n      <Modal\r\n        isOpen={showProfileModal}\r\n        onClose={() => setShowProfileModal(false)}\r\n        title=\"Mi Perfil\"\r\n        size=\"md\"\r\n        footer={\r\n          <div className=\"flex justify-end gap-2\">\r\n            <Button\r\n              onClick={() => setShowProfileModal(false)}\r\n              className=\"bg-indigo-500 hover:bg-indigo-600\"\r\n            >\r\n              Cerrar\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-6\">\r\n          {/* Usuario */}\r\n          <div className=\"space-y-2\">\r\n            <h4 className=\"font-semibold text-gray-900\">Información del Usuario</h4>\r\n            <div className=\"p-4 rounded-lg bg-gray-50 border border-gray-200\">\r\n              <div className=\"space-y-2\">\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Nombre</p>\r\n                  <p className=\"font-medium text-gray-900\">{user?.nombre} {user?.apellido}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Email</p>\r\n                  <p className=\"font-medium text-gray-900\">{user?.email}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Rol</p>\r\n                  <p className=\"font-medium text-gray-900 capitalize\">{user?.rol}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </header>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\components\\layout\\Sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2578,2581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2578,2581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCollapsed' is defined but never used.","line":104,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":104,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3814,3817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3814,3817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4403,4406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4403,4406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":169,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":172,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4469,4472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4469,4472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5792,5795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5792,5795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { usePathname } from 'next/navigation';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport {\r\n  LayoutDashboard,\r\n  ClipboardList,\r\n  Users,\r\n  Settings,\r\n  ChevronDown,\r\n  Download,\r\n  PlusCircle,\r\n  List,\r\n  Briefcase,\r\n  FileText,\r\n} from 'lucide-react';\r\n\r\ninterface SidebarProps {\r\n  collapsed: boolean;\r\n  setCollapsed?: (collapsed: boolean) => void;\r\n}\r\n\r\nconst menuItems = [\r\n  {\r\n    title: 'NAVEGACIÓN',\r\n    items: [\r\n      { title: 'Dashboard', icon: LayoutDashboard, href: '/dashboard' },\r\n      {\r\n        title: 'Val. Psicológicas',\r\n        icon: ClipboardList,\r\n        href: '/dashboard/valoraciones',\r\n        requiresAccess: 'valoraciones' as const,\r\n        children: [\r\n          { title: 'Lista', href: '/dashboard/valoraciones', icon: List },\r\n          { title: 'Nueva Valoración', href: '/dashboard/valoraciones/nueva', icon: PlusCircle },\r\n        ],\r\n      },\r\n      {\r\n        title: 'Pruebas de Trabajo',\r\n        icon: Briefcase,\r\n        href: '/dashboard/pruebas-trabajo',\r\n        requiresAccess: 'pruebas_trabajo' as const,\r\n        children: [\r\n          { title: 'Lista', href: '/dashboard/pruebas-trabajo', icon: List },\r\n          { title: 'Nueva Prueba', href: '/dashboard/pruebas-trabajo/nueva', icon: PlusCircle },\r\n        ],\r\n      },\r\n      {\r\n        title: 'Formatos TO',\r\n        icon: FileText,\r\n        href: '#', // No href for parent\r\n        requiresAccess: 'formatos_to' as const,\r\n        children: [\r\n          {\r\n            title: 'Prueba de Trabajo TO',\r\n            href: '/dashboard/formatos-to/pruebas-trabajo',\r\n            icon: Briefcase,\r\n            children: [\r\n              { title: 'Lista', href: '/dashboard/formatos-to/pruebas-trabajo', icon: List },\r\n              { title: 'Nueva', href: '/dashboard/formatos-to/pruebas-trabajo/nueva', icon: PlusCircle },\r\n            ]\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    title: 'REPORTES',\r\n    items: [\r\n      {\r\n        title: 'Descargas',\r\n        icon: Download,\r\n        href: '/dashboard/reportes',\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    title: 'ADMINISTRACIÓN',\r\n    items: [\r\n      { title: 'Usuarios', icon: Users, href: '/dashboard/usuarios', adminOnly: true },\r\n      { title: 'Configuración', icon: Settings, href: '/dashboard/configuracion' },\r\n    ],\r\n  },\r\n];\r\n\r\n// ... (keep helper functions same)\r\n\r\n// Función para verificar si el usuario tiene acceso a un módulo\r\nconst hasModuleAccess = (user: any, accessType?: 'valoraciones' | 'pruebas_trabajo' | 'formatos_to') => {\r\n  if (!accessType) return true; // Sin restricción\r\n  if (!user) return false;\r\n  if (user.rol === 'admin') return true; // Admin tiene acceso a todo\r\n\r\n  if (accessType === 'valoraciones') return user.acceso_valoraciones !== false;\r\n  if (accessType === 'pruebas_trabajo') return user.acceso_pruebas_trabajo !== false;\r\n  if (accessType === 'formatos_to') return user.acceso_formatos_to !== false;\r\n\r\n  return true;\r\n};\r\n\r\nexport function Sidebar({ collapsed, setCollapsed }: SidebarProps) {\r\n  const pathname = usePathname();\r\n  const { user } = useAuth();\r\n  const [expandedItems, setExpandedItems] = useState<string[]>(['Valoraciones', 'Formatos TO']); // Auto-expand Formatos TO\r\n\r\n  const toggleExpand = (title: string) => {\r\n    setExpandedItems((prev) =>\r\n      prev.includes(title) ? prev.filter((item) => item !== title) : [...prev, title]\r\n    );\r\n  };\r\n\r\n  const isActive = (href: string) => {\r\n    if (href === '#' || href === '') return false;\r\n    if (href === '/dashboard') return pathname === href;\r\n    return pathname === href || pathname.startsWith(href + '/');\r\n  };\r\n\r\n  // Helper for 3rd level rendering\r\n  const renderMenuItem = (item: any, depth = 0) => {\r\n    // Verificar permisos de admin\r\n    if (item.adminOnly && user?.rol !== 'admin') return null;\r\n\r\n    // Verificar permisos de acceso a módulos\r\n    if (item.requiresAccess && !hasModuleAccess(user, item.requiresAccess)) return null;\r\n\r\n    const Icon = item.icon;\r\n    const hasChildren = item.children && item.children.length > 0;\r\n    const isExpanded = expandedItems.includes(item.title);\r\n    // For parent items without href, check if any child is active\r\n    const active = item.href && item.href !== '#' ? isActive(item.href) : item.children?.some((child: any) => isActive(child.href) || child.children?.some((grandChild: any) => isActive(grandChild.href)));\r\n\r\n    const key = item.title + depth;\r\n    const isNested = depth > 0;\r\n\r\n    return (\r\n      <li key={key}>\r\n        {hasChildren ? (\r\n          <>\r\n            <button\r\n              onClick={() => toggleExpand(item.title)}\r\n              className={`flex w-full items-center gap-3 rounded-lg px-3 py-2.5 font-medium transition-all duration-200 ${active\r\n                ? 'bg-indigo-500/10 text-indigo-600 shadow-sm'\r\n                : 'text-gray-600 hover:bg-gray-100'\r\n                } ${collapsed ? 'justify-center px-2' : ''} ${isNested ? 'text-xs py-2' : 'text-sm'}`}\r\n              style={{ paddingLeft: depth > 0 ? `${depth * 0.75 + 0.75}rem` : '' }}\r\n            >\r\n              <Icon className={`${isNested ? 'h-4 w-4' : 'h-5 w-5'} flex-shrink-0 ${active ? 'text-indigo-600' : ''}`} />\r\n              {!collapsed && (\r\n                <>\r\n                  <span className=\"flex-1 text-left\">{item.title}</span>\r\n                  <ChevronDown className={`h-4 w-4 transition-transform duration-200 ${isExpanded ? 'rotate-180' : ''}`} />\r\n                </>\r\n              )}\r\n            </button>\r\n            {!collapsed && isExpanded && (\r\n              <ul className=\"mt-1 space-y-1 border-l-2 border-gray-200 ml-4 mb-2\">\r\n                {item.children.map((child: any) => renderMenuItem(child, depth + 1))}\r\n              </ul>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <Link\r\n            href={item.href}\r\n            className={`flex items-center gap-3 rounded-lg px-3 py-2.5 font-medium transition-all duration-200 ${active\r\n              ? 'bg-indigo-500/10 text-indigo-600 shadow-sm'\r\n              : 'text-gray-600 hover:bg-gray-100'\r\n              } ${collapsed ? 'justify-center px-2' : ''} ${isNested ? 'text-xs py-2' : 'text-sm'}`}\r\n            style={{ paddingLeft: depth > 0 ? `${depth * 0.75 + 0.75}rem` : '' }}\r\n          >\r\n            <Icon className={`${isNested ? 'h-4 w-4' : 'h-5 w-5'} flex-shrink-0 ${active ? 'text-indigo-600' : ''}`} />\r\n            {!collapsed && <span>{item.title}</span>}\r\n          </Link>\r\n        )}\r\n      </li>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <aside\r\n      className={`fixed left-0 top-0 z-40 h-screen bg-white border-r border-gray-200 transition-all duration-300\r\n        ${collapsed ? '-translate-x-full md:translate-x-0 md:w-20' : 'translate-x-0 w-64'}\r\n      `}\r\n    >\r\n      {/* Logo Section (Keep existing) */}\r\n      <div className=\"flex h-16 items-center border-b border-gray-200 px-4\">\r\n        <Link href=\"/dashboard\" className=\"flex items-center gap-3 w-full\">\r\n          <div className={`relative ${collapsed ? 'w-10 h-10' : 'w-52 h-14'} transition-all duration-300 flex items-center justify-center overflow-hidden`}>\r\n            {collapsed ? (\r\n              <div className=\"relative w-8 h-8\">\r\n                <Image src=\"/images/mentis-mini.svg\" alt=\"M\" fill className=\"object-contain\" priority />\r\n              </div>\r\n            ) : (\r\n              <Image src=\"/images/mentis-logo.svg\" alt=\"Mentis\" fill className=\"object-contain scale-[1.8]\" priority sizes=\"(max-width: 768px) 100vw\" />\r\n            )}\r\n          </div>\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Navigation */}\r\n      <nav className=\"flex-1 overflow-y-auto p-3\">\r\n        {menuItems.map((section, sectionIndex) => (\r\n          <div key={section.title} className={sectionIndex > 0 ? 'mt-6' : ''}>\r\n            {!collapsed && (\r\n              <h3 className=\"mb-2 px-3 text-[11px] font-semibold text-gray-400 uppercase tracking-wider\">\r\n                {section.title}\r\n              </h3>\r\n            )}\r\n            <ul className=\"space-y-1\">\r\n              {section.items.map((item) => renderMenuItem(item))}\r\n            </ul>\r\n          </div>\r\n        ))}\r\n      </nav>\r\n    </aside>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\context\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\context\\NotificationContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\context\\NotificationContext.tsx:33:17\n  31 |         if (saved) {\n  32 |             try {\n> 33 |                 setNotifications(JSON.parse(saved));\n     |                 ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  34 |             } catch (e) {\n  35 |                 console.error('Error parsing notifications', e);\n  36 |             }","line":33,"column":17,"nodeType":null,"endLine":33,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nexport interface Notification {\r\n    id: string;\r\n    title: string;\r\n    message: string;\r\n    time: string;\r\n    read: boolean;\r\n    type?: 'success' | 'info' | 'warning' | 'error';\r\n}\r\n\r\ninterface NotificationContextType {\r\n    notifications: Notification[];\r\n    unreadCount: number;\r\n    addNotification: (title: string, message: string, type?: 'success' | 'info' | 'warning' | 'error') => void;\r\n    markAsRead: (id: string) => void;\r\n    markAllAsRead: () => void;\r\n    clearNotifications: () => void;\r\n}\r\n\r\nconst NotificationContext = createContext<NotificationContextType | undefined>(undefined);\r\n\r\nexport function NotificationProvider({ children }: { children: React.ReactNode }) {\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n\r\n    // Cargar notificaciones del localStorage al iniciar - opcional si queremos persistencia entre recargas\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem('notifications');\r\n        if (saved) {\r\n            try {\r\n                setNotifications(JSON.parse(saved));\r\n            } catch (e) {\r\n                console.error('Error parsing notifications', e);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // Guardar en localStorage cuando cambien\r\n    useEffect(() => {\r\n        localStorage.setItem('notifications', JSON.stringify(notifications));\r\n    }, [notifications]);\r\n\r\n    const addNotification = (title: string, message: string, type: 'success' | 'info' | 'warning' | 'error' = 'info') => {\r\n        const newNotification: Notification = {\r\n            id: Date.now().toString(),\r\n            title,\r\n            message,\r\n            time: new Date().toISOString(),\r\n            read: false,\r\n            type\r\n        };\r\n        setNotifications(prev => [newNotification, ...prev]);\r\n    };\r\n\r\n    const markAsRead = (id: string) => {\r\n        setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n));\r\n    };\r\n\r\n    const markAllAsRead = () => {\r\n        setNotifications(prev => prev.map(n => ({ ...n, read: true })));\r\n    };\r\n\r\n    const clearNotifications = () => {\r\n        setNotifications([]);\r\n    };\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n\r\n    return (\r\n        <NotificationContext.Provider value={{\r\n            notifications,\r\n            unreadCount,\r\n            addNotification,\r\n            markAsRead,\r\n            markAllAsRead,\r\n            clearNotifications\r\n        }}>\r\n            {children}\r\n        </NotificationContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useNotification() {\r\n    const context = useContext(NotificationContext);\r\n    if (context === undefined) {\r\n        throw new Error('useNotification must be used within a NotificationProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\context\\ThemeContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\context\\ThemeContext.tsx:21:5\n  19 |\n  20 |   useEffect(() => {\n> 21 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |     // Forzar modo claro y remover cualquier clase dark\n  23 |     document.documentElement.classList.remove('dark');\n  24 |     // Limpiar localStorage para evitar conflictos","line":21,"column":5,"nodeType":null,"endLine":21,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\n\r\ntype Theme = 'light' | 'dark';\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  toggleTheme: () => void;\r\n  setTheme: (theme: Theme) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: ReactNode }) {\r\n  // Modo oscuro deshabilitado - siempre en modo claro\r\n  const [theme] = useState<Theme>('light');\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    // Forzar modo claro y remover cualquier clase dark\r\n    document.documentElement.classList.remove('dark');\r\n    // Limpiar localStorage para evitar conflictos\r\n    localStorage.removeItem('theme');\r\n  }, []);\r\n\r\n  const setTheme = () => {\r\n    // Deshabilitado - siempre permanece en light\r\n    console.warn('El modo oscuro está deshabilitado');\r\n  };\r\n\r\n  const toggleTheme = () => {\r\n    // Deshabilitado - no hace nada\r\n    console.warn('El modo oscuro está deshabilitado');\r\n  };\r\n\r\n  if (!mounted) return null;\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (context === undefined) {\r\n    throw new Error('useTheme debe usarse dentro de un ThemeProvider');\r\n  }\r\n  return context;\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\configuracion\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2741,2744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2741,2744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { api } from '@/app/services/api';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { toast } from 'sonner';\r\nimport { Loader2, User, Lock, Save, Shield, Settings } from 'lucide-react';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\n\r\nexport default function ConfiguracionPage() {\r\n    const { user } = useAuth();\r\n    const [savingProfile, setSavingProfile] = useState(false);\r\n    const [savingPassword, setSavingPassword] = useState(false);\r\n\r\n    // Estados del perfil\r\n    const [profileData, setProfileData] = useState({\r\n        nombre: '',\r\n        apellido: '',\r\n        email: ''\r\n    });\r\n\r\n    // Estados de contraseña\r\n    const [passwordData, setPasswordData] = useState({\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            setProfileData({\r\n                nombre: user.nombre || '',\r\n                apellido: user.apellido || '',\r\n                email: user.email || ''\r\n            });\r\n        }\r\n    }, [user]);\r\n\r\n    const handleProfileUpdate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setSavingProfile(true);\r\n        try {\r\n            await api.put('/usuarios/me', {\r\n                nombre: profileData.nombre,\r\n                apellido: profileData.apellido\r\n            });\r\n            toast.success('Perfil actualizado correctamente');\r\n        } catch (error: any) {\r\n            toast.error('Error al actualizar el perfil');\r\n            console.error(error);\r\n        } finally {\r\n            setSavingProfile(false);\r\n        }\r\n    };\r\n\r\n    const handlePasswordUpdate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (passwordData.newPassword !== passwordData.confirmPassword) {\r\n            toast.error('Las contraseñas no coinciden');\r\n            return;\r\n        }\r\n\r\n        if (passwordData.newPassword.length < 6) {\r\n            toast.error('La contraseña debe tener al menos 6 caracteres');\r\n            return;\r\n        }\r\n\r\n        setSavingPassword(true);\r\n        try {\r\n            await api.put('/usuarios/me', {\r\n                password: passwordData.newPassword\r\n            });\r\n            toast.success('Contraseña actualizada correctamente');\r\n            setPasswordData({ newPassword: '', confirmPassword: '' });\r\n        } catch (error: any) {\r\n            toast.error('Error al actualizar la contraseña');\r\n            console.error(error);\r\n        } finally {\r\n            setSavingPassword(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-8 max-w-4xl mx-auto py-6\">\r\n                {/* Header Centrado */}\r\n                <div className=\"text-center space-y-2 mb-8\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100 flex items-center justify-center gap-3\">\r\n                        <Settings className=\"h-8 w-8 text-indigo-500\" />\r\n                        Configuración\r\n                    </h1>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 max-w-lg mx-auto\">\r\n                        Administra tu información personal y fortalece la seguridad de tu cuenta desde este panel centralizado.\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"space-y-8\">\r\n                    {/* Perfil Card */}\r\n                    <Card className=\"border shadow-md bg-white dark:bg-gray-900 overflow-hidden\">\r\n                        <CardHeader className=\"bg-gray-50/80 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-800 pb-6\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"p-3 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                                    <User className=\"h-6 w-6 text-indigo-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <CardTitle className=\"text-xl\">Información Personal</CardTitle>\r\n                                    <CardDescription className=\"mt-1\">\r\n                                        Actualiza tus datos de identificación básicos.\r\n                                    </CardDescription>\r\n                                </div>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"pt-8\">\r\n                            <form onSubmit={handleProfileUpdate} className=\"space-y-6\">\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className=\"space-y-2.5\">\r\n                                        <Label htmlFor=\"nombre\" className=\"text-gray-700 dark:text-gray-300\">Nombre</Label>\r\n                                        <Input\r\n                                            id=\"nombre\"\r\n                                            value={profileData.nombre}\r\n                                            onChange={(e) => setProfileData({ ...profileData, nombre: e.target.value })}\r\n                                            className=\"h-11 bg-gray-50/50 dark:bg-gray-900 border-gray-200 focus:border-indigo-500 transition-colors\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2.5\">\r\n                                        <Label htmlFor=\"apellido\" className=\"text-gray-700 dark:text-gray-300\">Apellido</Label>\r\n                                        <Input\r\n                                            id=\"apellido\"\r\n                                            value={profileData.apellido}\r\n                                            onChange={(e) => setProfileData({ ...profileData, apellido: e.target.value })}\r\n                                            className=\"h-11 bg-gray-50/50 dark:bg-gray-900 border-gray-200 focus:border-indigo-500 transition-colors\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-2.5\">\r\n                                    <Label htmlFor=\"email\" className=\"text-gray-700 dark:text-gray-300\">Correo Electrónico</Label>\r\n                                    <div className=\"relative\">\r\n                                        <Input\r\n                                            id=\"email\"\r\n                                            value={profileData.email}\r\n                                            disabled\r\n                                            className=\"h-11 bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400 border-dashed\"\r\n                                        />\r\n                                        <Shield className=\"absolute right-4 top-3.5 h-4 w-4 text-gray-400\" />\r\n                                    </div>\r\n                                    <p className=\"text-xs text-muted-foreground flex items-center gap-1.5 px-1\">\r\n                                        <Shield className=\"h-3 w-3\" /> Este campo no se puede modificar por seguridad.\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"pt-4 flex justify-end\">\r\n                                    <Button\r\n                                        type=\"submit\"\r\n                                        disabled={savingProfile}\r\n                                        className=\"h-11 px-8 bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-500/20\"\r\n                                    >\r\n                                        {savingProfile ? (\r\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                        ) : (\r\n                                            <Save className=\"mr-2 h-4 w-4\" />\r\n                                        )}\r\n                                        Guardar Cambios\r\n                                    </Button>\r\n                                </div>\r\n                            </form>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Seguridad Card */}\r\n                    <Card className=\"border shadow-md bg-white dark:bg-gray-900 overflow-hidden\">\r\n                        <CardHeader className=\"bg-gray-50/80 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-800 pb-6\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"p-3 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700\">\r\n                                    <Lock className=\"h-6 w-6 text-orange-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <CardTitle className=\"text-xl\">Seguridad</CardTitle>\r\n                                    <CardDescription className=\"mt-1\">\r\n                                        Gestiona tu contraseña y acceso.\r\n                                    </CardDescription>\r\n                                </div>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"pt-8\">\r\n                            <form onSubmit={handlePasswordUpdate} className=\"space-y-6\">\r\n                                <div className=\"space-y-2.5\">\r\n                                    <Label htmlFor=\"new-password\">Nueva Contraseña</Label>\r\n                                    <Input\r\n                                        id=\"new-password\"\r\n                                        type=\"password\"\r\n                                        value={passwordData.newPassword}\r\n                                        onChange={(e) => setPasswordData({ ...passwordData, newPassword: e.target.value })}\r\n                                        placeholder=\"Mínimo 6 caracteres\"\r\n                                        className=\"h-11 bg-gray-50/50 dark:bg-gray-900 border-gray-200 focus:border-orange-500 transition-colors\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2.5\">\r\n                                    <Label htmlFor=\"confirm-password\">Confirmar Contraseña</Label>\r\n                                    <Input\r\n                                        id=\"confirm-password\"\r\n                                        type=\"password\"\r\n                                        value={passwordData.confirmPassword}\r\n                                        onChange={(e) => setPasswordData({ ...passwordData, confirmPassword: e.target.value })}\r\n                                        placeholder=\"Repetir contraseña\"\r\n                                        className=\"h-11 bg-gray-50/50 dark:bg-gray-900 border-gray-200 focus:border-orange-500 transition-colors\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"pt-4 flex justify-end\">\r\n                                    <Button\r\n                                        type=\"submit\"\r\n                                        disabled={savingPassword || !passwordData.newPassword}\r\n                                        className=\"h-11 px-8 bg-orange-500 hover:bg-orange-600 text-white shadow-lg shadow-orange-500/20\"\r\n                                    >\r\n                                        {savingPassword ? (\r\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                        ) : (\r\n                                            <Lock className=\"mr-2 h-4 w-4\" />\r\n                                        )}\r\n                                        Actualizar Contraseña\r\n                                    </Button>\r\n                                </div>\r\n                            </form>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\formatos-to\\pruebas-trabajo\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\formatos-to\\pruebas-trabajo\\nueva\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\formatos-to\\pruebas-trabajo\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1633,1636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1633,1636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPruebas'. Either include it or remove the dependency array.","line":53,"column":42,"nodeType":"ArrayExpression","endLine":53,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPruebas, page]","fix":{"range":[1793,1799],"text":"[fetchPruebas, page]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { ModuleGuard } from '@/app/components/guards/ModuleGuard';\r\nimport { toast } from 'sonner';\r\nimport {\r\n    PlusCircle, Search, Eye, Trash2, FileText, Loader2,\r\n    ChevronLeft, ChevronRight\r\n} from 'lucide-react';\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app';\r\n\r\ninterface PruebaListItem {\r\n    id: number;\r\n    estado: string;\r\n    fecha_creacion: string;\r\n    fecha_actualizacion: string;\r\n    trabajador_nombre: string | null;\r\n    trabajador_documento: string | null;\r\n    empresa: string | null;\r\n}\r\n\r\nfunction PruebasTrabajoTOList() {\r\n    const router = useRouter();\r\n    const { token } = useAuth();\r\n    const [pruebas, setPruebas] = useState<PruebaListItem[]>([]);\r\n    const [total, setTotal] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n    const [page, setPage] = useState(0);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const limit = 10;\r\n\r\n    const fetchPruebas = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(\r\n                `${API_URL}/formatos-to/pruebas-trabajo/?skip=${page * limit}&limit=${limit}`,\r\n                { headers: { Authorization: `Bearer ${token}` } }\r\n            );\r\n            if (!res.ok) throw new Error('Error al obtener pruebas');\r\n            const data = await res.json();\r\n            setPruebas(data.items || []);\r\n            setTotal(data.total || 0);\r\n        } catch (e: any) {\r\n            toast.error(e.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { fetchPruebas(); }, [page]);\r\n\r\n    const handleDelete = async (id: number) => {\r\n        if (!confirm('¿Está seguro de eliminar esta prueba?')) return;\r\n        try {\r\n            const res = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/${id}`, {\r\n                method: 'DELETE',\r\n                headers: { Authorization: `Bearer ${token}` },\r\n            });\r\n            if (!res.ok) throw new Error('Error al eliminar');\r\n            toast.success('Prueba eliminada');\r\n            fetchPruebas();\r\n        } catch (e: any) {\r\n            toast.error(e.message);\r\n        }\r\n    };\r\n\r\n    const filtered = pruebas.filter(p => {\r\n        if (!searchTerm) return true;\r\n        const s = searchTerm.toLowerCase();\r\n        return (p.trabajador_nombre?.toLowerCase().includes(s)) ||\r\n            (p.empresa?.toLowerCase().includes(s)) ||\r\n            (p.trabajador_documento?.toLowerCase().includes(s));\r\n    });\r\n\r\n    const totalPages = Math.ceil(total / limit);\r\n\r\n    const estadoLabel = (e: string) => {\r\n        if (e === 'completada') return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700\">Completada</span>;\r\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700\">Borrador</span>;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-800\">Pruebas de Trabajo TO</h1>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">Módulo de Terapia Ocupacional</p>\r\n                </div>\r\n                <button\r\n                    onClick={() => router.push('/dashboard/formatos-to/pruebas-trabajo/nueva')}\r\n                    className=\"inline-flex items-center gap-2 px-4 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium text-sm shadow-sm\"\r\n                >\r\n                    <PlusCircle className=\"h-4 w-4\" />\r\n                    Nueva Prueba TO\r\n                </button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative max-w-md\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Buscar por trabajador, empresa o documento...\"\r\n                    value={searchTerm}\r\n                    onChange={e => setSearchTerm(e.target.value)}\r\n                    className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-400\"\r\n                />\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                {loading ? (\r\n                    <div className=\"flex items-center justify-center py-20\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-indigo-500\" />\r\n                    </div>\r\n                ) : filtered.length === 0 ? (\r\n                    <div className=\"text-center py-20\">\r\n                        <FileText className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n                        <p className=\"text-gray-500\">No se encontraron pruebas</p>\r\n                    </div>\r\n                ) : (\r\n                    <table className=\"w-full\">\r\n                        <thead>\r\n                            <tr className=\"bg-gray-50 border-b border-gray-200\">\r\n                                <th className=\"text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase\">ID</th>\r\n                                <th className=\"text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase\">Trabajador</th>\r\n                                <th className=\"text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase hidden md:table-cell\">Empresa</th>\r\n                                <th className=\"text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase hidden sm:table-cell\">Estado</th>\r\n                                <th className=\"text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase hidden lg:table-cell\">Fecha</th>\r\n                                <th className=\"text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase\">Acciones</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-gray-100\">\r\n                            {filtered.map(p => (\r\n                                <tr key={p.id} className=\"hover:bg-gray-50/50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm text-gray-600\">{p.id}</td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <p className=\"text-sm font-medium text-gray-800\">{p.trabajador_nombre || '—'}</p>\r\n                                        <p className=\"text-xs text-gray-400\">{p.trabajador_documento || ''}</p>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-sm text-gray-600 hidden md:table-cell\">{p.empresa || '—'}</td>\r\n                                    <td className=\"px-4 py-3 hidden sm:table-cell\">{estadoLabel(p.estado)}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-gray-500 hidden lg:table-cell\">\r\n                                        {new Date(p.fecha_creacion).toLocaleDateString('es-CO')}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-right\">\r\n                                        <div className=\"flex items-center justify-end gap-1\">\r\n                                            <button\r\n                                                onClick={() => router.push(`/dashboard/formatos-to/pruebas-trabajo/${p.id}`)}\r\n                                                className=\"p-2 rounded-lg hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 transition-colors\"\r\n                                                title=\"Ver\"\r\n                                            >\r\n                                                <Eye className=\"h-4 w-4\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(p.id)}\r\n                                                className=\"p-2 rounded-lg hover:bg-red-50 text-gray-500 hover:text-red-600 transition-colors\"\r\n                                                title=\"Eliminar\"\r\n                                            >\r\n                                                <Trash2 className=\"h-4 w-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n\r\n                {/* Pagination */}\r\n                {totalPages > 1 && (\r\n                    <div className=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50\">\r\n                        <p className=\"text-sm text-gray-500\">\r\n                            Mostrando {page * limit + 1}–{Math.min((page + 1) * limit, total)} de {total}\r\n                        </p>\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <button disabled={page === 0} onClick={() => setPage(p => p - 1)}\r\n                                className=\"p-1.5 rounded-lg hover:bg-gray-200 disabled:opacity-40 disabled:cursor-not-allowed\">\r\n                                <ChevronLeft className=\"h-4 w-4\" />\r\n                            </button>\r\n                            <span className=\"text-sm px-2\">{page + 1} / {totalPages}</span>\r\n                            <button disabled={page >= totalPages - 1} onClick={() => setPage(p => p + 1)}\r\n                                className=\"p-1.5 rounded-lg hover:bg-gray-200 disabled:opacity-40 disabled:cursor-not-allowed\">\r\n                                <ChevronRight className=\"h-4 w-4\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\n\r\nexport default function PruebasTrabajoTOPage() {\r\n    return (\r\n        <ModuleGuard requiredModule=\"formatos_to\">\r\n            <DashboardLayout>\r\n                <PruebasTrabajoTOList />\r\n            </DashboardLayout>\r\n        </ModuleGuard>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileCheck' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1618,1621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1618,1621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, token]","fix":{"range":[2434,2441],"text":"[fetchData, token]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { api } from '@/app/services/api';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  ClipboardList,\r\n  FileCheck,\r\n  Clock,\r\n  FileEdit,\r\n  RefreshCcw,\r\n  Building2,\r\n  Calendar,\r\n  Plus,\r\n  ArrowRight,\r\n  TrendingUp,\r\n  Eye,\r\n  Briefcase,\r\n  Users,\r\n  Activity,\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\ninterface Valoracion {\r\n  id: number;\r\n  fecha_valoracion: string;\r\n  estado: string;\r\n  trabajador_nombre?: string;\r\n  trabajador_documento?: string;\r\n  empresa?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface PruebaTrabajo {\r\n  id: number;\r\n  estado: string;\r\n  fecha_creacion: string;\r\n  trabajador_nombre?: string;\r\n  trabajador_identificacion?: string;\r\n  empresa?: string;\r\n}\r\n\r\nexport default function DashboardPage() {\r\n  const { user, token } = useAuth();\r\n  const [valoraciones, setValoraciones] = useState<Valoracion[]>([]);\r\n  const [pruebasTrabajo, setPruebasTrabajo] = useState<PruebaTrabajo[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  // Verificar acceso a módulos\r\n  const tieneAccesoValoraciones = user?.rol === 'admin' || user?.acceso_valoraciones !== false;\r\n  const tieneAccesoPruebas = user?.rol === 'admin' || user?.acceso_pruebas_trabajo !== false;\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      const promises: Promise<any>[] = [];\r\n\r\n      if (tieneAccesoValoraciones) {\r\n        promises.push(api.get<{ items: Valoracion[], total: number }>('/valoraciones/?skip=0&limit=5'));\r\n      }\r\n      if (tieneAccesoPruebas) {\r\n        promises.push(api.get<{ items: PruebaTrabajo[], total: number }>('/pruebas-trabajo/?skip=0&limit=5'));\r\n      }\r\n\r\n      const results = await Promise.all(promises);\r\n\r\n      let idx = 0;\r\n      if (tieneAccesoValoraciones) {\r\n        setValoraciones(results[idx]?.items || []);\r\n        idx++;\r\n      }\r\n      if (tieneAccesoPruebas) {\r\n        setPruebasTrabajo(results[idx]?.items || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n    } finally {\r\n      setLoading(false);\r\n      setRefreshing(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (token) fetchData();\r\n  }, [token]);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    fetchData();\r\n  };\r\n\r\n  // Estadísticas de valoraciones\r\n  const statsValoraciones = {\r\n    total: valoraciones.length,\r\n    completadas: valoraciones.filter(v => v.estado === 'completada').length,\r\n    enProceso: valoraciones.filter(v => v.estado === 'revisada').length,\r\n    borradores: valoraciones.filter(v => v.estado === 'borrador').length,\r\n  };\r\n\r\n  // Estadísticas de pruebas de trabajo\r\n  const statsPruebas = {\r\n    total: pruebasTrabajo.length,\r\n    completadas: pruebasTrabajo.filter(p => p.estado === 'completada').length,\r\n    enProceso: pruebasTrabajo.filter(p => p.estado === 'en_proceso').length,\r\n    borradores: pruebasTrabajo.filter(p => p.estado === 'borrador').length,\r\n  };\r\n\r\n  const getEstadoBadge = (estado: string) => {\r\n    switch (estado) {\r\n      case 'completada': return 'bg-emerald-500/10 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400 border border-emerald-500/20';\r\n      case 'revisada':\r\n      case 'en_proceso': return 'bg-amber-500/10 text-amber-600 dark:bg-amber-500/20 dark:text-amber-400 border border-amber-500/20';\r\n      default: return 'bg-slate-500/10 text-slate-600 dark:bg-slate-500/20 dark:text-slate-400 border border-slate-500/20';\r\n    }\r\n  };\r\n\r\n  const getEstadoLabel = (estado: string) => {\r\n    switch (estado) {\r\n      case 'completada': return 'Completada';\r\n      case 'revisada':\r\n      case 'en_proceso': return 'En Proceso';\r\n      default: return 'Borrador';\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diff = now.getTime() - date.getTime();\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    if (hours < 1) return 'Hace unos minutos';\r\n    if (hours < 24) return `Hace ${hours} hora${hours > 1 ? 's' : ''}`;\r\n    const days = Math.floor(hours / 24);\r\n    if (days < 7) return `Hace ${days} día${days > 1 ? 's' : ''}`;\r\n    return date.toLocaleDateString('es-CO', { day: '2-digit', month: 'short', year: 'numeric' });\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      {/* Welcome Header */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n              Bienvenido, <span className=\"bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-transparent\">{user?.nombre}</span>\r\n            </h1>\r\n            <p className=\"text-gray-500 dark:text-[#b0b0b0]\">\r\n              Panel de control - Gestión de evaluaciones psicológicas\r\n            </p>\r\n          </div>\r\n          <div className=\"flex gap-3\">\r\n            <Button\r\n              onClick={handleRefresh}\r\n              variant=\"outline\"\r\n              disabled={refreshing}\r\n              className=\"dark:border-[#333333] dark:hover:bg-[#333333] dark:text-white\"\r\n            >\r\n              <RefreshCcw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\r\n              Actualizar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Resumen General */}\r\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8\">\r\n        {/* Total Valoraciones */}\r\n        {tieneAccesoValoraciones && (\r\n          <Card className=\"relative overflow-hidden border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-500/5 via-transparent to-transparent opacity-50\" />\r\n            <CardContent className=\"p-6 relative\">\r\n              <div className=\"flex items-start justify-between mb-4\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-[#b0b0b0] mb-1\">Valoraciones</p>\r\n                  <p className=\"text-xs text-gray-400 dark:text-[#6b6b6b]\">Psicológicas</p>\r\n                </div>\r\n                <div className=\"p-3 rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                  <ClipboardList className=\"h-5 w-5 text-white\" />\r\n                </div>\r\n              </div>\r\n              {loading ? (\r\n                <div className=\"h-10 w-20 skeleton\"></div>\r\n              ) : (\r\n                <div className=\"flex items-baseline gap-2\">\r\n                  <h3 className=\"text-4xl font-bold text-gray-900 dark:text-white\">{statsValoraciones.total}</h3>\r\n                  <span className=\"text-sm text-emerald-500 font-medium\">{statsValoraciones.completadas} completadas</span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Total Pruebas de Trabajo */}\r\n        {tieneAccesoPruebas && (\r\n          <Card className=\"relative overflow-hidden border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-violet-500/5 via-transparent to-transparent opacity-50\" />\r\n            <CardContent className=\"p-6 relative\">\r\n              <div className=\"flex items-start justify-between mb-4\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-[#b0b0b0] mb-1\">Pruebas</p>\r\n                  <p className=\"text-xs text-gray-400 dark:text-[#6b6b6b]\">de Trabajo</p>\r\n                </div>\r\n                <div className=\"p-3 rounded-xl bg-gradient-to-br from-violet-500 to-violet-600 shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                  <Briefcase className=\"h-5 w-5 text-white\" />\r\n                </div>\r\n              </div>\r\n              {loading ? (\r\n                <div className=\"h-10 w-20 skeleton\"></div>\r\n              ) : (\r\n                <div className=\"flex items-baseline gap-2\">\r\n                  <h3 className=\"text-4xl font-bold text-gray-900 dark:text-white\">{statsPruebas.total}</h3>\r\n                  <span className=\"text-sm text-emerald-500 font-medium\">{statsPruebas.completadas} completadas</span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* En Proceso */}\r\n        <Card className=\"relative overflow-hidden border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n          <div className=\"absolute inset-0 bg-gradient-to-br from-amber-500/5 via-transparent to-transparent opacity-50\" />\r\n          <CardContent className=\"p-6 relative\">\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-[#b0b0b0] mb-1\">En Proceso</p>\r\n                <p className=\"text-xs text-gray-400 dark:text-[#6b6b6b]\">Requieren atención</p>\r\n              </div>\r\n              <div className=\"p-3 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                <Clock className=\"h-5 w-5 text-white\" />\r\n              </div>\r\n            </div>\r\n            {loading ? (\r\n              <div className=\"h-10 w-20 skeleton\"></div>\r\n            ) : (\r\n              <div className=\"flex items-baseline gap-2\">\r\n                <h3 className=\"text-4xl font-bold text-gray-900 dark:text-white\">\r\n                  {(tieneAccesoValoraciones ? statsValoraciones.enProceso : 0) + (tieneAccesoPruebas ? statsPruebas.enProceso : 0)}\r\n                </h3>\r\n                <Activity className=\"h-4 w-4 text-amber-500\" />\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Borradores */}\r\n        <Card className=\"relative overflow-hidden border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n          <div className=\"absolute inset-0 bg-gradient-to-br from-slate-500/5 via-transparent to-transparent opacity-50\" />\r\n          <CardContent className=\"p-6 relative\">\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-[#b0b0b0] mb-1\">Borradores</p>\r\n                <p className=\"text-xs text-gray-400 dark:text-[#6b6b6b]\">Sin finalizar</p>\r\n              </div>\r\n              <div className=\"p-3 rounded-xl bg-gradient-to-br from-slate-500 to-slate-600 shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                <FileEdit className=\"h-5 w-5 text-white\" />\r\n              </div>\r\n            </div>\r\n            {loading ? (\r\n              <div className=\"h-10 w-20 skeleton\"></div>\r\n            ) : (\r\n              <div className=\"flex items-baseline gap-2\">\r\n                <h3 className=\"text-4xl font-bold text-gray-900 dark:text-white\">\r\n                  {(tieneAccesoValoraciones ? statsValoraciones.borradores : 0) + (tieneAccesoPruebas ? statsPruebas.borradores : 0)}\r\n                </h3>\r\n                <FileEdit className=\"h-4 w-4 text-slate-500\" />\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Acciones Rápidas */}\r\n      <div className=\"grid gap-6 md:grid-cols-2 mb-8\">\r\n        {tieneAccesoValoraciones && (\r\n          <Card className=\"border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"p-4 rounded-2xl bg-gradient-to-br from-indigo-500 to-indigo-600 shadow-lg\">\r\n                  <ClipboardList className=\"h-8 w-8 text-white\" />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Valoraciones Psicológicas</h3>\r\n                  <p className=\"text-sm text-gray-500 dark:text-[#b0b0b0]\">Evalúa el estado mental y aptitud laboral</p>\r\n                </div>\r\n                <Link href=\"/dashboard/valoraciones/nueva\">\r\n                  <Button className=\"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 shadow-lg shadow-indigo-500/25 text-white\">\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Nueva\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {tieneAccesoPruebas && (\r\n          <Card className=\"border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a] hover:shadow-xl transition-all duration-300 group\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"p-4 rounded-2xl bg-gradient-to-br from-violet-500 to-violet-600 shadow-lg\">\r\n                  <Briefcase className=\"h-8 w-8 text-white\" />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Pruebas de Trabajo</h3>\r\n                  <p className=\"text-sm text-gray-500 dark:text-[#b0b0b0]\">Evalúa factores de riesgo psicosocial</p>\r\n                </div>\r\n                <Link href=\"/dashboard/pruebas-trabajo/nueva\">\r\n                  <Button className=\"bg-gradient-to-r from-violet-500 to-violet-600 hover:from-violet-600 hover:to-violet-700 shadow-lg shadow-violet-500/25 text-white\">\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Nueva\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </div>\r\n\r\n      {/* Actividad Reciente - Grid de 2 columnas */}\r\n      <div className=\"grid gap-6 lg:grid-cols-2\">\r\n        {/* Valoraciones Recientes */}\r\n        {tieneAccesoValoraciones && (\r\n          <Card className=\"border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a]\">\r\n            <div className=\"p-6 border-b border-gray-200 dark:border-[#333333]\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/30\">\r\n                    <ClipboardList className=\"h-5 w-5 text-indigo-600 dark:text-indigo-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-lg font-bold text-gray-900 dark:text-white\">Valoraciones Recientes</h2>\r\n                    <p className=\"text-xs text-gray-500 dark:text-[#b0b0b0]\">Últimas evaluaciones</p>\r\n                  </div>\r\n                </div>\r\n                <Link href=\"/dashboard/valoraciones\">\r\n                  <Button variant=\"ghost\" size=\"sm\" className=\"gap-1 text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:text-indigo-400 dark:hover:bg-indigo-900/20\">\r\n                    Ver todas\r\n                    <ArrowRight className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </div>\r\n            <CardContent className=\"p-4\">\r\n              {loading ? (\r\n                <div className=\"space-y-3\">\r\n                  {[1, 2, 3].map(i => (\r\n                    <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-[#1a1a1a]\">\r\n                      <div className=\"w-10 h-10 rounded-full skeleton\"></div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <div className=\"h-4 w-32 skeleton\"></div>\r\n                        <div className=\"h-3 w-24 skeleton\"></div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : valoraciones.length > 0 ? (\r\n                <div className=\"space-y-2\">\r\n                  {valoraciones.slice(0, 4).map((v) => (\r\n                    <Link key={v.id} href={`/dashboard/valoraciones/nueva?id=${v.id}&modo=ver`}>\r\n                      <div className=\"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors cursor-pointer group\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white font-bold text-sm\">\r\n                          {v.trabajador_nombre?.charAt(0) || 'N'}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"font-medium text-gray-900 dark:text-white text-sm truncate group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors\">\r\n                            {v.trabajador_nombre || 'Sin nombre'}\r\n                          </p>\r\n                          <p className=\"text-xs text-gray-500 dark:text-[#b0b0b0] truncate\">\r\n                            {v.empresa || 'Sin empresa'} • {formatDate(v.created_at)}\r\n                          </p>\r\n                        </div>\r\n                        <span className={`px-2 py-1 rounded-md text-xs font-medium ${getEstadoBadge(v.estado)}`}>\r\n                          {getEstadoLabel(v.estado)}\r\n                        </span>\r\n                      </div>\r\n                    </Link>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-8\">\r\n                  <ClipboardList className=\"h-10 w-10 text-gray-300 dark:text-gray-600 mx-auto mb-3\" />\r\n                  <p className=\"text-sm text-gray-500 dark:text-[#b0b0b0]\">No hay valoraciones</p>\r\n                  <Link href=\"/dashboard/valoraciones/nueva\">\r\n                    <Button size=\"sm\" className=\"mt-3 bg-indigo-500 hover:bg-indigo-600\">\r\n                      <Plus className=\"h-4 w-4 mr-1\" /> Crear primera\r\n                    </Button>\r\n                  </Link>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Pruebas de Trabajo Recientes */}\r\n        {tieneAccesoPruebas && (\r\n          <Card className=\"border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a]\">\r\n            <div className=\"p-6 border-b border-gray-200 dark:border-[#333333]\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 rounded-lg bg-violet-100 dark:bg-violet-900/30\">\r\n                    <Briefcase className=\"h-5 w-5 text-violet-600 dark:text-violet-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-lg font-bold text-gray-900 dark:text-white\">Pruebas de Trabajo</h2>\r\n                    <p className=\"text-xs text-gray-500 dark:text-[#b0b0b0]\">Últimas evaluaciones</p>\r\n                  </div>\r\n                </div>\r\n                <Link href=\"/dashboard/pruebas-trabajo\">\r\n                  <Button variant=\"ghost\" size=\"sm\" className=\"gap-1 text-violet-600 hover:text-violet-700 hover:bg-violet-50 dark:text-violet-400 dark:hover:bg-violet-900/20\">\r\n                    Ver todas\r\n                    <ArrowRight className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </div>\r\n            <CardContent className=\"p-4\">\r\n              {loading ? (\r\n                <div className=\"space-y-3\">\r\n                  {[1, 2, 3].map(i => (\r\n                    <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-[#1a1a1a]\">\r\n                      <div className=\"w-10 h-10 rounded-full skeleton\"></div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <div className=\"h-4 w-32 skeleton\"></div>\r\n                        <div className=\"h-3 w-24 skeleton\"></div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : pruebasTrabajo.length > 0 ? (\r\n                <div className=\"space-y-2\">\r\n                  {pruebasTrabajo.slice(0, 4).map((p) => (\r\n                    <Link key={p.id} href={`/dashboard/pruebas-trabajo/${p.id}`}>\r\n                      <div className=\"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors cursor-pointer group\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-violet-600 flex items-center justify-center text-white font-bold text-sm\">\r\n                          {p.trabajador_nombre?.charAt(0) || 'N'}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"font-medium text-gray-900 dark:text-white text-sm truncate group-hover:text-violet-600 dark:group-hover:text-violet-400 transition-colors\">\r\n                            {p.trabajador_nombre || 'Sin nombre'}\r\n                          </p>\r\n                          <p className=\"text-xs text-gray-500 dark:text-[#b0b0b0] truncate\">\r\n                            {p.empresa || 'Sin empresa'} • {formatDate(p.fecha_creacion)}\r\n                          </p>\r\n                        </div>\r\n                        <span className={`px-2 py-1 rounded-md text-xs font-medium ${getEstadoBadge(p.estado)}`}>\r\n                          {getEstadoLabel(p.estado)}\r\n                        </span>\r\n                      </div>\r\n                    </Link>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-8\">\r\n                  <Briefcase className=\"h-10 w-10 text-gray-300 dark:text-gray-600 mx-auto mb-3\" />\r\n                  <p className=\"text-sm text-gray-500 dark:text-[#b0b0b0]\">No hay pruebas de trabajo</p>\r\n                  <Link href=\"/dashboard/pruebas-trabajo/nueva\">\r\n                    <Button size=\"sm\" className=\"mt-3 bg-violet-500 hover:bg-violet-600\">\r\n                      <Plus className=\"h-4 w-4 mr-1\" /> Crear primera\r\n                    </Button>\r\n                  </Link>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\pruebas-trabajo\\[id]\\evaluar\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DashboardLayout' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useParams } from 'next/navigation';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { PruebaTrabajoWizard } from '@/components/pruebas-trabajo/PruebaTrabajoWizard';\r\n\r\nexport default function EvaluarPruebaTrabajoPage() {\r\n  const params = useParams();\r\n  const id = params.id ? parseInt(params.id as string) : null;\r\n\r\n  return <PruebaTrabajoWizard mode=\"edit\" id={id} />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\pruebas-trabajo\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\pruebas-trabajo\\nueva\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\pruebas-trabajo\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPruebas'. Either include it or remove the dependency array.","line":91,"column":6,"nodeType":"ArrayExpression","endLine":91,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [page, estadoFilter, fetchPruebas]","fix":{"range":[2483,2503],"text":"[page, estadoFilter, fetchPruebas]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { ModuleGuard } from '@/app/components/guards/ModuleGuard';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { api } from '@/app/services/api';\r\nimport {\r\n  Search,\r\n  Plus,\r\n  Filter,\r\n  Download,\r\n  Eye,\r\n  Pencil,\r\n  Trash2,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Briefcase,\r\n  FileText,\r\n  AlertTriangle,\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { toast } from 'sonner';\r\n\r\ninterface PruebaTrabajo {\r\n  id: number;\r\n  estado: string;\r\n  fecha_creacion: string;\r\n  fecha_actualizacion: string;\r\n  trabajador_nombre?: string;\r\n  trabajador_identificacion?: string;\r\n  empresa?: string;\r\n}\r\n\r\nexport default function PruebasTrabajoPage() {\r\n  const [pruebas, setPruebas] = useState<PruebaTrabajo[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [estadoFilter, setEstadoFilter] = useState('todos');\r\n  const [page, setPage] = useState(1);\r\n  const [total, setTotal] = useState(0);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [pruebaToDelete, setPruebaToDelete] = useState<PruebaTrabajo | null>(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n  const limit = 10;\r\n\r\n  const fetchPruebas = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        skip: String((page - 1) * limit),\r\n        limit: String(limit),\r\n      });\r\n\r\n      if (estadoFilter && estadoFilter !== 'todos') {\r\n        params.append('estado', estadoFilter);\r\n      }\r\n\r\n      const response = await api.get<{ items: PruebaTrabajo[], total: number }>(\r\n        `/pruebas-trabajo/?${params.toString()}`\r\n      );\r\n      setPruebas(response.items || []);\r\n      setTotal(response.total || 0);\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al cargar pruebas de trabajo');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchPruebas();\r\n  }, [page, estadoFilter]);\r\n\r\n  const handleSearch = () => {\r\n    setPage(1);\r\n    fetchPruebas();\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter') handleSearch();\r\n  };\r\n\r\n  const openDeleteDialog = (prueba: PruebaTrabajo) => {\r\n    setPruebaToDelete(prueba);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!pruebaToDelete) return;\r\n\r\n    setDeleting(true);\r\n    try {\r\n      await api.delete(`/pruebas-trabajo/${pruebaToDelete.id}`);\r\n      setDeleteDialogOpen(false);\r\n      setPruebaToDelete(null);\r\n      await fetchPruebas();\r\n      toast.success('Prueba eliminada correctamente');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al eliminar la prueba');\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleDownloadPDF = async (prueba: PruebaTrabajo) => {\r\n    try {\r\n      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app';\r\n      const response = await fetch(\r\n        `${apiUrl}/pruebas-trabajo/${prueba.id}/descargar-pdf`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        // Obtener el mensaje de error específico del servidor\r\n        const errorData = await response.json().catch(() => ({}));\r\n        const errorMessage = errorData.detail || 'Error al descargar PDF';\r\n        throw new Error(errorMessage);\r\n      }\r\n\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      // Usar nombre del trabajador si está disponible\r\n      const nombreArchivo = prueba.trabajador_nombre\r\n        ? `Prueba_Trabajo_${prueba.trabajador_nombre.replace(/\\s+/g, '_')}.pdf`\r\n        : `prueba_trabajo_${prueba.id}.pdf`;\r\n      a.download = nombreArchivo;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      document.body.removeChild(a);\r\n\r\n      toast.success('PDF descargado correctamente');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      const message = error instanceof Error ? error.message : 'Error al descargar el PDF';\r\n      toast.error(message);\r\n    }\r\n  };\r\n\r\n  const totalPages = Math.ceil(total / limit);\r\n\r\n  const estadoBadgeColor = (estado: string) => {\r\n    switch (estado.toLowerCase()) {\r\n      case 'completada':\r\n        return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';\r\n      case 'borrador':\r\n        return 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400';\r\n      default:\r\n        return 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400';\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('es-ES', {\r\n      day: 'numeric',\r\n      month: 'short',\r\n      year: 'numeric',\r\n    });\r\n  };\r\n\r\n  return (\r\n    <ModuleGuard requiredModule=\"pruebas_trabajo\">\r\n      <DashboardLayout>\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3\">\r\n                <Briefcase className=\"w-8 h-8 text-violet-500\" />\r\n                Pruebas de Trabajo\r\n              </h1>\r\n              <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                Gestiona las pruebas de trabajo y evaluaciones de riesgos psicosociales\r\n              </p>\r\n            </div>\r\n            <Link href=\"/dashboard/pruebas-trabajo/nueva\">\r\n              <Button className=\"bg-violet-500 hover:bg-violet-600 text-white shadow-lg shadow-violet-500/25\">\r\n                <Plus className=\"mr-2 h-4 w-4\" />\r\n                Nueva Prueba\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <Card className=\"border-gray-200 dark:border-[#333333]\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex flex-col md:flex-row gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\r\n                    <Input\r\n                      placeholder=\"Buscar por nombre, identificación o empresa...\"\r\n                      value={search}\r\n                      onChange={(e) => setSearch(e.target.value)}\r\n                      onKeyPress={handleKeyPress}\r\n                      className=\"pl-10 bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"w-full md:w-48\">\r\n                  <Select value={estadoFilter} onValueChange={setEstadoFilter}>\r\n                    <SelectTrigger className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\">\r\n                      <Filter className=\"mr-2 h-4 w-4\" />\r\n                      <SelectValue placeholder=\"Estado\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"todos\">Todos</SelectItem>\r\n                      <SelectItem value=\"borrador\">Borrador</SelectItem>\r\n                      <SelectItem value=\"completada\">Completada</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <Button\r\n                  onClick={handleSearch}\r\n                  className=\"bg-violet-500 hover:bg-violet-600 text-white\"\r\n                >\r\n                  <Search className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Table */}\r\n          <Card className=\"border-gray-200 dark:border-[#333333]\">\r\n            <CardContent className=\"p-0\">\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center h-64\">\r\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-violet-500\"></div>\r\n                </div>\r\n              ) : pruebas.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400\">\r\n                  <Briefcase className=\"h-16 w-16 mb-4 opacity-20\" />\r\n                  <p className=\"text-lg font-medium\">No hay pruebas de trabajo</p>\r\n                  <p className=\"text-sm\">Crea una nueva prueba para comenzar</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full\">\r\n                    <thead className=\"bg-gray-50 dark:bg-[#1a1a1a] border-b border-gray-200 dark:border-[#333333]\">\r\n                      <tr>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Trabajador\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Documento\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Empresa\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Fecha\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Estado\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-center text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Acciones\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white dark:bg-[#2a2a2a] divide-y divide-gray-100 dark:divide-[#333333]\">\r\n                      {pruebas.map((prueba) => (\r\n                        <tr\r\n                          key={prueba.id}\r\n                          className=\"hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors\"\r\n                        >\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className=\"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-violet-500 to-violet-600 rounded-full flex items-center justify-center text-white font-bold text-sm\">\r\n                                {prueba.trabajador_nombre\r\n                                  ? prueba.trabajador_nombre.charAt(0).toUpperCase()\r\n                                  : '?'}\r\n                              </div>\r\n                              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                                {prueba.trabajador_nombre || 'Sin nombre'}\r\n                              </span>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                              {prueba.trabajador_identificacion || 'Sin documento'}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300\">\r\n                              <FileText className=\"h-4 w-4 text-gray-400\" />\r\n                              {prueba.empresa || 'Sin empresa'}\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                              {formatDate(prueba.fecha_creacion)}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span\r\n                              className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${estadoBadgeColor(\r\n                                prueba.estado\r\n                              )}`}\r\n                            >\r\n                              {prueba.estado.charAt(0).toUpperCase() + prueba.estado.slice(1)}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center justify-center gap-1\">\r\n                              {/* Ver (solo visualizar) */}\r\n                              <Link href={`/dashboard/pruebas-trabajo/${prueba.id}`}>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  className=\"h-8 w-8 p-0 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-600\"\r\n                                  title=\"Ver detalles\"\r\n                                >\r\n                                  <Eye className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </Link>\r\n\r\n                              {/* Editar (solo para borradores) */}\r\n                              {/* Editar */}\r\n                              <Link href={`/dashboard/pruebas-trabajo/${prueba.id}/evaluar`}>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  className=\"h-8 w-8 p-0 hover:bg-green-100 dark:hover:bg-green-900/30 text-green-600\"\r\n                                  title=\"Editar prueba\"\r\n                                >\r\n                                  <Pencil className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </Link>\r\n\r\n                              {/* Descargar PDF (solo para completadas) */}\r\n                              {prueba.estado.toLowerCase() === 'completada' && (\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => handleDownloadPDF(prueba)}\r\n                                  className=\"h-8 w-8 p-0 hover:bg-purple-100 dark:hover:bg-purple-900/30 text-purple-600\"\r\n                                  title=\"Descargar PDF\"\r\n                                >\r\n                                  <Download className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              )}\r\n\r\n                              {/* Eliminar */}\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                onClick={() => openDeleteDialog(prueba)}\r\n                                className=\"h-8 w-8 p-0 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-500\"\r\n                                title=\"Eliminar\"\r\n                              >\r\n                                <Trash2 className=\"h-4 w-4\" />\r\n                              </Button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n\r\n              {/* Pagination */}\r\n              {!loading && pruebas.length > 0 && (\r\n                <div className=\"px-6 py-4 border-t border-gray-200 dark:border-[#333333] flex items-center justify-between\">\r\n                  <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    Mostrando {(page - 1) * limit + 1} a {Math.min(page * limit, total)} de {total}{' '}\r\n                    resultados\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setPage(page - 1)}\r\n                      disabled={page === 1}\r\n                      className=\"border-gray-200 dark:border-[#333333]\"\r\n                    >\r\n                      <ChevronLeft className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <div className=\"flex items-center gap-2 px-3 text-sm text-gray-700 dark:text-gray-300\">\r\n                      Página {page} de {totalPages || 1}\r\n                    </div>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setPage(page + 1)}\r\n                      disabled={page >= totalPages}\r\n                      className=\"border-gray-200 dark:border-[#333333]\"\r\n                    >\r\n                      <ChevronRight className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Delete Confirmation Modal */}\r\n          <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n            <DialogContent className=\"sm:max-w-md\">\r\n              <DialogHeader>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center\">\r\n                    <AlertTriangle className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <DialogTitle>Eliminar Prueba de Trabajo</DialogTitle>\r\n                    <DialogDescription>\r\n                      Esta acción no se puede deshacer\r\n                    </DialogDescription>\r\n                  </div>\r\n                </div>\r\n              </DialogHeader>\r\n              <div className=\"py-4\">\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                  ¿Estás seguro de que deseas eliminar la prueba de trabajo de{' '}\r\n                  <span className=\"font-semibold text-gray-900 dark:text-white\">\r\n                    {pruebaToDelete?.trabajador_nombre || 'Sin nombre'}\r\n                  </span>\r\n                  ? Se eliminarán todos los datos asociados incluyendo el trabajador, empresa y evaluación.\r\n                </p>\r\n              </div>\r\n              <DialogFooter className=\"gap-2 sm:gap-0\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => setDeleteDialogOpen(false)}\r\n                  disabled={deleting}\r\n                  className=\"border-gray-200 dark:border-[#444444]\"\r\n                >\r\n                  Cancelar\r\n                </Button>\r\n                <Button\r\n                  onClick={handleDelete}\r\n                  disabled={deleting}\r\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n                >\r\n                  {deleting ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\"></div>\r\n                      Eliminando...\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                      Eliminar\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </DialogFooter>\r\n            </DialogContent>\r\n          </Dialog>\r\n        </div>\r\n      </DashboardLayout>\r\n    </ModuleGuard>\r\n  );\r\n}\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\reportes\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[767,770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[767,770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1202,1205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1202,1205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":226,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado &quot;Completada\" tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado &ldquo;Completada\" tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado &#34;Completada\" tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado &rdquo;Completada\" tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":226,"column":63,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado \"Completada&quot; tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado \"Completada&ldquo; tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado \"Completada&#34; tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10908,11144],"text":"\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado \"Completada&rdquo; tienen archivos PDF y Excel disponibles.\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { api } from '@/app/services/api';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  FileSpreadsheet,\r\n  Download,\r\n  FileText,\r\n  AlertCircle,\r\n  ClipboardList,\r\n} from 'lucide-react';\r\n\r\nexport default function ReportesPage() {\r\n  const handleDescargarPlantilla = async () => {\r\n    try {\r\n      toast.info('Preparando plantilla Excel...');\r\n\r\n      await api.downloadFile('/reportes/plantilla', 'plantilla_valoracion_psicologica.xlsx');\r\n\r\n      toast.success('Plantilla descargada exitosamente');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al descargar la plantilla');\r\n    }\r\n  };\r\n\r\n  const handleDescargarPlantillaPruebaTrabajo = async () => {\r\n    try {\r\n      toast.info('Preparando plantilla de Prueba de Trabajo...');\r\n\r\n      await api.downloadFile('/reportes/plantilla-prueba-trabajo', 'Plantilla_Prueba_Trabajo_Esfera_Mental.xlsx');\r\n\r\n      toast.success('Plantilla descargada exitosamente');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al descargar la plantilla');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100\">\r\n            Descargas y Reportes\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-400 mt-2\">\r\n            Descargue plantillas y genere reportes del sistema\r\n          </p>\r\n        </div>\r\n\r\n        {/* Alert Info */}\r\n        <div className=\"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <AlertCircle className=\"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\r\n            <div className=\"flex-1\">\r\n              <p className=\"text-sm text-blue-800 dark:text-blue-300\">\r\n                <strong>Nota:</strong> Los reportes de valoraciones completadas pueden ser descargados desde el módulo de Valoraciones en formato PDF y Excel.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Plantilla Section */}\r\n        <Card className=\"border-2 border-gray-200 dark:border-slate-700\">\r\n          <CardHeader className=\"border-b border-gray-200 dark:border-slate-700 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-lg bg-green-600 flex items-center justify-center\">\r\n                <FileSpreadsheet className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <CardTitle className=\"text-xl\">Plantilla Excel de Valoración</CardTitle>\r\n                <CardDescription>\r\n                  Plantilla oficial para valoraciones psicológicas\r\n                </CardDescription>\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-start gap-3\">\r\n                <FileText className=\"h-5 w-5 text-gray-400 flex-shrink-0 mt-1\" />\r\n                <div className=\"flex-1\">\r\n                  <h3 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n                    ¿Qué incluye esta plantilla?\r\n                  </h3>\r\n                  <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Formato completo de identificación del trabajador</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Sección de información laboral y historia ocupacional</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Evaluación de factores de riesgo psicosocial (7 categorías)</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Espacio para concepto psicológico final y recomendaciones</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Sección de firmas y validación profesional</span>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"pt-4 border-t border-gray-200 dark:border-slate-700\">\r\n                <Button\r\n                  onClick={handleDescargarPlantilla}\r\n                  className=\"w-full md:w-auto gap-2 bg-green-600 hover:bg-green-700 text-white\"\r\n                  size=\"lg\"\r\n                >\r\n                  <Download className=\"h-5 w-5\" />\r\n                  Descargar Plantilla Excel\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Plantilla Prueba de Trabajo Section */}\r\n        <Card className=\"border-2 border-gray-200 dark:border-slate-700\">\r\n          <CardHeader className=\"border-b border-gray-200 dark:border-slate-700 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-lg bg-green-600 flex items-center justify-center\">\r\n                <ClipboardList className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <CardTitle className=\"text-xl\">Plantilla Prueba de Trabajo de Esfera Mental</CardTitle>\r\n                <CardDescription>\r\n                  Plantilla oficial para evaluaciones de riesgo psicosocial en el trabajo\r\n                </CardDescription>\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-start gap-3\">\r\n                <FileText className=\"h-5 w-5 text-gray-400 flex-shrink-0 mt-1\" />\r\n                <div className=\"flex-1\">\r\n                  <h3 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n                    ¿Qué incluye esta plantilla?\r\n                  </h3>\r\n                  <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Datos de identificación de la empresa</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Información completa del trabajador evaluado</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Evaluación de 7 dimensiones de riesgo psicosocial</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Resumen de factores de riesgo detectados</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <span className=\"text-green-600 dark:text-green-400 font-bold\">•</span>\r\n                      <span>Espacio para conclusiones y recomendaciones</span>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"pt-4 border-t border-gray-200 dark:border-slate-700\">\r\n                <Button\r\n                  onClick={handleDescargarPlantillaPruebaTrabajo}\r\n                  className=\"w-full md:w-auto gap-2 bg-green-600 hover:bg-green-700 text-white\"\r\n                  size=\"lg\"\r\n                >\r\n                  <Download className=\"h-5 w-5\" />\r\n                  Descargar Plantilla Excel\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Información Adicional */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Información sobre reportes</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-4 rounded-lg bg-gray-50 dark:bg-slate-800/50\">\r\n                <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2\">\r\n                  <FileSpreadsheet className=\"h-4 w-4 text-green-600\" />\r\n                  Formato Excel\r\n                </h4>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  Los archivos Excel generados utilizan la plantilla oficial y pueden ser editados posteriormente.\r\n                  Son ideales para compartir con otros profesionales o hacer ajustes manuales.\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"p-4 rounded-lg bg-gray-50 dark:bg-slate-800/50\">\r\n                <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2\">\r\n                  <FileText className=\"h-4 w-4 text-indigo-500\" />\r\n                  Formato PDF\r\n                </h4>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  Los archivos PDF son documentos profesionales con formato fijo, ideales para impresión\r\n                  y presentación oficial. No pueden ser editados pero mantienen el formato intacto.\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"p-4 rounded-lg bg-gray-50 dark:bg-slate-800/50\">\r\n                <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2\">\r\n                  <Download className=\"h-4 w-4 text-blue-600\" />\r\n                  Acceso a reportes guardados\r\n                </h4>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  Los reportes de valoraciones completadas se pueden descargar desde la lista de valoraciones.\r\n                  Solo las valoraciones con estado \"Completada\" tienen archivos PDF y Excel disponibles.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\usuarios\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2625,2628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2625,2628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5712,5715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5712,5715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6181,6184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6181,6184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { api } from '@/app/services/api';\r\nimport { toast } from 'sonner';\r\nimport {\r\n    Users,\r\n    Plus,\r\n    Pencil,\r\n    Trash2,\r\n    Search,\r\n    Shield,\r\n    ShieldCheck,\r\n    User,\r\n    Mail,\r\n    Lock,\r\n    ClipboardList,\r\n    Briefcase,\r\n    CheckCircle,\r\n    XCircle,\r\n    FileText,\r\n} from 'lucide-react';\r\n\r\ninterface Usuario {\r\n    id: number;\r\n    email: string;\r\n    nombre: string;\r\n    apellido: string;\r\n    rol: 'admin' | 'supervisor' | 'psicologo' | 'terapeuta_ocupacional';\r\n    activo: boolean;\r\n    acceso_valoraciones: boolean;\r\n    acceso_pruebas_trabajo: boolean;\r\n    acceso_formatos_to: boolean;\r\n    created_at: string;\r\n}\r\n\r\ninterface UsuarioForm {\r\n    email: string;\r\n    nombre: string;\r\n    apellido: string;\r\n    rol: 'admin' | 'supervisor' | 'psicologo' | 'terapeuta_ocupacional';\r\n    password: string;\r\n    acceso_valoraciones: boolean;\r\n    acceso_pruebas_trabajo: boolean;\r\n    acceso_formatos_to: boolean;\r\n    activo: boolean;\r\n}\r\n\r\nconst initialFormState: UsuarioForm = {\r\n    email: '',\r\n    nombre: '',\r\n    apellido: '',\r\n    rol: 'psicologo',\r\n    password: '',\r\n    acceso_valoraciones: true,\r\n    acceso_pruebas_trabajo: true,\r\n    acceso_formatos_to: false,\r\n    activo: true,\r\n};\r\n\r\nexport default function UsuariosPage() {\r\n    const [usuarios, setUsuarios] = useState<Usuario[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [search, setSearch] = useState('');\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [deleteModalOpen, setDeleteModalOpen] = useState(false);\r\n    const [selectedUsuario, setSelectedUsuario] = useState<Usuario | null>(null);\r\n    const [formData, setFormData] = useState<UsuarioForm>(initialFormState);\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchUsuarios();\r\n    }, []);\r\n\r\n    const fetchUsuarios = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await api.get<Usuario[]>('/usuarios/');\r\n            setUsuarios(data);\r\n        } catch (error: any) {\r\n            toast.error(error.message || 'Error al cargar usuarios');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleOpenCreate = () => {\r\n        setSelectedUsuario(null);\r\n        setFormData(initialFormState);\r\n        setModalOpen(true);\r\n    };\r\n\r\n    const handleOpenEdit = (usuario: Usuario) => {\r\n        setSelectedUsuario(usuario);\r\n        setFormData({\r\n            email: usuario.email,\r\n            nombre: usuario.nombre,\r\n            apellido: usuario.apellido,\r\n            rol: usuario.rol,\r\n            password: '', // No mostramos la contraseña\r\n            acceso_valoraciones: usuario.acceso_valoraciones ?? false,\r\n            acceso_pruebas_trabajo: usuario.acceso_pruebas_trabajo ?? false,\r\n            acceso_formatos_to: usuario.acceso_formatos_to ?? false,\r\n            activo: usuario.activo ?? true,\r\n        });\r\n        setModalOpen(true);\r\n    };\r\n\r\n    const handleOpenDelete = (usuario: Usuario) => {\r\n        setSelectedUsuario(usuario);\r\n        setDeleteModalOpen(true);\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        // Validaciones\r\n        if (!formData.nombre.trim() || !formData.apellido.trim()) {\r\n            toast.error('Nombre y apellido son requeridos');\r\n            return;\r\n        }\r\n        if (!formData.email.trim()) {\r\n            toast.error('El email es requerido');\r\n            return;\r\n        }\r\n        if (!selectedUsuario && !formData.password.trim()) {\r\n            toast.error('La contraseña es requerida para nuevos usuarios');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setSaving(true);\r\n            if (selectedUsuario) {\r\n                // Actualizar\r\n                await api.put(`/usuarios/${selectedUsuario.id}`, {\r\n                    nombre: formData.nombre,\r\n                    apellido: formData.apellido,\r\n                    rol: formData.rol,\r\n                    activo: formData.activo,\r\n                    acceso_valoraciones: formData.acceso_valoraciones,\r\n                    acceso_pruebas_trabajo: formData.acceso_pruebas_trabajo,\r\n                    acceso_formatos_to: formData.acceso_formatos_to,\r\n                    ...(formData.password.trim() && { password: formData.password }),\r\n                });\r\n                toast.success('Usuario actualizado correctamente');\r\n            } else {\r\n                // Crear\r\n                await api.post('/usuarios/', {\r\n                    email: formData.email,\r\n                    nombre: formData.nombre,\r\n                    apellido: formData.apellido,\r\n                    rol: formData.rol,\r\n                    password: formData.password,\r\n                    acceso_valoraciones: formData.acceso_valoraciones,\r\n                    acceso_pruebas_trabajo: formData.acceso_pruebas_trabajo,\r\n                    acceso_formatos_to: formData.acceso_formatos_to,\r\n                });\r\n                toast.success('Usuario creado correctamente');\r\n            }\r\n            setModalOpen(false);\r\n            fetchUsuarios();\r\n        } catch (error: any) {\r\n            toast.error(error.message || 'Error al guardar usuario');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!selectedUsuario) return;\r\n        try {\r\n            await api.delete(`/usuarios/${selectedUsuario.id}`);\r\n            toast.success('Usuario eliminado correctamente');\r\n            setDeleteModalOpen(false);\r\n            fetchUsuarios();\r\n        } catch (error: any) {\r\n            toast.error(error.message || 'Error al eliminar usuario');\r\n        }\r\n    };\r\n\r\n    const filteredUsuarios = usuarios.filter((u) => {\r\n        const searchLower = search.toLowerCase();\r\n        return (\r\n            u.nombre.toLowerCase().includes(searchLower) ||\r\n            u.apellido.toLowerCase().includes(searchLower) ||\r\n            u.email.toLowerCase().includes(searchLower)\r\n        );\r\n    });\r\n\r\n    const getRolBadge = (rol: string) => {\r\n        const badges = {\r\n            admin: { label: 'Administrador', icon: Shield, color: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400' },\r\n            supervisor: { label: 'Supervisor', icon: ShieldCheck, color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' },\r\n            psicologo: { label: 'Psicólogo', icon: User, color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' },\r\n            terapeuta_ocupacional: { label: 'Terapeuta Ocupacional', icon: Briefcase, color: 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400' },\r\n        };\r\n        const badge = badges[rol as keyof typeof badges] || badges.psicologo;\r\n        const Icon = badge.icon;\r\n        return (\r\n            <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${badge.color}`}>\r\n                <Icon className=\"h-3 w-3\" />\r\n                {badge.label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-6\">\r\n                {/* Header */}\r\n                <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-3\">\r\n                            <Users className=\"h-8 w-8 text-indigo-500\" />\r\n                            Gestión de Usuarios\r\n                        </h1>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Administre los usuarios y sus permisos de acceso\r\n                        </p>\r\n                    </div>\r\n                    <Button\r\n                        onClick={handleOpenCreate}\r\n                        className=\"gap-2 bg-indigo-500 hover:bg-indigo-600 text-white\"\r\n                    >\r\n                        <Plus className=\"h-4 w-4\" />\r\n                        Nuevo Usuario\r\n                    </Button>\r\n                </div>\r\n\r\n                {/* Search */}\r\n                <form onSubmit={(e) => e.preventDefault()} autoComplete=\"off\" className=\"relative max-w-md\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                    <Input\r\n                        id=\"search_query_safe\"\r\n                        name=\"search_query_safe\"\r\n                        placeholder=\"Buscar por nombre o email...\"\r\n                        value={search}\r\n                        onChange={(e) => setSearch(e.target.value)}\r\n                        className=\"pl-10\"\r\n                        autoComplete=\"off\"\r\n                        data-lpignore=\"true\" // Agnostic attribute for LastPass/others\r\n                    />\r\n                </form>\r\n\r\n                {/* Users Table */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <Users className=\"h-5 w-5\" />\r\n                            Usuarios ({filteredUsuarios.length})\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-0\">\r\n                        {loading ? (\r\n                            <div className=\"text-center py-12\">\r\n                                <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mx-auto\"></div>\r\n                                <p className=\"mt-3 text-gray-500\">Cargando usuarios...</p>\r\n                            </div>\r\n                        ) : filteredUsuarios.length === 0 ? (\r\n                            <div className=\"text-center py-12 text-gray-500\">\r\n                                <Users className=\"h-12 w-12 mx-auto mb-3 text-gray-300\" />\r\n                                No se encontraron usuarios\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"overflow-x-auto\">\r\n                                <table className=\"w-full border-collapse\">\r\n                                    <thead>\r\n                                        <tr className=\"bg-gray-50 dark:bg-gray-800/50\">\r\n                                            <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700\">\r\n                                                Usuario\r\n                                            </th>\r\n                                            <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700\">\r\n                                                Rol\r\n                                            </th>\r\n                                            <th className=\"px-6 py-4 text-center text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700\">\r\n                                                Acceso a Módulos\r\n                                            </th>\r\n                                            <th className=\"px-6 py-4 text-center text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700\">\r\n                                                Estado\r\n                                            </th>\r\n                                            <th className=\"px-6 py-4 text-center text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700\">\r\n                                                Acciones\r\n                                            </th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                                        {filteredUsuarios.map((usuario, index) => (\r\n                                            <tr\r\n                                                key={usuario.id}\r\n                                                className={`transition-colors hover:bg-orange-50 dark:hover:bg-orange-900/10 ${index % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50/50 dark:bg-gray-800/30'\r\n                                                    }`}\r\n                                            >\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white font-bold text-sm shadow-sm\">\r\n                                                            {usuario.nombre.charAt(0)}{usuario.apellido.charAt(0)}\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <p className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                                                {usuario.nombre} {usuario.apellido}\r\n                                                            </p>\r\n                                                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">{usuario.email}</p>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    {getRolBadge(usuario.rol)}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <div className=\"flex items-center justify-center gap-4\">\r\n                                                        <div className=\"flex items-center gap-2\" title=\"Valoraciones Psicológicas\">\r\n                                                            <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-medium ${usuario.acceso_valoraciones\r\n                                                                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n                                                                : 'bg-gray-100 text-gray-400 dark:bg-gray-800 dark:text-gray-500'\r\n                                                                }`}>\r\n                                                                <ClipboardList className=\"h-3.5 w-3.5\" />\r\n                                                                <span className=\"hidden sm:inline\">Val.</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\" title=\"Pruebas de Trabajo\">\r\n                                                            <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-medium ${usuario.acceso_pruebas_trabajo\r\n                                                                ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'\r\n                                                                : 'bg-gray-100 text-gray-400 dark:bg-gray-800 dark:text-gray-500'\r\n                                                                }`}>\r\n                                                                <Briefcase className=\"h-3.5 w-3.5\" />\r\n                                                                <span className=\"hidden sm:inline\">P.T.</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\" title=\"Formatos TO\">\r\n                                                            <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-medium ${usuario.acceso_formatos_to\r\n                                                                ? 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400'\r\n                                                                : 'bg-gray-100 text-gray-400 dark:bg-gray-800 dark:text-gray-500'\r\n                                                                }`}>\r\n                                                                <FileText className=\"h-3.5 w-3.5\" />\r\n                                                                <span className=\"hidden sm:inline\">F.TO</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-center\">\r\n                                                    <span className={`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold ${usuario.activo\r\n                                                        ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n                                                        : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'\r\n                                                        }`}>\r\n                                                        {usuario.activo ? (\r\n                                                            <><CheckCircle className=\"h-3.5 w-3.5\" /> Activo</>\r\n                                                        ) : (\r\n                                                            <><XCircle className=\"h-3.5 w-3.5\" /> Inactivo</>\r\n                                                        )}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <div className=\"flex items-center justify-center gap-1\">\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"sm\"\r\n                                                            onClick={() => handleOpenEdit(usuario)}\r\n                                                            className=\"h-9 w-9 p-0 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-600\"\r\n                                                            title=\"Editar usuario\"\r\n                                                        >\r\n                                                            <Pencil className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"sm\"\r\n                                                            onClick={() => handleOpenDelete(usuario)}\r\n                                                            className=\"h-9 w-9 p-0 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600\"\r\n                                                            title=\"Eliminar usuario\"\r\n                                                        >\r\n                                                            <Trash2 className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Modal Crear/Editar Usuario */}\r\n            <Dialog open={modalOpen} onOpenChange={setModalOpen}>\r\n                <DialogContent className=\"sm:max-w-[500px]\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            {selectedUsuario ? <Pencil className=\"h-5 w-5\" /> : <Plus className=\"h-5 w-5\" />}\r\n                            {selectedUsuario ? 'Editar Usuario' : 'Nuevo Usuario'}\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            {selectedUsuario\r\n                                ? 'Modifique los datos del usuario. Deje la contraseña vacía para mantener la actual.'\r\n                                : 'Complete los datos para crear un nuevo usuario.'}\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"space-y-4 py-4\">\r\n                        {/* Nombre y Apellido */}\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"nombre\">Nombre</Label>\r\n                                <Input\r\n                                    id=\"nombre\"\r\n                                    value={formData.nombre}\r\n                                    onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}\r\n                                    placeholder=\"Nombre\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"apellido\">Apellido</Label>\r\n                                <Input\r\n                                    id=\"apellido\"\r\n                                    value={formData.apellido}\r\n                                    onChange={(e) => setFormData({ ...formData, apellido: e.target.value })}\r\n                                    placeholder=\"Apellido\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Email */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"email\" className=\"flex items-center gap-2\">\r\n                                <Mail className=\"h-4 w-4\" />\r\n                                Email\r\n                            </Label>\r\n                            <Input\r\n                                id=\"email\"\r\n                                type=\"email\"\r\n                                value={formData.email}\r\n                                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                placeholder=\"correo@ejemplo.com\"\r\n                                disabled={!!selectedUsuario}\r\n                            />\r\n                            {selectedUsuario && (\r\n                                <p className=\"text-xs text-gray-500\">El email no se puede modificar</p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Contraseña */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"password\" className=\"flex items-center gap-2\">\r\n                                <Lock className=\"h-4 w-4\" />\r\n                                Contraseña {selectedUsuario && '(dejar vacío para mantener)'}\r\n                            </Label>\r\n                            <Input\r\n                                id=\"password\"\r\n                                type=\"password\"\r\n                                value={formData.password}\r\n                                onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                                placeholder={selectedUsuario ? '••••••••' : 'Contraseña'}\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Rol */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Rol</Label>\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, rol: 'psicologo' })}\r\n                                    className={`flex flex-col items-center gap-1 p-3 rounded-lg border-2 transition-all ${formData.rol === 'psicologo'\r\n                                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                        }`}\r\n                                >\r\n                                    <User className={`h-5 w-5 ${formData.rol === 'psicologo' ? 'text-green-600' : 'text-gray-400'}`} />\r\n                                    <span className={`text-xs font-medium ${formData.rol === 'psicologo' ? 'text-green-700 dark:text-green-400' : 'text-gray-600 dark:text-gray-400'}`}>\r\n                                        Psicólogo\r\n                                    </span>\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, rol: 'terapeuta_ocupacional' })}\r\n                                    className={`flex flex-col items-center gap-1 p-3 rounded-lg border-2 transition-all ${formData.rol === 'terapeuta_ocupacional'\r\n                                        ? 'border-teal-500 bg-teal-50 dark:bg-teal-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                        }`}\r\n                                >\r\n                                    <Briefcase className={`h-5 w-5 ${formData.rol === 'terapeuta_ocupacional' ? 'text-teal-600' : 'text-gray-400'}`} />\r\n                                    <span className={`text-xs font-medium ${formData.rol === 'terapeuta_ocupacional' ? 'text-teal-700 dark:text-teal-400' : 'text-gray-600 dark:text-gray-400'}`}>\r\n                                        T. Ocupacional\r\n                                    </span>\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, rol: 'supervisor' })}\r\n                                    className={`flex flex-col items-center gap-1 p-3 rounded-lg border-2 transition-all ${formData.rol === 'supervisor'\r\n                                        ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                        }`}\r\n                                >\r\n                                    <ShieldCheck className={`h-5 w-5 ${formData.rol === 'supervisor' ? 'text-blue-600' : 'text-gray-400'}`} />\r\n                                    <span className={`text-xs font-medium ${formData.rol === 'supervisor' ? 'text-blue-700 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'}`}>\r\n                                        Supervisor\r\n                                    </span>\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, rol: 'admin' })}\r\n                                    className={`flex flex-col items-center gap-1 p-3 rounded-lg border-2 transition-all ${formData.rol === 'admin'\r\n                                        ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                        }`}\r\n                                >\r\n                                    <Shield className={`h-5 w-5 ${formData.rol === 'admin' ? 'text-purple-600' : 'text-gray-400'}`} />\r\n                                    <span className={`text-xs font-medium ${formData.rol === 'admin' ? 'text-purple-700 dark:text-purple-400' : 'text-gray-600 dark:text-gray-400'}`}>\r\n                                        Admin\r\n                                    </span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Acceso a Módulos */}\r\n                        <div className=\"space-y-3\">\r\n                            <Label>Acceso a Módulos</Label>\r\n                            <div className=\"space-y-2 rounded-lg border p-3\">\r\n                                <div className=\"flex items-center space-x-2\">\r\n                                    <Checkbox\r\n                                        id=\"acceso_valoraciones\"\r\n                                        checked={formData.acceso_valoraciones}\r\n                                        onCheckedChange={(checked) =>\r\n                                            setFormData({ ...formData, acceso_valoraciones: !!checked })\r\n                                        }\r\n                                    />\r\n                                    <label htmlFor=\"acceso_valoraciones\" className=\"flex items-center gap-2 text-sm cursor-pointer\">\r\n                                        <ClipboardList className=\"h-4 w-4 text-green-600\" />\r\n                                        Valoraciones Psicológicas\r\n                                    </label>\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2\">\r\n                                    <Checkbox\r\n                                        id=\"acceso_pruebas_trabajo\"\r\n                                        checked={formData.acceso_pruebas_trabajo}\r\n                                        onCheckedChange={(checked) =>\r\n                                            setFormData({ ...formData, acceso_pruebas_trabajo: !!checked })\r\n                                        }\r\n                                    />\r\n                                    <label htmlFor=\"acceso_pruebas_trabajo\" className=\"flex items-center gap-2 text-sm cursor-pointer\">\r\n                                        <Briefcase className=\"h-4 w-4 text-blue-600\" />\r\n                                        Pruebas de Trabajo\r\n                                    </label>\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2\">\r\n                                    <Checkbox\r\n                                        id=\"acceso_formatos_to\"\r\n                                        checked={formData.acceso_formatos_to}\r\n                                        onCheckedChange={(checked) =>\r\n                                            setFormData({ ...formData, acceso_formatos_to: !!checked })\r\n                                        }\r\n                                    />\r\n                                    <label htmlFor=\"acceso_formatos_to\" className=\"flex items-center gap-2 text-sm cursor-pointer\">\r\n                                        <FileText className=\"h-4 w-4 text-teal-600\" />\r\n                                        Formatos TO\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Estado Activo */}\r\n                        {selectedUsuario && (\r\n                            <div className=\"flex items-center space-x-2\">\r\n                                <Checkbox\r\n                                    id=\"activo\"\r\n                                    checked={formData.activo}\r\n                                    onCheckedChange={(checked) =>\r\n                                        setFormData({ ...formData, activo: !!checked })\r\n                                    }\r\n                                />\r\n                                <label htmlFor=\"activo\" className=\"text-sm cursor-pointer\">\r\n                                    Usuario activo\r\n                                </label>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setModalOpen(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleSave}\r\n                            disabled={saving}\r\n                            className=\"bg-indigo-500 hover:bg-indigo-600 text-white\"\r\n                        >\r\n                            {saving ? 'Guardando...' : selectedUsuario ? 'Guardar Cambios' : 'Crear Usuario'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal Eliminar */}\r\n            <Dialog open={deleteModalOpen} onOpenChange={setDeleteModalOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"text-red-600 flex items-center gap-2\">\r\n                            <Trash2 className=\"h-5 w-5\" />\r\n                            Eliminar Usuario\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            ¿Está seguro que desea eliminar el usuario{' '}\r\n                            <strong>\r\n                                {selectedUsuario?.nombre} {selectedUsuario?.apellido}\r\n                            </strong>\r\n                            ? Esta acción no se puede deshacer.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setDeleteModalOpen(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            className=\"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-500/25\"\r\n                            onClick={handleDelete}\r\n                        >\r\n                            Eliminar\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </DashboardLayout>\r\n    );\r\n}\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\valoraciones\\nueva\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileSpreadsheet' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9528,9531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9528,9531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_key' is defined but never used.","line":268,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":268,"endColumn":50},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cargarValoracion'. Either include it or remove the dependency array.","line":304,"column":6,"nodeType":"ArrayExpression","endLine":304,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [cargarValoracion, searchParams]","fix":{"range":[11772,11786],"text":"[cargarValoracion, searchParams]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11912,11915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11912,11915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17203,17206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17203,17206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":456,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":456,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19389,19392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19389,19392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20613,20616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20613,20616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":554,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22639,22642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22639,22642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":667,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":667,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28616,28619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28616,28619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":684,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":684,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29162,29165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29162,29165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":716,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":716,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30181,30184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30181,30184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":729,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":729,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30637,30640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30637,30640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":744,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":744,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31133,31136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31133,31136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":771,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":771,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32132,32135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32132,32135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":806,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":806,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33547,33550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33547,33550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1879,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1879,"endColumn":35}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\r\nimport { Modal } from '@/components/ui/modal';\r\nimport { FileUpload } from '@/components/ui/file-upload';\r\nimport { api } from '@/app/services/api';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  User,\r\n  Briefcase,\r\n  History,\r\n  Activity,\r\n  AlertTriangle,\r\n  FileText,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Save,\r\n  Check,\r\n  Loader2,\r\n  Download,\r\n  FileSpreadsheet,\r\n} from 'lucide-react';\r\n\r\nconst steps = [\r\n  { id: 1, title: 'Identificación', icon: User },\r\n  { id: 2, title: 'Info Laboral', icon: Briefcase },\r\n  { id: 3, title: 'Historia Ocupacional', icon: History },\r\n  { id: 4, title: 'Actividad Laboral', icon: Activity },\r\n  { id: 5, title: 'Factores de Riesgo', icon: AlertTriangle },\r\n  { id: 6, title: 'Concepto Final', icon: FileText },\r\n];\r\n\r\n// Factores de riesgo según la plantilla Excel\r\nconst factoresRiesgo = {\r\n  demandas_cuantitativas: {\r\n    titulo: 'DEMANDAS CUANTITATIVAS DEL TRABAJO',\r\n    items: [\r\n      'Ritmo de trabajo acelerado o bajo presión de tiempo',\r\n      'Imposibilidad de hacer pausas dentro de la jornada',\r\n      'Tiempo adicional para cumplir con el trabajo asignado',\r\n      'Volumen de carga laboral',\r\n    ]\r\n  },\r\n  demandas_carga_mental: {\r\n    titulo: 'Demandas de Carga Mental',\r\n    items: [\r\n      'Exigencia de memoria, atención y concentración',\r\n      'Exigencia de altos niveles de detalle o precisión',\r\n      'Elevada cantidad de Información que se usa bajo presión de tiempo',\r\n      'Elevada cantidad de información que se usa de forma simultánea',\r\n      'La información necesaria para realizar el trabajo es compleja',\r\n      'Ejecución de tareas de alta carga cognitiva',\r\n      'Cantidad de tareas que exigen realización bajo presión de tiempo',\r\n      'Percepción de agotamiento al final de la jornada',\r\n    ]\r\n  },\r\n  demandas_emocionales: {\r\n    titulo: 'Demandas Emocionales',\r\n    items: [\r\n      'Exposición a sentimientos, emociones y trato negativo de usuarios o clientes',\r\n      'Exposición a situaciones emocionalmente devastadoras',\r\n      'Impacto emocional de la tarea en el ámbito extralaboral',\r\n      'Posibilidad de cometer errores dentro de la realización de la tarea que afecten el resultado de los procesos',\r\n      'Grado de tensión sobre la realización de la tarea',\r\n      'Percepción de monotonía o actividad repetitiva de la tarea',\r\n    ]\r\n  },\r\n  exigencias_responsabilidad: {\r\n    titulo: 'Exigencias de Responsabilidad del Cargo',\r\n    items: [\r\n      'Responsabilidad directa por la vida, salud o seguridad de otras personas',\r\n      'Responsabilidad directa por supervisión de personal',\r\n      'Responsabilidad directa por resultados del área de trabajo',\r\n      'Responsabilidad directa por bienes de elevada cuantía',\r\n      'Responsabilidad directa por dinero de la organización',\r\n      'Responsabilidad directa por información confidencial',\r\n    ]\r\n  },\r\n  consistencia_rol: {\r\n    titulo: 'Consistencia de Rol',\r\n    items: [\r\n      'Falta de recursos, personas o herramientas necesarias para desarrollar el trabajo',\r\n      'Órdenes contradictorias provenientes de una o varias personas',\r\n      'Solicitudes o requerimientos innecesarios en el trabajo',\r\n      'Solicitudes o requerimientos que van en contra de principios éticos, técnicos, de seguridad o de calidad o servicio del producto',\r\n      'Variación eventual o continua de la tarea asignada',\r\n      'Realización de tareas simultáneas',\r\n      'Las tareas exigen actualización de conocimientos de manera constante',\r\n    ]\r\n  },\r\n  demandas_ambientales: {\r\n    titulo: 'Demandas Ambientales y de Esfuerzo Físico',\r\n    items: [\r\n      'Ruido que afecta negativamente la calidad de la tarea',\r\n      'Iluminación que afecta negativamente la calidad de la tarea',\r\n      'Temperatura que afecta negativamente',\r\n      'Condiciones de Ventilación que afecten negativamente la calidad de la tarea',\r\n      'Distribución y características del puesto, equipos o herramientas que afectan negativamente la calidad de la tarea',\r\n      'Condiciones de orden y aseo que afecten negativamente la calidad de la tarea',\r\n      'Preocupación por exposición a agentes biológicos',\r\n      'Preocupación por exposición a agentes químicos',\r\n      'Exigencias de esfuerzo físico que afectan negativamente la calidad de la tarea',\r\n      'Preocupación ante la posibilidad de sufrir un accidente de trabajo',\r\n    ]\r\n  },\r\n  demandas_jornada: {\r\n    titulo: 'Demandas de la Jornada de Trabajo',\r\n    items: [\r\n      'Trabajo en horario nocturno',\r\n      'Días de trabajo consecutivo sin descanso',\r\n    ]\r\n  },\r\n};\r\n\r\nexport default function NuevaValoracionPage() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [saving, setSaving] = useState(false);\r\n  const [generandoConcepto, setGenerandoConcepto] = useState(false);\r\n  const [finalizando, setFinalizando] = useState(false);\r\n  const [cargando, setCargando] = useState(false);\r\n  const [modoVista, setModoVista] = useState(false); // true = solo lectura\r\n  const [valoracionId, setValoracionId] = useState<number | null>(null);\r\n  const [alertasRiesgo, setAlertasRiesgo] = useState<string[]>([]);\r\n  const [showValidationModal, setShowValidationModal] = useState(false);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n  const [showDownloadModal, setShowDownloadModal] = useState(false);\r\n  const [downloadUrls, setDownloadUrls] = useState<{ pdf_url: string; pdf_filename: string; excel_url: string; excel_filename: string } | null>(null);\r\n\r\n  // Form data - Exactamente como la plantilla Excel\r\n  const [formData, setFormData] = useState({\r\n    // FECHA DE VALORACIÓN\r\n    fecha_valoracion_dia: '',\r\n    fecha_valoracion_mes: '',\r\n    fecha_valoracion_ano: '',\r\n\r\n    // IDENTIFICACIÓN\r\n    nombre_trabajador: '',\r\n    tipo_documento: '', // CC, TI, CE, PEP, PPT\r\n    numero_documento: '',\r\n    identificacion_siniestro: '',\r\n    fecha_nacimiento_dia: '',\r\n    fecha_nacimiento_mes: '',\r\n    fecha_nacimiento_ano: '',\r\n    edad: '',\r\n    estado_civil: '', // casado, soltero, union_libre, separado, viudo\r\n\r\n    // Nivel educativo (checkboxes)\r\n    nivel_formacion_empirica: false,\r\n    nivel_basica_primaria: false,\r\n    nivel_bachillerato_vocacional: false,\r\n    nivel_bachillerato_modalidad: false,\r\n    nivel_tecnico_tecnologico: false,\r\n    nivel_universitario: false,\r\n    nivel_especializacion: false,\r\n    nivel_formacion_informal: false,\r\n    nivel_analfabeta: false,\r\n    especificar_formacion_oficios: '',\r\n\r\n    telefonos_trabajador: '',\r\n    direccion_residencia_ciudad: '',\r\n    zona: '', // urbano, rural\r\n    diagnostico_esfera_mental: '',\r\n\r\n    // INFO LABORAL\r\n    fecha_evento_atel: '',\r\n    eventos_no_laborales: '', // si, no\r\n    eventos_no_laborales_fecha: '',\r\n    eventos_no_laborales_diagnostico: '',\r\n    eps: '',\r\n    fondo_pension: '',\r\n    tiempo_total_incapacidad_dias: '',\r\n    empresa_donde_labora: '',\r\n    vinculacion_laboral: '', // si, no\r\n    tipo_vinculacion_laboral: '',\r\n    modalidad: '', // presencial, teletrabajo, trabajo_en_casa\r\n    tiempo_modalidad: '',\r\n    nit_empresa: '',\r\n    fecha_ingreso_dia: '',\r\n    fecha_ingreso_mes: '',\r\n    fecha_ingreso_ano: '',\r\n    antiguedad_empresa_anos: '',\r\n    antiguedad_empresa_meses: '',\r\n    antiguedad_cargo_anos: '',\r\n    antiguedad_cargo_meses: '',\r\n    contacto_empresa_cargo: '',\r\n    correos_electronicos: '',\r\n    telefonos_contacto_empresa: '',\r\n\r\n    // HISTORIA OCUPACIONAL\r\n    historia_ocupacional: [\r\n      { empresa: '', cargo_funciones_tareas: '', tiempo_duracion: '', motivo_retiro: '' },\r\n      { empresa: '', cargo_funciones_tareas: '', tiempo_duracion: '', motivo_retiro: '' },\r\n      { empresa: '', cargo_funciones_tareas: '', tiempo_duracion: '', motivo_retiro: '' },\r\n    ],\r\n    otros_oficios_desempenados: '',\r\n    oficios_interes: '',\r\n\r\n    // DESCRIPCION ACTIVIDAD LABORAL ACTUAL\r\n    nombre_cargo: '',\r\n    tareas_nombre_descripcion: '',\r\n    herramientas_trabajo: '',\r\n    horario_trabajo: '',\r\n    elementos_proteccion_personal: '',\r\n\r\n    // FACTORES DE RIESGO - Inicializar con todos los items\r\n    factores_riesgo: {} as Record<string, { calificacion: string; observaciones: string }>,\r\n\r\n    // CONCEPTO FINAL\r\n    concepto_psicologico_final: '',\r\n    orientacion_psicologica_reintegro: '',\r\n    elaboro_nombre: '',\r\n    elaboro_firma: '',\r\n    reviso_nombre: '',\r\n    reviso_firma: '',\r\n  });\r\n\r\n  // Inicializar factores de riesgo\r\n  useState(() => {\r\n    const factoresInit: Record<string, { calificacion: string; observaciones: string }> = {};\r\n    Object.values(factoresRiesgo).forEach(categoria => {\r\n      categoria.items.forEach(item => {\r\n        factoresInit[item] = { calificacion: '', observaciones: '' };\r\n      });\r\n    });\r\n    setFormData(prev => ({ ...prev, factores_riesgo: factoresInit }));\r\n  });\r\n\r\n  const updateField = (field: string, value: any) => {\r\n    setFormData(prev => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const updateHistoria = (index: number, field: string, value: string) => {\r\n    const newHistoria = [...formData.historia_ocupacional];\r\n    newHistoria[index] = { ...newHistoria[index], [field]: value };\r\n    setFormData(prev => ({ ...prev, historia_ocupacional: newHistoria }));\r\n  };\r\n\r\n  const updateFactorRiesgo = (item: string, field: 'calificacion' | 'observaciones', value: string) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      factores_riesgo: {\r\n        ...prev.factores_riesgo,\r\n        [item]: { ...prev.factores_riesgo[item], [field]: value }\r\n      }\r\n    }));\r\n\r\n    // Verificar alertas cuando se actualiza la calificación\r\n    if (field === 'calificacion') {\r\n      verificarAlertasRiesgo();\r\n    }\r\n  };\r\n\r\n  const verificarAlertasRiesgo = () => {\r\n    const alertas: string[] = [];\r\n\r\n    // Analizar cada categoría de factores de riesgo\r\n    Object.entries(factoresRiesgo).forEach(([_key, categoria]) => {\r\n      const calificaciones = categoria.items\r\n        .map(item => formData.factores_riesgo[item]?.calificacion)\r\n        .filter(cal => cal && cal !== 'na'); // Excluir N/A y vacíos\r\n\r\n      if (calificaciones.length === 0) return; // Si no hay calificaciones, saltar\r\n\r\n      // Contar altos y medios\r\n      const altos = calificaciones.filter(cal => cal === 'alto').length;\r\n      const medios = calificaciones.filter(cal => cal === 'medio').length;\r\n\r\n      // Si el promedio tiende a Alto o Medio, generar alerta\r\n      const totalEvaluados = calificaciones.length;\r\n      const porcentajeAlto = (altos / totalEvaluados) * 100;\r\n      const porcentajeMedio = (medios / totalEvaluados) * 100;\r\n\r\n      if (porcentajeAlto >= 50 || (porcentajeAlto + porcentajeMedio) >= 60) {\r\n        alertas.push(`Riesgo en ${categoria.titulo}`);\r\n      }\r\n    });\r\n\r\n    setAlertasRiesgo(alertas);\r\n  };\r\n\r\n  // Cargar valoración existente si viene ID en la URL\r\n  useEffect(() => {\r\n    const id = searchParams.get('id');\r\n    const modo = searchParams.get('modo');\r\n\r\n    if (id) {\r\n      const idNum = parseInt(id);\r\n      if (!isNaN(idNum)) {\r\n        setModoVista(modo === 'ver');\r\n        cargarValoracion(idNum);\r\n      }\r\n    }\r\n  }, [searchParams]);\r\n\r\n  const cargarValoracion = async (id: number) => {\r\n    setCargando(true);\r\n    try {\r\n      const data = await api.get<any>(`/valoraciones/${id}`);\r\n\r\n      // Mapear fecha de valoración\r\n      if (data.fecha_valoracion) {\r\n        // Parsear directamente la cadena ISO para evitar problemas de zona horaria\r\n        const fechaParts = data.fecha_valoracion.split('-');\r\n        if (fechaParts.length === 3) {\r\n          updateField('fecha_valoracion_ano', fechaParts[0]);\r\n          updateField('fecha_valoracion_mes', fechaParts[1].replace(/^0/, '')); // Quitar cero inicial\r\n          updateField('fecha_valoracion_dia', fechaParts[2].replace(/^0/, '')); // Quitar cero inicial\r\n        }\r\n      }\r\n\r\n      // Mapear trabajador\r\n      if (data.trabajador) {\r\n        const t = data.trabajador;\r\n        updateField('nombre_trabajador', t.nombre || '');\r\n\r\n        // Separar tipo de documento y número\r\n        if (t.documento) {\r\n          const docParts = t.documento.split(' ');\r\n          if (docParts.length >= 2) {\r\n            updateField('tipo_documento', docParts[0]);\r\n            updateField('numero_documento', docParts.slice(1).join(' '));\r\n          } else {\r\n            updateField('numero_documento', t.documento);\r\n          }\r\n        }\r\n\r\n        updateField('identificacion_siniestro', t.identificacion_siniestro || '');\r\n\r\n        // Fecha de nacimiento\r\n        if (t.fecha_nacimiento) {\r\n          const fecha = new Date(t.fecha_nacimiento);\r\n          updateField('fecha_nacimiento_dia', fecha.getDate().toString());\r\n          updateField('fecha_nacimiento_mes', (fecha.getMonth() + 1).toString());\r\n          updateField('fecha_nacimiento_ano', fecha.getFullYear().toString());\r\n        }\r\n\r\n        updateField('estado_civil', t.estado_civil || '');\r\n\r\n        // Nivel educativo - parsear string a checkboxes\r\n        if (t.nivel_educativo) {\r\n          const niveles = t.nivel_educativo.toLowerCase();\r\n          updateField('nivel_formacion_empirica', niveles.includes('formación empírica'));\r\n          updateField('nivel_basica_primaria', niveles.includes('básica primaria'));\r\n          updateField('nivel_bachillerato_vocacional', niveles.includes('bachillerato vocacional'));\r\n          updateField('nivel_bachillerato_modalidad', niveles.includes('bachillerato modalidad'));\r\n          updateField('nivel_tecnico_tecnologico', niveles.includes('técnico') || niveles.includes('tecnológico'));\r\n          updateField('nivel_universitario', niveles.includes('universitario'));\r\n          updateField('nivel_especializacion', niveles.includes('especialización') || niveles.includes('postgrado') || niveles.includes('maestría'));\r\n          updateField('nivel_formacion_informal', niveles.includes('formación informal'));\r\n          updateField('nivel_analfabeta', niveles.includes('analfabeta'));\r\n        }\r\n\r\n        updateField('especificar_formacion_oficios', t.formacion_especifica || '');\r\n        updateField('telefonos_trabajador', t.telefonos || '');\r\n        updateField('direccion_residencia_ciudad', t.direccion || '');\r\n        updateField('zona', t.zona || '');\r\n        updateField('diagnostico_esfera_mental', t.diagnostico_mental || '');\r\n      }\r\n\r\n      // Mapear info laboral\r\n      if (data.info_laboral) {\r\n        const il = data.info_laboral;\r\n        updateField('fecha_evento_atel', il.fecha_evento_atel || '');\r\n        updateField('eventos_no_laborales', il.eventos_no_laborales ? 'si' : 'no');\r\n        updateField('eventos_no_laborales_fecha', il.evento_no_laboral_fecha || '');\r\n        updateField('eventos_no_laborales_diagnostico', il.evento_no_laboral_diagnostico || '');\r\n        updateField('eps', il.eps || '');\r\n        updateField('fondo_pension', il.fondo_pension || '');\r\n        updateField('tiempo_total_incapacidad_dias', il.dias_incapacidad?.toString() || '');\r\n        updateField('empresa_donde_labora', il.empresa || '');\r\n        updateField('vinculacion_laboral', il.vinculacion_laboral ? 'si' : 'no');\r\n        updateField('tipo_vinculacion_laboral', il.tipo_vinculacion || '');\r\n        updateField('modalidad', il.modalidad || '');\r\n        updateField('tiempo_modalidad', il.tiempo_modalidad || '');\r\n        updateField('nit_empresa', il.nit_empresa || '');\r\n\r\n        // Fecha de ingreso\r\n        if (il.fecha_ingreso_empresa) {\r\n          const fecha = new Date(il.fecha_ingreso_empresa);\r\n          updateField('fecha_ingreso_dia', fecha.getDate().toString());\r\n          updateField('fecha_ingreso_mes', (fecha.getMonth() + 1).toString());\r\n          updateField('fecha_ingreso_ano', fecha.getFullYear().toString());\r\n        }\r\n\r\n        updateField('antiguedad_empresa_anos', il.antiguedad_empresa_anos?.toString() || '');\r\n        updateField('antiguedad_empresa_meses', il.antiguedad_empresa_meses?.toString() || '');\r\n        updateField('antiguedad_cargo_anos', il.antiguedad_cargo_anos?.toString() || '');\r\n        updateField('antiguedad_cargo_meses', il.antiguedad_cargo_meses?.toString() || '');\r\n        updateField('contacto_empresa_cargo', il.contacto_empresa || '');\r\n        updateField('correos_electronicos', il.correos || '');\r\n        updateField('telefonos_contacto_empresa', il.telefonos_empresa || '');\r\n      }\r\n\r\n      // Mapear historia ocupacional\r\n      if (data.historia_ocupacional && data.historia_ocupacional.length > 0) {\r\n        const historia = data.historia_ocupacional.map((h: any) => ({\r\n          empresa: h.empresa || '',\r\n          cargo_funciones_tareas: h.cargo_funciones || '',\r\n          tiempo_duracion: h.duracion || '',\r\n          motivo_retiro: h.motivo_retiro || '',\r\n        }));\r\n\r\n        // Asegurar que siempre haya 3 elementos\r\n        while (historia.length < 3) {\r\n          historia.push({ empresa: '', cargo_funciones_tareas: '', tiempo_duracion: '', motivo_retiro: '' });\r\n        }\r\n\r\n        updateField('historia_ocupacional', historia.slice(0, 3));\r\n      }\r\n\r\n      // Mapear actividad laboral\r\n      if (data.actividad_laboral) {\r\n        const al = data.actividad_laboral;\r\n        updateField('otros_oficios_desempenados', al.otros_oficios || '');\r\n        updateField('oficios_interes', al.oficios_interes || '');\r\n        updateField('nombre_cargo', al.nombre_cargo || '');\r\n        updateField('tareas_nombre_descripcion', al.tareas || '');\r\n        updateField('herramientas_trabajo', al.herramientas || '');\r\n        updateField('horario_trabajo', al.horario || '');\r\n        updateField('elementos_proteccion_personal', al.elementos_proteccion || '');\r\n      }\r\n\r\n      // Mapear evaluaciones de riesgo\r\n      if (data.evaluaciones_riesgo && data.evaluaciones_riesgo.length > 0) {\r\n        const factoresInit: Record<string, { calificacion: string; observaciones: string }> = {};\r\n\r\n        // Primero inicializar todos con valores vacíos\r\n        Object.values(factoresRiesgo).forEach(categoria => {\r\n          categoria.items.forEach(item => {\r\n            factoresInit[item] = { calificacion: '', observaciones: '' };\r\n          });\r\n        });\r\n\r\n        // Luego mapear las evaluaciones existentes\r\n        // Necesitamos crear un mapeo de categoria + item_numero a nombre del item\r\n        const categoriaItemMap: Record<string, Record<number, string>> = {};\r\n        Object.entries(factoresRiesgo).forEach(([categoriaKey, categoria]) => {\r\n          categoriaItemMap[categoriaKey] = {};\r\n          categoria.items.forEach((item, index) => {\r\n            categoriaItemMap[categoriaKey][index + 1] = item;\r\n          });\r\n        });\r\n\r\n        // Mapear las evaluaciones\r\n        data.evaluaciones_riesgo.forEach((ev: any) => {\r\n          const categoria = ev.categoria;\r\n          const itemNumero = ev.item_numero;\r\n\r\n          if (categoriaItemMap[categoria] && categoriaItemMap[categoria][itemNumero]) {\r\n            const itemNombre = categoriaItemMap[categoria][itemNumero];\r\n            factoresInit[itemNombre] = {\r\n              calificacion: ev.calificacion || '',\r\n              observaciones: ev.observaciones || '',\r\n            };\r\n          }\r\n        });\r\n\r\n        updateField('factores_riesgo', factoresInit);\r\n      }\r\n\r\n      // Mapear concepto\r\n      if (data.concepto) {\r\n        const c = data.concepto;\r\n        updateField('concepto_psicologico_final', c.concepto_editado || c.concepto_generado || '');\r\n        updateField('orientacion_psicologica_reintegro', c.orientacion_reintegro || '');\r\n        updateField('elaboro_nombre', c.elaboro_nombre || '');\r\n        updateField('elaboro_firma', c.elaboro_firma || '');\r\n        updateField('reviso_nombre', c.reviso_nombre || '');\r\n        updateField('reviso_firma', c.reviso_firma || '');\r\n      }\r\n\r\n      // Guardar el ID para posteriores actualizaciones\r\n      setValoracionId(id);\r\n\r\n      toast.success('Valoración cargada exitosamente');\r\n    } catch (error: any) {\r\n      console.error('Error al cargar valoración:', error);\r\n      toast.error(error.message || 'Error al cargar la valoración');\r\n      router.push('/dashboard/valoraciones');\r\n    } finally {\r\n      setCargando(false);\r\n    }\r\n  };\r\n\r\n  const validarPasoActual = (): boolean => {\r\n    const errores: string[] = [];\r\n\r\n    switch (currentStep) {\r\n      case 1: // Identificación\r\n        if (!formData.nombre_trabajador.trim()) {\r\n          errores.push('El nombre del trabajador es requerido');\r\n        }\r\n        if (!formData.tipo_documento) {\r\n          errores.push('El tipo de documento es requerido');\r\n        }\r\n        if (!formData.numero_documento.trim()) {\r\n          errores.push('El número de documento es requerido');\r\n        }\r\n        break;\r\n      case 2: // Info Laboral\r\n        if (!formData.empresa_donde_labora.trim()) {\r\n          errores.push('El nombre de la empresa es requerido');\r\n        }\r\n        if (!formData.fecha_evento_atel) {\r\n          errores.push('La fecha del evento ATEL es requerida');\r\n        }\r\n        break;\r\n      case 4: // Actividad Laboral\r\n        if (!formData.nombre_cargo.trim()) {\r\n          errores.push('El nombre del cargo es requerido');\r\n        }\r\n        break;\r\n      case 6: // Concepto Final\r\n        if (!formData.concepto_psicologico_final.trim()) {\r\n          errores.push('El concepto psicológico final es requerido');\r\n        }\r\n        if (!formData.elaboro_nombre.trim()) {\r\n          errores.push('El nombre de quien elaboró es requerido');\r\n        }\r\n        break;\r\n    }\r\n\r\n    if (errores.length > 0) {\r\n      setValidationErrors(errores);\r\n      setShowValidationModal(true);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  const nextStep = () => {\r\n    if (validarPasoActual() && currentStep < 6) {\r\n      setCurrentStep(prev => prev + 1);\r\n    }\r\n  };\r\n\r\n  const prevStep = () => {\r\n    if (currentStep > 1) setCurrentStep(prev => prev - 1);\r\n  };\r\n\r\n  const mapearEvaluacionesRiesgo = () => {\r\n    const evaluaciones: any[] = [];\r\n\r\n    Object.entries(factoresRiesgo).forEach(([categoriaKey, categoria]) => {\r\n      categoria.items.forEach((item, index) => {\r\n        const evaluacion = formData.factores_riesgo[item];\r\n        if (evaluacion && evaluacion.calificacion && evaluacion.calificacion !== 'na') {\r\n          evaluaciones.push({\r\n            categoria: categoriaKey,\r\n            item_numero: index + 1,\r\n            item_texto: item,\r\n            calificacion: evaluacion.calificacion,\r\n            observaciones: evaluacion.observaciones || null,\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    return evaluaciones;\r\n  };\r\n\r\n  const handleSave = async (estado: 'borrador' | 'completada', redirectAfter = true) => {\r\n    setSaving(true);\r\n    try {\r\n      // Construir fecha de valoración\r\n      const fechaValoracion = formData.fecha_valoracion_ano && formData.fecha_valoracion_mes && formData.fecha_valoracion_dia\r\n        ? `${formData.fecha_valoracion_ano}-${formData.fecha_valoracion_mes.padStart(2, '0')}-${formData.fecha_valoracion_dia.padStart(2, '0')}`\r\n        : new Date().toISOString().split('T')[0];\r\n\r\n      // Construir nivel educativo string\r\n      const nivelEducativo = [\r\n        formData.nivel_formacion_empirica && 'Formación empírica',\r\n        formData.nivel_basica_primaria && 'Básica primaria',\r\n        formData.nivel_bachillerato_vocacional && 'Bachillerato vocacional 9°',\r\n        formData.nivel_bachillerato_modalidad && 'Bachillerato modalidad',\r\n        formData.nivel_tecnico_tecnologico && 'Técnico/Tecnológico',\r\n        formData.nivel_universitario && 'Universitario',\r\n        formData.nivel_especializacion && 'Especialización/Postgrado/Maestría',\r\n        formData.nivel_formacion_informal && 'Formación informal oficios',\r\n        formData.nivel_analfabeta && 'Analfabeta',\r\n      ].filter(Boolean).join(', ');\r\n\r\n      const payload = {\r\n        fecha_valoracion: fechaValoracion,\r\n        estado,\r\n        trabajador: {\r\n          nombre: formData.nombre_trabajador,\r\n          documento: `${formData.tipo_documento || 'CC'} ${formData.numero_documento}`,\r\n          identificacion_siniestro: formData.identificacion_siniestro,\r\n          fecha_nacimiento: formData.fecha_nacimiento_ano && formData.fecha_nacimiento_mes && formData.fecha_nacimiento_dia\r\n            ? `${formData.fecha_nacimiento_ano}-${formData.fecha_nacimiento_mes.padStart(2, '0')}-${formData.fecha_nacimiento_dia.padStart(2, '0')}`\r\n            : null,\r\n          estado_civil: formData.estado_civil || null,\r\n          nivel_educativo: nivelEducativo,\r\n          formacion_especifica: formData.especificar_formacion_oficios,\r\n          telefonos: formData.telefonos_trabajador,\r\n          direccion: formData.direccion_residencia_ciudad,\r\n          zona: formData.zona || null,\r\n          diagnostico_mental: formData.diagnostico_esfera_mental,\r\n        },\r\n        info_laboral: {\r\n          fecha_evento_atel: formData.fecha_evento_atel || null,\r\n          eventos_no_laborales: formData.eventos_no_laborales === 'si',\r\n          evento_no_laboral_fecha: formData.eventos_no_laborales_fecha || null,\r\n          evento_no_laboral_diagnostico: formData.eventos_no_laborales_diagnostico,\r\n          eps: formData.eps,\r\n          fondo_pension: formData.fondo_pension,\r\n          dias_incapacidad: formData.tiempo_total_incapacidad_dias ? parseInt(formData.tiempo_total_incapacidad_dias) : null,\r\n          empresa: formData.empresa_donde_labora,\r\n          nit_empresa: formData.nit_empresa,\r\n          vinculacion_laboral: formData.vinculacion_laboral === 'si',\r\n          tipo_vinculacion: formData.tipo_vinculacion_laboral,\r\n          modalidad: formData.modalidad || null,\r\n          tiempo_modalidad: formData.tiempo_modalidad,\r\n          fecha_ingreso_empresa: formData.fecha_ingreso_ano && formData.fecha_ingreso_mes && formData.fecha_ingreso_dia\r\n            ? `${formData.fecha_ingreso_ano}-${formData.fecha_ingreso_mes.padStart(2, '0')}-${formData.fecha_ingreso_dia.padStart(2, '0')}`\r\n            : null,\r\n          antiguedad_empresa_anos: formData.antiguedad_empresa_anos ? parseInt(formData.antiguedad_empresa_anos) : null,\r\n          antiguedad_empresa_meses: formData.antiguedad_empresa_meses ? parseInt(formData.antiguedad_empresa_meses) : null,\r\n          antiguedad_cargo_anos: formData.antiguedad_cargo_anos ? parseInt(formData.antiguedad_cargo_anos) : null,\r\n          antiguedad_cargo_meses: formData.antiguedad_cargo_meses ? parseInt(formData.antiguedad_cargo_meses) : null,\r\n          contacto_empresa: formData.contacto_empresa_cargo,\r\n          correos: formData.correos_electronicos,\r\n          telefonos_empresa: formData.telefonos_contacto_empresa,\r\n        },\r\n        historia_ocupacional: formData.historia_ocupacional\r\n          .filter(h => h.empresa || h.cargo_funciones_tareas)\r\n          .map((h, i) => ({\r\n            orden: i + 1,\r\n            empresa: h.empresa,\r\n            cargo_funciones: h.cargo_funciones_tareas,\r\n            duracion: h.tiempo_duracion,\r\n            motivo_retiro: h.motivo_retiro,\r\n          })),\r\n        actividad_laboral: {\r\n          nombre_cargo: formData.nombre_cargo,\r\n          tareas: formData.tareas_nombre_descripcion,\r\n          herramientas: formData.herramientas_trabajo,\r\n          horario: formData.horario_trabajo,\r\n          elementos_proteccion: formData.elementos_proteccion_personal,\r\n          otros_oficios: formData.otros_oficios_desempenados,\r\n          oficios_interes: formData.oficios_interes,\r\n        },\r\n        evaluaciones_riesgo: mapearEvaluacionesRiesgo(),\r\n        concepto: {\r\n          concepto_editado: formData.concepto_psicologico_final,\r\n          orientacion_reintegro: formData.orientacion_psicologica_reintegro,\r\n          elaboro_nombre: formData.elaboro_nombre,\r\n          elaboro_firma: formData.elaboro_firma,\r\n          reviso_nombre: formData.reviso_nombre,\r\n          reviso_firma: formData.reviso_firma,\r\n        },\r\n      };\r\n\r\n      let result: any;\r\n      if (valoracionId) {\r\n        // Actualizar valoración existente\r\n        result = await api.put(`/valoraciones/${valoracionId}`, payload);\r\n      } else {\r\n        // Crear nueva valoración\r\n        result = await api.post('/valoraciones/', payload);\r\n        setValoracionId(result.id);\r\n      }\r\n\r\n      toast.success(estado === 'borrador' ? 'Borrador guardado' : 'Valoración creada exitosamente');\r\n\r\n      if (redirectAfter) {\r\n        router.push('/dashboard/valoraciones');\r\n      }\r\n\r\n      return result;\r\n    } catch (error: any) {\r\n      console.error('Error al guardar valoración:', error);\r\n      toast.error(error.message || 'Error al guardar');\r\n      return null;\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleFinalizar = async () => {\r\n    setFinalizando(true);\r\n    try {\r\n      // Validaciones previas\r\n      if (!formData.concepto_psicologico_final.trim()) {\r\n        toast.error('Debe generar o escribir el concepto psicológico final antes de finalizar');\r\n        return;\r\n      }\r\n\r\n      if (!formData.elaboro_nombre.trim()) {\r\n        toast.error('Debe ingresar el nombre de quien elaboró la valoración');\r\n        return;\r\n      }\r\n\r\n      if (!formData.reviso_nombre.trim()) {\r\n        toast.error('Debe ingresar el nombre de quien revisó la valoración');\r\n        return;\r\n      }\r\n\r\n      // Si no hay valoracionId, guardar primero como borrador\r\n      let currentValoracionId = valoracionId;\r\n      if (!currentValoracionId) {\r\n        toast.info('Guardando valoración...');\r\n        const result: any = await handleSave('borrador', false);\r\n        if (!result || !result.id) {\r\n          toast.error('No se pudo guardar la valoración');\r\n          return;\r\n        }\r\n        currentValoracionId = result.id;\r\n      } else {\r\n        // Si ya existe, actualizarla antes de finalizar\r\n        await handleSave('borrador', false);\r\n      }\r\n\r\n      // Llamar al endpoint de finalizar\r\n      toast.info('Generando archivo PDF...');\r\n      const response: any = await api.post(`/valoraciones/${currentValoracionId}/finalizar`, {});\r\n\r\n      toast.success('Valoración finalizada exitosamente');\r\n\r\n      // Guardar las URLs para el modal de descarga\r\n      setDownloadUrls({\r\n        pdf_url: response.pdf_url,\r\n        pdf_filename: response.pdf_filename,\r\n        excel_url: response.excel_url,\r\n        excel_filename: response.excel_filename\r\n      });\r\n\r\n      // Mostrar modal de descarga\r\n      setShowDownloadModal(true);\r\n\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al finalizar la valoración');\r\n    } finally {\r\n      setFinalizando(false);\r\n    }\r\n  };\r\n\r\n  const generarConceptoAutomatico = async () => {\r\n    setGenerandoConcepto(true);\r\n    try {\r\n      // Verificar que haya evaluaciones de riesgo\r\n      const evaluaciones = mapearEvaluacionesRiesgo();\r\n      if (evaluaciones.length === 0) {\r\n        toast.error('Debe completar la evaluación de factores de riesgo antes de generar el concepto');\r\n        return;\r\n      }\r\n\r\n      // Verificar que haya nombre de trabajador\r\n      if (!formData.nombre_trabajador.trim()) {\r\n        toast.error('Debe ingresar el nombre del trabajador');\r\n        return;\r\n      }\r\n\r\n      // Verificar si tiene diagnóstico mental\r\n      const tieneDiagnostico = Boolean(formData.diagnostico_esfera_mental && formData.diagnostico_esfera_mental.trim() !== '');\r\n\r\n      // Llamar al endpoint de generar concepto enviando las evaluaciones directamente\r\n      const response: any = await api.post('/conceptos/generar', {\r\n        valoracion_id: valoracionId || null,\r\n        evaluaciones: evaluaciones,\r\n        nombre_trabajador: formData.nombre_trabajador,\r\n        tiene_diagnostico_mental: tieneDiagnostico\r\n      });\r\n\r\n      console.log('Respuesta generación concepto:', response);\r\n\r\n      let conceptoTexto = '';\r\n\r\n      // Manejo robusto de la respuesta\r\n      if (response && response.concepto) {\r\n        if (typeof response.concepto === 'string') {\r\n          conceptoTexto = response.concepto;\r\n        } else if (typeof response.concepto === 'object') {\r\n          // Si es un objeto, intentar extraer el texto si tiene propiedad 'concepto' o similar\r\n          if (response.concepto.concepto) {\r\n            conceptoTexto = response.concepto.concepto;\r\n          } else {\r\n            // Si no, convertir a string para ver qué es\r\n            console.warn('Concepto recibido como objeto:', response.concepto);\r\n            conceptoTexto = JSON.stringify(response.concepto, null, 2);\r\n          }\r\n        } else {\r\n          conceptoTexto = String(response.concepto);\r\n        }\r\n      } else if (typeof response === 'string') {\r\n        conceptoTexto = response;\r\n      }\r\n\r\n      // Actualizar el campo con el concepto generado\r\n      updateField('concepto_psicologico_final', conceptoTexto);\r\n\r\n      toast.success('Concepto generado exitosamente');\r\n    } catch (error: any) {\r\n      console.error('Error generando concepto:', error);\r\n      toast.error(error.message || 'Error al generar el concepto');\r\n    } finally {\r\n      setGenerandoConcepto(false);\r\n    }\r\n  };\r\n\r\n  // Mostrar loading mientras carga\r\n  if (cargando) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n          <div className=\"text-center\">\r\n            <Loader2 className=\"h-12 w-12 animate-spin text-indigo-500 mx-auto mb-4\" />\r\n            <p className=\"text-gray-600 dark:text-gray-400\">Cargando valoración...</p>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n          {modoVista ? 'VER VALORACIÓN' : valoracionId ? 'EDITAR VALORACIÓN' : 'NUEVA VALORACIÓN'} DE PSICOLOGÍA PARA RECOMENDACIONES LABORALES\r\n        </h1>\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\r\n          {modoVista\r\n            ? 'Visualización de la valoración psicológica. No se pueden realizar modificaciones.'\r\n            : valoracionId\r\n              ? 'Edite los campos necesarios y guarde los cambios.'\r\n              : 'Complete todos los pasos del formulario. Al finalizar se generará automáticamente el archivo PDF.'}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Progress Steps */}\r\n      <div className=\"mb-6 overflow-x-auto\">\r\n        <div className=\"flex items-center min-w-max\">\r\n          {steps.map((step, index) => (\r\n            <div key={step.id} className=\"flex items-center\">\r\n              <button\r\n                onClick={() => setCurrentStep(step.id)}\r\n                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${currentStep === step.id\r\n                  ? 'bg-indigo-500 text-white'\r\n                  : currentStep > step.id\r\n                    ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n                    : 'bg-gray-100 text-gray-500 dark:bg-[#333333] dark:text-[#b0b0b0]'\r\n                  }`}\r\n              >\r\n                {currentStep > step.id ? (\r\n                  <Check className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <step.icon className=\"h-4 w-4\" />\r\n                )}\r\n                <span className=\"text-sm font-medium\">{step.title}</span>\r\n              </button>\r\n              {index < steps.length - 1 && (\r\n                <div className={`w-8 h-0.5 mx-1 ${currentStep > step.id ? 'bg-green-500' : 'bg-gray-300 dark:bg-[#333333]'\r\n                  }`} />\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Form Content */}\r\n      <Card className=\"border-gray-200 dark:border-[#333333] dark:bg-[#2a2a2a]\">\r\n        <CardHeader className=\"bg-gray-50 dark:bg-[#1a1a1a] border-b border-gray-200 dark:border-[#333333]\">\r\n          <CardTitle className=\"text-gray-700 dark:text-white\">\r\n            {steps[currentStep - 1].title.toUpperCase()}\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"p-6\">\r\n\r\n          {/* ============ PASO 1: IDENTIFICACIÓN ============ */}\r\n          {currentStep === 1 && (\r\n            <div className=\"space-y-6\">\r\n              {/* Fecha de Valoración */}\r\n              <div className=\"p-4 bg-gray-50 dark:bg-slate-800 rounded-lg\">\r\n                <Label className=\"text-sm font-semibold mb-3 block\">FECHA DE VALORACIÓN:</Label>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">día</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_valoracion_dia}\r\n                      onChange={(e) => updateField('fecha_valoracion_dia', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">mes</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_valoracion_mes}\r\n                      onChange={(e) => updateField('fecha_valoracion_mes', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">año</Label>\r\n                    <Input\r\n                      className=\"w-20 text-center\"\r\n                      value={formData.fecha_valoracion_ano}\r\n                      onChange={(e) => updateField('fecha_valoracion_ano', e.target.value)}\r\n                      maxLength={4}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Datos del trabajador */}\r\n              <div className=\"grid grid-cols-1 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Nombre del trabajador <span className=\"text-red-500\">*</span></Label>\r\n                  <Input\r\n                    value={formData.nombre_trabajador}\r\n                    onChange={(e) => updateField('nombre_trabajador', e.target.value)}\r\n                    required\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Tipo de documento <span className=\"text-red-500\">*</span></Label>\r\n                    <RadioGroup\r\n                      value={formData.tipo_documento}\r\n                      onValueChange={(v) => updateField('tipo_documento', v)}\r\n                      className=\"flex flex-wrap gap-3\"\r\n                      disabled={modoVista}\r\n                    >\r\n                      {[\r\n                        { value: 'CC', label: 'CC' },\r\n                        { value: 'TI', label: 'TI' },\r\n                        { value: 'CE', label: 'CE' },\r\n                        { value: 'PEP', label: 'PEP' },\r\n                        { value: 'PPT', label: 'PPT' },\r\n                      ].map((option) => (\r\n                        <div key={option.value} className=\"flex items-center space-x-2\">\r\n                          <RadioGroupItem value={option.value} id={`tipo_doc_${option.value}`} />\r\n                          <Label htmlFor={`tipo_doc_${option.value}`} className=\"text-sm font-normal\">\r\n                            {option.label}\r\n                          </Label>\r\n                        </div>\r\n                      ))}\r\n                    </RadioGroup>\r\n                  </div>\r\n                  <div className=\"md:col-span-2 space-y-2\">\r\n                    <Label>Número de documento <span className=\"text-red-500\">*</span></Label>\r\n                    <Input\r\n                      value={formData.numero_documento}\r\n                      onChange={(e) => updateField('numero_documento', e.target.value)}\r\n                      required\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Identificación del siniestro</Label>\r\n                  <Input\r\n                    value={formData.identificacion_siniestro}\r\n                    onChange={(e) => updateField('identificacion_siniestro', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Fecha de nacimiento */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Fecha de nacimiento/edad</Label>\r\n                <div className=\"flex items-center gap-4 flex-wrap\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">día</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_nacimiento_dia}\r\n                      onChange={(e) => updateField('fecha_nacimiento_dia', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">mes</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_nacimiento_mes}\r\n                      onChange={(e) => updateField('fecha_nacimiento_mes', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">año</Label>\r\n                    <Input\r\n                      className=\"w-20 text-center\"\r\n                      value={formData.fecha_nacimiento_ano}\r\n                      onChange={(e) => updateField('fecha_nacimiento_ano', e.target.value)}\r\n                      maxLength={4}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">edad</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.edad}\r\n                      onChange={(e) => updateField('edad', e.target.value)}\r\n                      disabled={modoVista}\r\n                    />\r\n                    <span className=\"text-xs text-gray-500\">años</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Estado Civil */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Estado civil</Label>\r\n                <RadioGroup\r\n                  value={formData.estado_civil}\r\n                  onValueChange={(v) => updateField('estado_civil', v)}\r\n                  className=\"flex flex-wrap gap-4\"\r\n                  disabled={modoVista}\r\n                >\r\n                  {[\r\n                    { value: 'casado', label: 'Casado' },\r\n                    { value: 'soltero', label: 'Soltero' },\r\n                    { value: 'union_libre', label: 'Unión libre' },\r\n                    { value: 'separado', label: 'Separado' },\r\n                    { value: 'viudo', label: 'Viudo' },\r\n                  ].map((option) => (\r\n                    <div key={option.value} className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value={option.value} id={`estado_${option.value}`} />\r\n                      <Label htmlFor={`estado_${option.value}`} className=\"text-sm font-normal\">\r\n                        {option.label}\r\n                      </Label>\r\n                    </div>\r\n                  ))}\r\n                </RadioGroup>\r\n              </div>\r\n\r\n              {/* Nivel Educativo */}\r\n              <div className=\"space-y-3\">\r\n                <Label>Nivel educativo</Label>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                  {[\r\n                    { field: 'nivel_formacion_empirica', label: 'Formación empírica' },\r\n                    { field: 'nivel_basica_primaria', label: 'Básica primaria' },\r\n                    { field: 'nivel_bachillerato_vocacional', label: 'Bachillerato: vocacional 9°' },\r\n                    { field: 'nivel_bachillerato_modalidad', label: 'Bachillerato: modalidad' },\r\n                    { field: 'nivel_tecnico_tecnologico', label: 'Técnico/Tecnológico' },\r\n                    { field: 'nivel_universitario', label: 'Universitario' },\r\n                    { field: 'nivel_especializacion', label: 'Especialización/postgrado/maestría' },\r\n                    { field: 'nivel_formacion_informal', label: 'Formación informal oficios' },\r\n                    { field: 'nivel_analfabeta', label: 'Analfabeta' },\r\n                  ].map((item) => (\r\n                    <div key={item.field} className=\"flex items-center space-x-2\">\r\n                      <Checkbox\r\n                        id={item.field}\r\n                        checked={formData[item.field as keyof typeof formData] as boolean}\r\n                        onCheckedChange={(checked) => updateField(item.field, checked)}\r\n                        disabled={modoVista}\r\n                      />\r\n                      <Label htmlFor={item.field} className=\"text-sm font-normal\">\r\n                        {item.label}\r\n                      </Label>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-sm\">Especificar formación y oficios que conoce</Label>\r\n                  <Textarea\r\n                    value={formData.especificar_formacion_oficios}\r\n                    onChange={(e) => updateField('especificar_formacion_oficios', e.target.value)}\r\n                    rows={2}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Contacto */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Teléfonos trabajador</Label>\r\n                <Input\r\n                  value={formData.telefonos_trabajador}\r\n                  onChange={(e) => updateField('telefonos_trabajador', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div className=\"md:col-span-2 space-y-2\">\r\n                  <Label>Dirección residencia y ciudad</Label>\r\n                  <Input\r\n                    value={formData.direccion_residencia_ciudad}\r\n                    onChange={(e) => updateField('direccion_residencia_ciudad', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Zona</Label>\r\n                  <RadioGroup\r\n                    value={formData.zona}\r\n                    onValueChange={(v) => updateField('zona', v)}\r\n                    className=\"flex gap-4\"\r\n                    disabled={modoVista}\r\n                  >\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"urbano\" id=\"zona_urbano\" />\r\n                      <Label htmlFor=\"zona_urbano\" className=\"text-sm font-normal\">Urbano</Label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"rural\" id=\"zona_rural\" />\r\n                      <Label htmlFor=\"zona_rural\" className=\"text-sm font-normal\">Rural</Label>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Diagnóstico de esfera mental reconocidos</Label>\r\n                <Textarea\r\n                  value={formData.diagnostico_esfera_mental}\r\n                  onChange={(e) => updateField('diagnostico_esfera_mental', e.target.value)}\r\n                  rows={3}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* ============ PASO 2: INFO LABORAL ============ */}\r\n          {currentStep === 2 && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"space-y-2\">\r\n                <Label>Fecha(s) del evento(s) ATEL <span className=\"text-red-500\">*</span></Label>\r\n                <Input\r\n                  type=\"date\"\r\n                  value={formData.fecha_evento_atel}\r\n                  onChange={(e) => updateField('fecha_evento_atel', e.target.value)}\r\n                  className=\"max-w-xs\"\r\n                  required\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 items-end\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Eventos No laborales</Label>\r\n                  <RadioGroup\r\n                    value={formData.eventos_no_laborales}\r\n                    onValueChange={(v) => updateField('eventos_no_laborales', v)}\r\n                    className=\"flex gap-4\"\r\n                    disabled={modoVista}\r\n                  >\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"si\" id=\"eventos_si\" />\r\n                      <Label htmlFor=\"eventos_si\" className=\"text-sm font-normal\">Sí</Label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"no\" id=\"eventos_no\" />\r\n                      <Label htmlFor=\"eventos_no\" className=\"text-sm font-normal\">No</Label>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Fecha</Label>\r\n                  <Input\r\n                    type=\"date\"\r\n                    value={formData.eventos_no_laborales_fecha}\r\n                    onChange={(e) => updateField('eventos_no_laborales_fecha', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n                <div className=\"md:col-span-2 space-y-2\">\r\n                  <Label>Diagnóstico</Label>\r\n                  <Input\r\n                    value={formData.eventos_no_laborales_diagnostico}\r\n                    onChange={(e) => updateField('eventos_no_laborales_diagnostico', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>EPS</Label>\r\n                  <Input\r\n                    value={formData.eps}\r\n                    onChange={(e) => updateField('eps', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Fondo de Pensión</Label>\r\n                  <Input\r\n                    value={formData.fondo_pension}\r\n                    onChange={(e) => updateField('fondo_pension', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Tiempo total de incapacidad (días)</Label>\r\n                <Input\r\n                  type=\"number\"\r\n                  value={formData.tiempo_total_incapacidad_dias}\r\n                  onChange={(e) => updateField('tiempo_total_incapacidad_dias', e.target.value)}\r\n                  className=\"w-32\"\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Empresa donde labora*</Label>\r\n                <Input\r\n                  value={formData.empresa_donde_labora}\r\n                  onChange={(e) => updateField('empresa_donde_labora', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Vinculación laboral</Label>\r\n                  <RadioGroup\r\n                    value={formData.vinculacion_laboral}\r\n                    onValueChange={(v) => updateField('vinculacion_laboral', v)}\r\n                    className=\"flex gap-4\"\r\n                    disabled={modoVista}\r\n                  >\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"no\" id=\"vinc_no\" />\r\n                      <Label htmlFor=\"vinc_no\" className=\"text-sm font-normal\">NO</Label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"si\" id=\"vinc_si\" />\r\n                      <Label htmlFor=\"vinc_si\" className=\"text-sm font-normal\">SI</Label>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Tipo de vinculación laboral</Label>\r\n                  <Input\r\n                    value={formData.tipo_vinculacion_laboral}\r\n                    onChange={(e) => updateField('tipo_vinculacion_laboral', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Modalidad</Label>\r\n                  <RadioGroup\r\n                    value={formData.modalidad}\r\n                    onValueChange={(v) => updateField('modalidad', v)}\r\n                    className=\"flex flex-wrap gap-4\"\r\n                    disabled={modoVista}\r\n                  >\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"presencial\" id=\"mod_presencial\" />\r\n                      <Label htmlFor=\"mod_presencial\" className=\"text-sm font-normal\">Presencial</Label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"teletrabajo\" id=\"mod_teletrabajo\" />\r\n                      <Label htmlFor=\"mod_teletrabajo\" className=\"text-sm font-normal\">Teletrabajo</Label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <RadioGroupItem value=\"trabajo_en_casa\" id=\"mod_casa\" />\r\n                      <Label htmlFor=\"mod_casa\" className=\"text-sm font-normal\">Trabajo en casa</Label>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label>Tiempo de la modalidad</Label>\r\n                  <Input\r\n                    value={formData.tiempo_modalidad}\r\n                    onChange={(e) => updateField('tiempo_modalidad', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>NIT de la Empresa</Label>\r\n                <Input\r\n                  value={formData.nit_empresa}\r\n                  onChange={(e) => updateField('nit_empresa', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Fecha ingreso a la empresa/antigüedad en la empresa</Label>\r\n                <div className=\"flex items-center gap-4 flex-wrap\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">día</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_ingreso_dia}\r\n                      onChange={(e) => updateField('fecha_ingreso_dia', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">mes</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.fecha_ingreso_mes}\r\n                      onChange={(e) => updateField('fecha_ingreso_mes', e.target.value)}\r\n                      maxLength={2}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">año</Label>\r\n                    <Input\r\n                      className=\"w-20 text-center\"\r\n                      value={formData.fecha_ingreso_ano}\r\n                      onChange={(e) => updateField('fecha_ingreso_ano', e.target.value)}\r\n                      maxLength={4}\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Label className=\"text-xs\">Tiempo:</Label>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.antiguedad_empresa_anos}\r\n                      onChange={(e) => updateField('antiguedad_empresa_anos', e.target.value)}\r\n                      disabled={modoVista}\r\n                    />\r\n                    <span className=\"text-xs\">años</span>\r\n                    <Input\r\n                      className=\"w-16 text-center\"\r\n                      value={formData.antiguedad_empresa_meses}\r\n                      onChange={(e) => updateField('antiguedad_empresa_meses', e.target.value)}\r\n                      disabled={modoVista}\r\n                    />\r\n                    <span className=\"text-xs\">meses</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Antigüedad en el cargo</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    className=\"w-16 text-center\"\r\n                    value={formData.antiguedad_cargo_anos}\r\n                    onChange={(e) => updateField('antiguedad_cargo_anos', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                  <span className=\"text-xs\">años</span>\r\n                  <Input\r\n                    className=\"w-16 text-center\"\r\n                    value={formData.antiguedad_cargo_meses}\r\n                    onChange={(e) => updateField('antiguedad_cargo_meses', e.target.value)}\r\n                    disabled={modoVista}\r\n                  />\r\n                  <span className=\"text-xs\">meses</span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Contacto en empresa/cargo</Label>\r\n                <Input\r\n                  value={formData.contacto_empresa_cargo}\r\n                  onChange={(e) => updateField('contacto_empresa_cargo', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Correo(s) electrónico(s)</Label>\r\n                <Input\r\n                  value={formData.correos_electronicos}\r\n                  onChange={(e) => updateField('correos_electronicos', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Teléfonos de contacto empresa</Label>\r\n                <Input\r\n                  value={formData.telefonos_contacto_empresa}\r\n                  onChange={(e) => updateField('telefonos_contacto_empresa', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* ============ PASO 3: HISTORIA OCUPACIONAL ============ */}\r\n          {currentStep === 3 && (\r\n            <div className=\"space-y-6\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 italic\">\r\n                (Trabajos desempeñados, comenzando por el primero de su historia laboral)\r\n              </p>\r\n\r\n              {/* Tabla de historia ocupacional */}\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full border-collapse\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-100 dark:bg-slate-700\">\r\n                      <th className=\"border border-gray-300 dark:border-slate-600 px-3 py-2 text-left text-sm font-semibold\">Empresa</th>\r\n                      <th className=\"border border-gray-300 dark:border-slate-600 px-3 py-2 text-left text-sm font-semibold\">Cargo - funciones / tareas</th>\r\n                      <th className=\"border border-gray-300 dark:border-slate-600 px-3 py-2 text-left text-sm font-semibold\">Tiempo/duración</th>\r\n                      <th className=\"border border-gray-300 dark:border-slate-600 px-3 py-2 text-left text-sm font-semibold\">Motivo de retiro</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {formData.historia_ocupacional.map((historia, index) => (\r\n                      <tr key={index}>\r\n                        <td className=\"border border-gray-300 dark:border-slate-600 p-1\">\r\n                          <Input\r\n                            className=\"border-0\"\r\n                            value={historia.empresa}\r\n                            onChange={(e) => updateHistoria(index, 'empresa', e.target.value)}\r\n                            disabled={modoVista}\r\n                          />\r\n                        </td>\r\n                        <td className=\"border border-gray-300 dark:border-slate-600 p-1\">\r\n                          <Input\r\n                            className=\"border-0\"\r\n                            value={historia.cargo_funciones_tareas}\r\n                            onChange={(e) => updateHistoria(index, 'cargo_funciones_tareas', e.target.value)}\r\n                            disabled={modoVista}\r\n                          />\r\n                        </td>\r\n                        <td className=\"border border-gray-300 dark:border-slate-600 p-1\">\r\n                          <Input\r\n                            className=\"border-0\"\r\n                            value={historia.tiempo_duracion}\r\n                            onChange={(e) => updateHistoria(index, 'tiempo_duracion', e.target.value)}\r\n                            disabled={modoVista}\r\n                          />\r\n                        </td>\r\n                        <td className=\"border border-gray-300 dark:border-slate-600 p-1\">\r\n                          <Input\r\n                            className=\"border-0\"\r\n                            value={historia.motivo_retiro}\r\n                            onChange={(e) => updateHistoria(index, 'motivo_retiro', e.target.value)}\r\n                            disabled={modoVista}\r\n                          />\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Otros Oficios desempeñados:</Label>\r\n                <Textarea\r\n                  value={formData.otros_oficios_desempenados}\r\n                  onChange={(e) => updateField('otros_oficios_desempenados', e.target.value)}\r\n                  rows={2}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Oficios de interés:</Label>\r\n                <Textarea\r\n                  value={formData.oficios_interes}\r\n                  onChange={(e) => updateField('oficios_interes', e.target.value)}\r\n                  rows={2}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* ============ PASO 4: ACTIVIDAD LABORAL ACTUAL ============ */}\r\n          {currentStep === 4 && (\r\n            <div className=\"space-y-6\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 italic mb-4\">\r\n                DESCRIPCIÓN ACTIVIDAD LABORAL ACTUAL * (antes del evento)\r\n              </p>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Nombre del cargo <span className=\"text-red-500\">*</span></Label>\r\n                <Input\r\n                  value={formData.nombre_cargo}\r\n                  onChange={(e) => updateField('nombre_cargo', e.target.value)}\r\n                  required\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Tareas (nombre y descripción):</Label>\r\n                <Textarea\r\n                  value={formData.tareas_nombre_descripcion}\r\n                  onChange={(e) => updateField('tareas_nombre_descripcion', e.target.value)}\r\n                  rows={4}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Herramientas de trabajo:</Label>\r\n                <Textarea\r\n                  value={formData.herramientas_trabajo}\r\n                  onChange={(e) => updateField('herramientas_trabajo', e.target.value)}\r\n                  rows={2}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Horario de trabajo:</Label>\r\n                <Input\r\n                  value={formData.horario_trabajo}\r\n                  onChange={(e) => updateField('horario_trabajo', e.target.value)}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Elementos de Protección Personal:</Label>\r\n                <Textarea\r\n                  value={formData.elementos_proteccion_personal}\r\n                  onChange={(e) => updateField('elementos_proteccion_personal', e.target.value)}\r\n                  rows={2}\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* ============ PASO 5: FACTORES DE RIESGO PSICOSOCIALES ============ */}\r\n          {currentStep === 5 && (\r\n            <div className=\"space-y-6\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\r\n                FACTORES DE RIESGO PSICOSOCIALES - Califique cada factor según corresponda\r\n              </p>\r\n\r\n              {/* Alertas de Riesgo */}\r\n              {alertasRiesgo.length > 0 && (\r\n                <div className=\"bg-red-50 dark:bg-red-900/20 border-2 border-red-500 dark:border-red-700 rounded-lg p-4\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <AlertTriangle className=\"h-6 w-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\r\n                    <div className=\"flex-1\">\r\n                      <h4 className=\"font-semibold text-red-800 dark:text-red-300 mb-2\">\r\n                        ⚠️ Alertas de Riesgo Detectadas\r\n                      </h4>\r\n                      <ul className=\"list-disc list-inside space-y-1\">\r\n                        {alertasRiesgo.map((alerta, idx) => (\r\n                          <li key={idx} className=\"text-red-700 dark:text-red-300 text-sm\">\r\n                            {alerta}\r\n                          </li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {Object.entries(factoresRiesgo).map(([key, categoria]) => (\r\n                <div key={key} className=\"border border-gray-200 dark:border-[#333333] rounded-lg overflow-hidden\">\r\n                  <div className=\"bg-gray-50 dark:bg-[#1a1a1a] px-4 py-2 border-b border-gray-200 dark:border-[#333333]\">\r\n                    <h4 className=\"font-semibold text-gray-700 dark:text-white text-sm\">\r\n                      {categoria.titulo}\r\n                    </h4>\r\n                  </div>\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead>\r\n                        <tr className=\"bg-gray-50 dark:bg-[#1a1a1a]\">\r\n                          <th className=\"text-left px-3 py-2 font-medium w-1/2\">Factor</th>\r\n                          <th className=\"text-center px-2 py-2 font-medium w-16\">ALTO</th>\r\n                          <th className=\"text-center px-2 py-2 font-medium w-16\">MEDIO</th>\r\n                          <th className=\"text-center px-2 py-2 font-medium w-16\">BAJO</th>\r\n                          <th className=\"text-center px-2 py-2 font-medium w-16\">N/A</th>\r\n                          <th className=\"text-left px-3 py-2 font-medium\">OBSERVACIONES</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {categoria.items.map((item, idx) => (\r\n                          <tr key={idx} className=\"border-t border-gray-100 dark:border-slate-700\">\r\n                            <td className=\"px-3 py-2 text-gray-700 dark:text-gray-300\">{item}</td>\r\n                            {['alto', 'medio', 'bajo', 'na'].map((nivel) => (\r\n                              <td key={nivel} className=\"text-center px-2 py-2\">\r\n                                <input\r\n                                  type=\"radio\"\r\n                                  name={`factor_${key}_${idx}`}\r\n                                  checked={formData.factores_riesgo[item]?.calificacion === nivel}\r\n                                  onChange={() => {\r\n                                    // Permitir des-seleccionar haciendo clic de nuevo\r\n                                    if (formData.factores_riesgo[item]?.calificacion === nivel) {\r\n                                      updateFactorRiesgo(item, 'calificacion', '');\r\n                                    } else {\r\n                                      updateFactorRiesgo(item, 'calificacion', nivel);\r\n                                    }\r\n                                  }}\r\n                                  className=\"w-4 h-4 text-indigo-500 cursor-pointer\"\r\n                                  disabled={modoVista}\r\n                                />\r\n                              </td>\r\n                            ))}\r\n                            <td className=\"px-2 py-2\">\r\n                              <Input\r\n                                className=\"h-8 text-xs\"\r\n                                value={formData.factores_riesgo[item]?.observaciones || ''}\r\n                                onChange={(e) => updateFactorRiesgo(item, 'observaciones', e.target.value)}\r\n                                placeholder=\"Observaciones\"\r\n                                disabled={modoVista}\r\n                              />\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* ============ PASO 6: CONCEPTO FINAL ============ */}\r\n          {currentStep === 6 && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <Label className=\"text-base font-semibold\">CONCEPTO PSICOLÓGICO FINAL <span className=\"text-red-500\">*</span></Label>\r\n                  {!modoVista && (\r\n                    <Button\r\n                      type=\"button\"\r\n                      onClick={generarConceptoAutomatico}\r\n                      disabled={generandoConcepto}\r\n                      className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n                    >\r\n                      {generandoConcepto ? (\r\n                        <>\r\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                          Generando...\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <FileText className=\"h-4 w-4 mr-2\" />\r\n                          {formData.concepto_psicologico_final ? 'Regenerar Concepto' : 'Generar Concepto Automáticamente'}\r\n                        </>\r\n                      )}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                {!modoVista && formData.concepto_psicologico_final && (\r\n                  <div className=\"text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md mb-2\">\r\n                    <strong>Nota:</strong> Si modificó los factores de riesgo, puede regenerar el concepto haciendo clic en el botón de arriba.\r\n                  </div>\r\n                )}\r\n                <Textarea\r\n                  value={formData.concepto_psicologico_final}\r\n                  onChange={(e) => updateField('concepto_psicologico_final', e.target.value)}\r\n                  rows={12}\r\n                  placeholder=\"Escriba el concepto psicológico final de la valoración o genérelo automáticamente usando el botón de arriba...\"\r\n                  required\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-base font-semibold\">ORIENTACIÓN PSICOLÓGICA PARA REINTEGRO LABORAL</Label>\r\n                <Textarea\r\n                  value={formData.orientacion_psicologica_reintegro}\r\n                  onChange={(e) => updateField('orientacion_psicologica_reintegro', e.target.value)}\r\n                  rows={6}\r\n                  placeholder=\"Escriba las orientaciones y recomendaciones para el reintegro laboral...\"\r\n                  disabled={modoVista}\r\n                />\r\n              </div>\r\n\r\n              {/* Firmas */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 pt-6 border-t border-gray-200 dark:border-slate-700\">\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"font-semibold text-gray-700 dark:text-gray-300\">Elaboró</h4>\r\n                  <FileUpload\r\n                    value={formData.elaboro_firma}\r\n                    onChange={(url) => updateField('elaboro_firma', url)}\r\n                    label=\"Subir firma (Elaboró)\"\r\n                    accept=\"image/*,.pdf\"\r\n                    maxSize={5}\r\n                    preview={true}\r\n                  />\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Nombre y Apellido <span className=\"text-red-500\">*</span></Label>\r\n                    <Input\r\n                      value={formData.elaboro_nombre}\r\n                      onChange={(e) => updateField('elaboro_nombre', e.target.value)}\r\n                      placeholder=\"Profesionales que realizan la valoración\"\r\n                      required\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"font-semibold text-gray-700 dark:text-gray-300\">Revisión por Proveedor</h4>\r\n                  <FileUpload\r\n                    value={formData.reviso_firma}\r\n                    onChange={(url) => updateField('reviso_firma', url)}\r\n                    label=\"Subir firma (Revisó)\"\r\n                    accept=\"image/*,.pdf\"\r\n                    maxSize={5}\r\n                    preview={true}\r\n                  />\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Nombre y Apellido</Label>\r\n                    <Input\r\n                      value={formData.reviso_nombre}\r\n                      onChange={(e) => updateField('reviso_nombre', e.target.value)}\r\n                      placeholder=\"Profesional que revisa la valoración\"\r\n                      disabled={modoVista}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Navigation Buttons */}\r\n          <div className=\"flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-slate-700\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={prevStep}\r\n              disabled={currentStep === 1}\r\n              className=\"gap-2\"\r\n            >\r\n              <ChevronLeft className=\"h-4 w-4\" />\r\n              Anterior\r\n            </Button>\r\n\r\n            <div className=\"flex gap-2\">\r\n              {modoVista ? (\r\n                // Modo Vista: Solo botón de volver\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => router.push('/dashboard/valoraciones')}\r\n                  className=\"gap-2\"\r\n                >\r\n                  Volver al Listado\r\n                </Button>\r\n              ) : (\r\n                // Modo Edición/Creación: Mostrar botones de guardar y finalizar\r\n                <>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => handleSave('borrador')}\r\n                    disabled={saving}\r\n                    className=\"gap-2\"\r\n                  >\r\n                    {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Save className=\"h-4 w-4\" />}\r\n                    {valoracionId ? 'Guardar Cambios' : 'Guardar Borrador'}\r\n                  </Button>\r\n\r\n                  {currentStep < 6 ? (\r\n                    <Button onClick={nextStep} className=\"gap-2 bg-indigo-500 hover:bg-indigo-600\">\r\n                      Siguiente\r\n                      <ChevronRight className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  ) : (\r\n                    <Button\r\n                      onClick={handleFinalizar}\r\n                      disabled={finalizando || saving}\r\n                      className=\"gap-2 bg-green-500 hover:bg-green-600\"\r\n                    >\r\n                      {finalizando ? (\r\n                        <>\r\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                          Finalizando y Generando PDF...\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <Download className=\"h-4 w-4\" />\r\n                          Finalizar y Generar PDF\r\n                        </>\r\n                      )}\r\n                    </Button>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Modal de Validación */}\r\n      <Modal\r\n        isOpen={showValidationModal}\r\n        onClose={() => setShowValidationModal(false)}\r\n        title=\"Campos Requeridos\"\r\n        size=\"md\"\r\n        footer={\r\n          <div className=\"flex justify-end\">\r\n            <Button\r\n              onClick={() => setShowValidationModal(false)}\r\n              className=\"bg-indigo-500 hover:bg-indigo-600\"\r\n            >\r\n              Entendido\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-start gap-3 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800\">\r\n            <AlertTriangle className=\"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-semibold text-red-800 dark:text-red-300 mb-2\">\r\n                Por favor complete los siguientes campos:\r\n              </h4>\r\n              <ul className=\"list-disc list-inside space-y-1\">\r\n                {validationErrors.map((error, idx) => (\r\n                  <li key={idx} className=\"text-red-700 dark:text-red-300 text-sm\">\r\n                    {error}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n\r\n      {/* Modal de Descarga de Archivos */}\r\n      <Modal\r\n        isOpen={showDownloadModal}\r\n        onClose={() => {\r\n          setShowDownloadModal(false);\r\n          router.push('/dashboard/valoraciones');\r\n        }}\r\n        title=\"Valoración Finalizada Exitosamente\"\r\n        size=\"xl\"\r\n        footer={\r\n          <div className=\"flex flex-col sm:flex-row justify-between gap-3 w-full\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setShowDownloadModal(false);\r\n                router.push('/dashboard/valoraciones');\r\n              }}\r\n              className=\"gap-2\"\r\n            >\r\n              Cerrar\r\n            </Button>\r\n            <div className=\"flex flex-col sm:flex-row gap-3\">\r\n              <Button\r\n                onClick={() => {\r\n                  if (downloadUrls) {\r\n                    const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app';\r\n                    window.open(`${apiUrl}${downloadUrls.pdf_url}`, '_blank');\r\n                    toast.success('Abriendo PDF en nueva pestaña');\r\n                  }\r\n                }}\r\n                className=\"gap-2 bg-indigo-500 hover:bg-indigo-600 text-white\"\r\n              >\r\n                <FileText className=\"h-5 w-5\" />\r\n                Ver PDF\r\n              </Button>\r\n              <Button\r\n                onClick={async () => {\r\n                  if (downloadUrls) {\r\n                    try {\r\n                      await api.downloadFile(downloadUrls.pdf_url, downloadUrls.pdf_filename, false);\r\n                      toast.success('Descargando PDF...');\r\n                    } catch (error) {\r\n                      toast.error('Error al descargar el PDF');\r\n                    }\r\n                  }\r\n                }}\r\n                className=\"gap-2 bg-green-600 hover:bg-green-700 text-white\"\r\n              >\r\n                <Download className=\"h-5 w-5\" />\r\n                Descargar PDF\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-6 p-2\">\r\n          <div className=\"flex items-center justify-center py-6\">\r\n            <div className=\"flex flex-col items-center gap-4\">\r\n              <div className=\"w-20 h-20 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center\">\r\n                <Check className=\"h-10 w-10 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n              <div className=\"text-center max-w-md\">\r\n                <h3 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n                  ¡Valoración Completada!\r\n                </h3>\r\n                <p className=\"text-gray-600 dark:text-gray-400\">\r\n                  El archivo de la valoración ha sido generado exitosamente\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-center\">\r\n            <div className=\"p-5 rounded-lg border-2 border-indigo-500/20 bg-indigo-500/5 dark:bg-indigo-500/10 max-w-md w-full\">\r\n              <div className=\"flex items-start gap-4\">\r\n                <FileText className=\"h-10 w-10 text-indigo-500 flex-shrink-0 mt-1\" />\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n                    Archivo PDF\r\n                  </h4>\r\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\r\n                    Documento profesional listo para imprimir y presentar\r\n                  </p>\r\n                  <div className=\"p-2 bg-white dark:bg-slate-800 rounded border border-gray-200 dark:border-slate-700\">\r\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 break-all\">\r\n                      {downloadUrls?.pdf_filename}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <Download className=\"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\r\n              <div className=\"flex-1\">\r\n                <p className=\"text-sm text-blue-800 dark:text-blue-300\">\r\n                  <strong>Importante:</strong> El archivo queda guardado en el sistema y puede ser descargado nuevamente desde el listado de valoraciones.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\dashboard\\valoraciones\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchValoraciones'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [page, estadoFilter, fetchValoraciones]","fix":{"range":[2573,2593],"text":"[page, estadoFilter, fetchValoraciones]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3293,3296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3293,3296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3769,3772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3769,3772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { ModuleGuard } from '@/app/components/guards/ModuleGuard';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { api } from '@/app/services/api';\r\nimport {\r\n  Search,\r\n  Plus,\r\n  Filter,\r\n  Download,\r\n  Eye,\r\n  Pencil,\r\n  Trash2,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  ClipboardList,\r\n  FileText,\r\n  AlertTriangle,\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { toast } from 'sonner';\r\n\r\ninterface Valoracion {\r\n  id: number;\r\n  fecha_valoracion: string;\r\n  estado: string;\r\n  trabajador_nombre?: string;\r\n  trabajador_documento?: string;\r\n  empresa?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport default function ValoracionesPage() {\r\n  const [valoraciones, setValoraciones] = useState<Valoracion[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [estadoFilter, setEstadoFilter] = useState('todos');\r\n  const [page, setPage] = useState(1);\r\n  const [total, setTotal] = useState(0);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [valoracionToDelete, setValoracionToDelete] = useState<Valoracion | null>(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n  const limit = 10;\r\n\r\n  const fetchValoraciones = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        skip: String((page - 1) * limit),\r\n        limit: String(limit),\r\n      });\r\n\r\n      if (estadoFilter && estadoFilter !== 'todos') {\r\n        params.append('estado', estadoFilter);\r\n      }\r\n\r\n      if (search.trim()) {\r\n        params.append('buscar', search.trim());\r\n      }\r\n\r\n      const response = await api.get<{ items: Valoracion[], total: number }>(\r\n        `/valoraciones/?${params.toString()}`\r\n      );\r\n      setValoraciones(response.items || []);\r\n      setTotal(response.total || 0);\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al cargar valoraciones');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchValoraciones();\r\n  }, [page, estadoFilter]);\r\n\r\n  const handleSearch = () => {\r\n    setPage(1);\r\n    fetchValoraciones();\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter') handleSearch();\r\n  };\r\n\r\n  const openDeleteDialog = (valoracion: Valoracion) => {\r\n    setValoracionToDelete(valoracion);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!valoracionToDelete) return;\r\n\r\n    setDeleting(true);\r\n    try {\r\n      await api.delete(`/valoraciones/${valoracionToDelete.id}`);\r\n      setDeleteDialogOpen(false);\r\n      setValoracionToDelete(null);\r\n      await fetchValoraciones();\r\n      toast.success('Valoración eliminada correctamente');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al eliminar');\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleDownloadPDF = async (id: number, documento?: string) => {\r\n    try {\r\n      toast.info('Generando archivo PDF...');\r\n      await api.downloadFile(\r\n        `/valoraciones/${id}/descargar-pdf`,\r\n        `valoracion_${documento || id}.pdf`,\r\n        true\r\n      );\r\n      toast.success('PDF descargado exitosamente');\r\n    } catch (error: any) {\r\n      console.error('Error al descargar PDF:', error);\r\n      toast.error(error.message || 'Error al descargar PDF');\r\n    }\r\n  };\r\n\r\n  const estadoBadgeColor = (estado: string) => {\r\n    switch (estado.toLowerCase()) {\r\n      case 'completada':\r\n        return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';\r\n      case 'revisada':\r\n        return 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400';\r\n      case 'borrador':\r\n        return 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400';\r\n      default:\r\n        return 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400';\r\n    }\r\n  };\r\n\r\n  const getEstadoLabel = (estado: string) => {\r\n    switch (estado.toLowerCase()) {\r\n      case 'completada': return 'Completada';\r\n      case 'revisada': return 'En Revisión';\r\n      case 'borrador': return 'Borrador';\r\n      default: return estado;\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('es-ES', {\r\n      day: 'numeric',\r\n      month: 'short',\r\n      year: 'numeric',\r\n    });\r\n  };\r\n\r\n  const totalPages = Math.ceil(total / limit);\r\n\r\n  return (\r\n    <ModuleGuard requiredModule=\"valoraciones\">\r\n      <DashboardLayout>\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3\">\r\n                <ClipboardList className=\"w-8 h-8 text-indigo-500\" />\r\n                Valoraciones Psicológicas\r\n              </h1>\r\n              <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                Gestiona las valoraciones psicológicas de los trabajadores\r\n              </p>\r\n            </div>\r\n            <Link href=\"/dashboard/valoraciones/nueva\">\r\n              <Button className=\"bg-indigo-500 hover:bg-indigo-600 text-white shadow-lg shadow-indigo-500/25\">\r\n                <Plus className=\"mr-2 h-4 w-4\" />\r\n                Nueva Valoración\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <Card className=\"border-gray-200 dark:border-[#333333]\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex flex-col md:flex-row gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\r\n                    <Input\r\n                      placeholder=\"Buscar por nombre, identificación o empresa...\"\r\n                      value={search}\r\n                      onChange={(e) => setSearch(e.target.value)}\r\n                      onKeyPress={handleKeyPress}\r\n                      className=\"pl-10 bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"w-full md:w-48\">\r\n                  <Select value={estadoFilter} onValueChange={(value) => { setEstadoFilter(value); setPage(1); }}>\r\n                    <SelectTrigger className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\">\r\n                      <Filter className=\"mr-2 h-4 w-4\" />\r\n                      <SelectValue placeholder=\"Todos\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"todos\">Todos</SelectItem>\r\n                      <SelectItem value=\"borrador\">Borrador</SelectItem>\r\n                      <SelectItem value=\"completada\">Completada</SelectItem>\r\n                      <SelectItem value=\"revisada\">En Revisión</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <Button\r\n                  onClick={handleSearch}\r\n                  className=\"bg-indigo-500 hover:bg-indigo-600 text-white\"\r\n                >\r\n                  <Search className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Table */}\r\n          <Card className=\"border-gray-200 dark:border-[#333333]\">\r\n            <CardContent className=\"p-0\">\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center h-64\">\r\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500\"></div>\r\n                </div>\r\n              ) : valoraciones.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400\">\r\n                  <ClipboardList className=\"h-16 w-16 mb-4 opacity-20\" />\r\n                  <p className=\"text-lg font-medium\">No hay valoraciones</p>\r\n                  <p className=\"text-sm\">Crea una nueva valoración para comenzar</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full\">\r\n                    <thead className=\"bg-gray-50 dark:bg-[#1a1a1a] border-b border-gray-200 dark:border-[#333333]\">\r\n                      <tr>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Trabajador\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Documento\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Empresa\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Fecha\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Estado\r\n                        </th>\r\n                        <th className=\"px-6 py-4 text-center text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider\">\r\n                          Acciones\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white dark:bg-[#2a2a2a] divide-y divide-gray-100 dark:divide-[#333333]\">\r\n                      {valoraciones.map((valoracion) => (\r\n                        <tr\r\n                          key={valoracion.id}\r\n                          className=\"hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors\"\r\n                        >\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className=\"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-sm\">\r\n                                {valoracion.trabajador_nombre\r\n                                  ? valoracion.trabajador_nombre.charAt(0).toUpperCase()\r\n                                  : '?'}\r\n                              </div>\r\n                              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                                {valoracion.trabajador_nombre || 'Sin nombre'}\r\n                              </span>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                              {valoracion.trabajador_documento || 'Sin documento'}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300\">\r\n                              <FileText className=\"h-4 w-4 text-gray-400\" />\r\n                              {valoracion.empresa || 'Sin empresa'}\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                              {formatDate(valoracion.fecha_valoracion || valoracion.created_at)}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span\r\n                              className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${estadoBadgeColor(\r\n                                valoracion.estado\r\n                              )}`}\r\n                            >\r\n                              {getEstadoLabel(valoracion.estado)}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <div className=\"flex items-center justify-center gap-1\">\r\n                              {/* Ver */}\r\n                              <Link href={`/dashboard/valoraciones/nueva?id=${valoracion.id}&modo=ver`}>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  className=\"h-8 w-8 p-0 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-600\"\r\n                                  title=\"Ver detalles\"\r\n                                >\r\n                                  <Eye className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </Link>\r\n\r\n                              {/* Editar */}\r\n                              <Link href={`/dashboard/valoraciones/nueva?id=${valoracion.id}&modo=editar`}>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  className=\"h-8 w-8 p-0 hover:bg-green-100 dark:hover:bg-green-900/30 text-green-600\"\r\n                                  title=\"Editar valoración\"\r\n                                >\r\n                                  <Pencil className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </Link>\r\n\r\n                              {/* Descargar PDF (solo para completadas) */}\r\n                              {valoracion.estado.toLowerCase() === 'completada' && (\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => handleDownloadPDF(valoracion.id, valoracion.trabajador_documento)}\r\n                                  className=\"h-8 w-8 p-0 hover:bg-purple-100 dark:hover:bg-purple-900/30 text-purple-600\"\r\n                                  title=\"Descargar PDF\"\r\n                                >\r\n                                  <Download className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              )}\r\n\r\n                              {/* Eliminar */}\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                onClick={() => openDeleteDialog(valoracion)}\r\n                                className=\"h-8 w-8 p-0 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-500\"\r\n                                title=\"Eliminar\"\r\n                              >\r\n                                <Trash2 className=\"h-4 w-4\" />\r\n                              </Button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n\r\n              {/* Pagination */}\r\n              {!loading && valoraciones.length > 0 && (\r\n                <div className=\"px-6 py-4 border-t border-gray-200 dark:border-[#333333] flex items-center justify-between\">\r\n                  <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    Mostrando {(page - 1) * limit + 1} a {Math.min(page * limit, total)} de {total}{' '}\r\n                    resultados\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setPage(page - 1)}\r\n                      disabled={page === 1}\r\n                      className=\"border-gray-200 dark:border-[#333333]\"\r\n                    >\r\n                      <ChevronLeft className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <div className=\"flex items-center gap-2 px-3 text-sm text-gray-700 dark:text-gray-300\">\r\n                      Página {page} de {totalPages || 1}\r\n                    </div>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setPage(page + 1)}\r\n                      disabled={page >= totalPages}\r\n                      className=\"border-gray-200 dark:border-[#333333]\"\r\n                    >\r\n                      <ChevronRight className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Delete Confirmation Modal */}\r\n          <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n            <DialogContent className=\"sm:max-w-md\">\r\n              <DialogHeader>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center\">\r\n                    <AlertTriangle className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <DialogTitle>Eliminar Valoración Psicológica</DialogTitle>\r\n                    <DialogDescription>\r\n                      Esta acción no se puede deshacer\r\n                    </DialogDescription>\r\n                  </div>\r\n                </div>\r\n              </DialogHeader>\r\n              <div className=\"py-4\">\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                  ¿Estás seguro de que deseas eliminar la valoración psicológica de{' '}\r\n                  <span className=\"font-semibold text-gray-900 dark:text-white\">\r\n                    {valoracionToDelete?.trabajador_nombre || 'Sin nombre'}\r\n                  </span>\r\n                  ? Se eliminarán todos los datos asociados incluyendo el trabajador, empresa y evaluación.\r\n                </p>\r\n              </div>\r\n              <DialogFooter className=\"gap-2 sm:gap-0\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => setDeleteDialogOpen(false)}\r\n                  disabled={deleting}\r\n                  className=\"border-gray-200 dark:border-[#444444]\"\r\n                >\r\n                  Cancelar\r\n                </Button>\r\n                <Button\r\n                  onClick={handleDelete}\r\n                  disabled={deleting}\r\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n                >\r\n                  {deleting ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\"></div>\r\n                      Eliminando...\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                      Eliminar\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </DialogFooter>\r\n            </DialogContent>\r\n          </Dialog>\r\n        </div>\r\n      </DashboardLayout>\r\n    </ModuleGuard>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1438,1441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1438,1441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2248,2251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2248,2251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { api } from '@/app/services/api';\r\nimport Image from 'next/image';\r\nimport { toast } from 'sonner';\r\nimport { Eye, EyeOff, Loader2, Mail, Lock, CheckCircle2, AlertCircle } from 'lucide-react';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\nexport default function LoginPage() {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  // Password Reset State\r\n  const [resetModalOpen, setResetModalOpen] = useState(false);\r\n  const [resetEmail, setResetEmail] = useState('');\r\n  const [isResetting, setIsResetting] = useState(false);\r\n\r\n  const { login } = useAuth();\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await login(email, password);\r\n      toast.success('¡Bienvenido al sistema!');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Credenciales incorrectas');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleResetPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!resetEmail) {\r\n      toast.error('Por favor ingresa tu correo electrónico');\r\n      return;\r\n    }\r\n\r\n    setIsResetting(true);\r\n\r\n    try {\r\n      await api.post('/auth/password-reset-request', { email: resetEmail });\r\n\r\n      toast.success('Solicitud enviada correctamente', {\r\n        description: 'Se ha notificado al administrador para gestionar el restablecimiento de tu contraseña.',\r\n        icon: <CheckCircle2 className=\"h-5 w-5 text-green-500\" />,\r\n        duration: 5000,\r\n      });\r\n\r\n      setResetModalOpen(false);\r\n      setResetEmail('');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al procesar la solicitud');\r\n    } finally {\r\n      setIsResetting(false);\r\n    }\r\n  };\r\n\r\n  if (!mounted) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-white\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-slate-100 to-indigo-50 relative overflow-hidden transition-colors duration-500\">\r\n      {/* Background Effects */}\r\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\r\n        {/* Animated Gradient Orbs */}\r\n        <div className=\"absolute top-0 left-1/4 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl animate-pulse\"></div>\r\n        <div className=\"absolute bottom-0 right-1/4 w-96 h-96 bg-violet-500/20 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '1s' }}></div>\r\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-fuchsia-500/15 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '2s' }}></div>\r\n        <div className=\"absolute -top-20 -right-20 w-80 h-80 bg-cyan-400/15 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '1.5s' }}></div>\r\n        <div className=\"absolute -bottom-20 -left-20 w-80 h-80 bg-pink-400/15 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '2.5s' }}></div>\r\n      </div>\r\n\r\n      {/* Login Card */}\r\n      <div className=\"relative z-10 w-full max-w-md mx-4\">\r\n        <div className=\"bg-white/80 dark:bg-[#2a2a2a]/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 dark:border-[#333333]/50 overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"px-8 pt-12 pb-8 text-center bg-white dark:bg-[#2a2a2a] relative\">\r\n            <div className=\"flex justify-center mb-6\">\r\n              <div className=\"relative w-64 h-24\">\r\n                <Image\r\n                  src=\"/images/mentis-logo.svg\"\r\n                  alt=\"Mentis - Sistema Integral de Psicología Ocupacional\"\r\n                  fill\r\n                  className=\"object-contain scale-[1.8]\"\r\n                  priority\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"px-8 pb-8\">\r\n            {/* Email/Password Form */}\r\n            <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n              {/* Email Input */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide\">\r\n                  Correo Electrónico\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400\" />\r\n                  <input\r\n                    type=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    placeholder=\"correo@ejemplo.com\"\r\n                    required\r\n                    className=\"w-full pl-12 pr-4 py-3.5 rounded-xl bg-gray-50 dark:bg-[#1a1a1a] border-2 border-gray-200 dark:border-[#333333] text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-[#6b6b6b] focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Password Input */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide\">\r\n                  Contraseña\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <Lock className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400\" />\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    placeholder=\"••••••••\"\r\n                    required\r\n                    className=\"w-full pl-12 pr-12 py-3.5 rounded-xl bg-gray-50 dark:bg-[#1a1a1a] border-2 border-gray-200 dark:border-[#333333] text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-[#6b6b6b] focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-4 top-1/2 -translate-y-1/2\"\r\n                  >\r\n                    {showPassword ? (\r\n                      <EyeOff className=\"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\" />\r\n                    ) : (\r\n                      <Eye className=\"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\" />\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Submit Button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isSubmitting}\r\n                className=\"w-full py-3.5 rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 disabled:from-indigo-400 disabled:to-indigo-500 text-white font-bold transition-all duration-200 flex items-center justify-center gap-2 shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50\"\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                    <span>Ingresando...</span>\r\n                  </>\r\n                ) : (\r\n                  <span>Iniciar Sesión</span>\r\n                )}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Lost Password Link */}\r\n            <div className=\"mt-6 text-center\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setResetModalOpen(true)}\r\n                className=\"text-sm text-gray-600 dark:text-[#b0b0b0] hover:text-indigo-600 dark:hover:text-indigo-400 font-medium transition-colors\"\r\n              >\r\n                ¿Olvidaste tu contraseña?\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"px-8 py-6 bg-gray-50/50 dark:bg-[#1a1a1a]/50 border-t border-gray-200 dark:border-[#333333]\">\r\n            <p className=\"text-center text-xs text-gray-500 dark:text-[#6b6b6b]\">\r\n              © 2026 Mentis. Sistema Integral de Psicología Ocupacional\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Recover Password Modal */}\r\n      <Dialog open={resetModalOpen} onOpenChange={setResetModalOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2 text-indigo-600\">\r\n              <AlertCircle className=\"h-5 w-5\" />\r\n              Restablecer Contraseña\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Ingresa tu correo electrónico y notificaremos al administrador el sistema para que te ayude a restablecer tu acceso.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <form onSubmit={handleResetPassword} className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"reset-email\">Correo Electrónico</Label>\r\n              <Input\r\n                id=\"reset-email\"\r\n                type=\"email\"\r\n                placeholder=\"correo@ejemplo.com\"\r\n                value={resetEmail}\r\n                onChange={(e) => setResetEmail(e.target.value)}\r\n                required\r\n                className=\"pl-10\"\r\n              />\r\n              <Mail className=\"absolute left-8 top-[118px] h-4 w-4 text-gray-400 pointer-events-none\" />\r\n              {/* Note: Absolute positioning might be tricky inside Dialog with padding, simplified approach below */}\r\n            </div>\r\n\r\n            <DialogFooter className=\"gap-2 sm:gap-0\">\r\n              <Button type=\"button\" variant=\"outline\" onClick={() => setResetModalOpen(false)}>\r\n                Cancelar\r\n              </Button>\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={isResetting}\r\n                className=\"bg-indigo-600 hover:bg-indigo-700 text-white\"\r\n              >\r\n                {isResetting ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    Enviando...\r\n                  </>\r\n                ) : (\r\n                  'Notificar al Administrador'\r\n                )}\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\services\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1219,1222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1219,1222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2417,2420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2417,2420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3483,3486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3483,3486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app';\r\n\r\nclass ApiService {\r\n  private getToken(): string | null {\r\n    if (typeof window !== 'undefined') {\r\n      return localStorage.getItem('token');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private getHeaders(): HeadersInit {\r\n    const headers: HeadersInit = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    const token = this.getToken();\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n    }\r\n    return headers;\r\n  }\r\n\r\n  async get<T>(endpoint: string): Promise<T> {\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      method: 'GET',\r\n      headers: this.getHeaders(),\r\n    });\r\n    if (!response.ok) {\r\n      if (response.status === 401) {\r\n        if (typeof window !== 'undefined') {\r\n          localStorage.removeItem('token');\r\n          localStorage.removeItem('user');\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n      const error = await response.json().catch(() => ({ detail: 'Error de conexión' }));\r\n      throw new Error(error.detail || 'Error en la petición');\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  async post<T>(endpoint: string, data: any): Promise<T> {\r\n    try {\r\n      console.log(`[API] POST Request to ${endpoint}`);\r\n      const response = await fetch(`${API_URL}${endpoint}`, {\r\n        method: 'POST',\r\n        headers: this.getHeaders(),\r\n        body: JSON.stringify(data),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.error(`[API] Error ${response.status} in POST ${endpoint}`);\r\n        const errorData = await response.json().catch(() => ({ detail: `Error HTTP ${response.status}` }));\r\n\r\n        let errorMessage = `Error en la petición: ${response.status}`;\r\n        if (errorData.detail) {\r\n          if (typeof errorData.detail === 'string') {\r\n            errorMessage = errorData.detail;\r\n          } else if (Array.isArray(errorData.detail)) {\r\n            // FastAPI validation error format\r\n            errorMessage = errorData.detail\r\n              .map((err: any) => `${err.loc ? err.loc.join('.') : ''}: ${err.msg}`)\r\n              .join('\\n');\r\n          } else if (typeof errorData.detail === 'object') {\r\n            errorMessage = JSON.stringify(errorData.detail);\r\n          }\r\n        }\r\n\r\n        throw new Error(errorMessage);\r\n      }\r\n      return response.json();\r\n    } catch (error: any) {\r\n      console.error(`[API] Network/Fetch Error in POST ${endpoint}:`, error);\r\n      // Re-throw con mensaje más claro si esFailed to fetch\r\n      if (error.message === 'Failed to fetch') {\r\n        throw new Error('Error de conexión con el servidor. Verifique su internet o el estado del servicio.');\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async postFormData<T>(endpoint: string, formData: FormData): Promise<T> {\r\n    const token = this.getToken();\r\n    const headers: HeadersInit = {};\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n    }\r\n    // No establecer Content-Type para FormData, el navegador lo hace automáticamente\r\n\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      method: 'POST',\r\n      headers,\r\n      body: formData,\r\n    });\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ detail: 'Error de conexión' }));\r\n      throw new Error(error.detail || 'Error en la petición');\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  async put<T>(endpoint: string, data: any): Promise<T> {\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      method: 'PUT',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify(data),\r\n    });\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ detail: 'Error de conexión' }));\r\n      throw new Error(error.detail || 'Error en la petición');\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  async delete<T>(endpoint: string): Promise<T | void> {\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      method: 'DELETE',\r\n      headers: this.getHeaders(),\r\n    });\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ detail: 'Error de conexión' }));\r\n      throw new Error(error.detail || 'Error en la petición');\r\n    }\r\n    // 204 No Content responses don't have a body\r\n    if (response.status === 204) {\r\n      return;\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  async downloadFile(endpoint: string, filename: string, viewInNewTab: boolean = false): Promise<void> {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('No hay sesión activa. Por favor inicie sesión.');\r\n    }\r\n\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      method: 'GET',\r\n      headers: { 'Authorization': `Bearer ${token}` },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ detail: 'Error al descargar' }));\r\n      throw new Error(error.detail || 'Error al descargar');\r\n    }\r\n\r\n    const blob = await response.blob();\r\n    const url = window.URL.createObjectURL(blob);\r\n\r\n    if (viewInNewTab) {\r\n      window.open(url, '_blank');\r\n      // Note: We can't revoke object URL immediately for new tab, \r\n      // but usually browsers handle this or we rely on page unload which is fine for SPA\r\n      setTimeout(() => window.URL.revokeObjectURL(url), 60000); // Revoke after 1 min as cleanup\r\n    } else {\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = filename;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      document.body.removeChild(a);\r\n    }\r\n  }\r\n}\r\n\r\nexport const api = new ApiService();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\app\\utils\\factoresRiesgoCalculos.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\PruebaTrabajoTOWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":9,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CONCLUSION_OPTIONS' is assigned a value but never used.","line":36,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":119,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":120,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":121,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":121,"endColumn":71},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'mode' and 'token'. Either include them or remove the dependency array.","line":133,"column":8,"nodeType":"ArrayExpression","endLine":133,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [mode, pruebaId, token]","fix":{"range":[7089,7099],"text":"[mode, pruebaId, token]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":262,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":262,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14265,14268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14265,14268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used.","line":298,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":298,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isUpcoming' is assigned a value but never used.","line":302,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":302,"endColumn":37}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/app/context/AuthContext';\r\nimport { toast } from 'sonner';\r\nimport {\r\n    Save, ChevronLeft, ChevronRight, Download, Loader2,\r\n    Plus, Trash2, CheckCircle2, FileText, User, Briefcase,\r\n    Activity, AlertTriangle // Updated icons\r\n} from 'lucide-react';\r\nimport { Step1Identificacion } from './prueba-trabajo/Step1Identificacion';\r\nimport { Step2MetodologiaCondiciones } from './prueba-trabajo/Step2MetodologiaCondiciones';\r\nimport { Step3Tareas } from './prueba-trabajo/Step3Tareas';\r\nimport { Step4MaterialesPeligros } from './prueba-trabajo/Step4MaterialesPeligros';\r\nimport { Step5ConceptoRegistro } from './prueba-trabajo/Step5ConceptoRegistro';\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app';\r\n\r\ninterface PruebaTrabajoTOWizardProps {\r\n    mode: 'create' | 'edit' | 'view';\r\n    id?: number | null;\r\n    readOnly?: boolean;\r\n}\r\n\r\n// ── Categorías de peligro fijas ──────────────────────────────────────\r\nconst CATEGORIAS_PELIGRO = [\r\n    { value: 'fisicos', label: 'Físicos' },\r\n    { value: 'biologicos', label: 'Biológicos' },\r\n    { value: 'biomecanicos', label: 'Biomecánicos' },\r\n    { value: 'psicosociales', label: 'Psicosociales' },\r\n    { value: 'quimicos', label: 'Químicos' },\r\n    { value: 'cond_seguridad', label: 'Cond. Seguridad' },\r\n];\r\n\r\nconst CONCLUSION_OPTIONS = [\r\n    { value: 'reintegro_sin_modificaciones', label: 'Reintegro sin modificaciones' },\r\n    { value: 'reintegro_con_modificaciones', label: 'Reintegro con modificaciones' },\r\n    { value: 'desarrollo_capacidades', label: 'Desarrollo de capacidades' },\r\n    { value: 'no_puede_desempenarla', label: 'No puede desempeñarla' },\r\n];\r\n\r\n// ── Initial data ────────────────────────────────────────────────────\r\nconst emptyTarea = () => ({\r\n    actividad: '', ciclo: '', subactividad: '', estandar_productividad: '',\r\n    registro_fotografico: '', descripcion_biomecanica: '', apreciacion_trabajador: '',\r\n    apreciacion_profesional: '', conclusion: '', descripcion_conclusion: '', orden: 0,\r\n});\r\n\r\nconst emptyMaterial = () => ({\r\n    nombre: '', descripcion: '', requerimientos_operacion: '', observaciones: '', orden: 0,\r\n});\r\n\r\nconst initialFormData = {\r\n    // Identificación\r\n    fecha_valoracion: '', ultimo_dia_incapacidad: '', nombre_trabajador: '',\r\n    numero_documento: '', id_siniestro: '', fecha_nacimiento: '', edad: '',\r\n    dominancia: '', estado_civil: '', nivel_educativo: '', telefonos_trabajador: '',\r\n    direccion_residencia: '', diagnosticos_atel: '', fechas_eventos_atel: '',\r\n    eps_ips: '', afp: '', tiempo_incapacidad_dias: '', empresa: '', nit_empresa: '',\r\n    cargo_actual: '', cargo_unico: '', area_seccion: '', fecha_ingreso_cargo: '',\r\n    antiguedad_cargo: '', fecha_ingreso_empresa: '', antiguedad_empresa: '',\r\n    forma_vinculacion: '', modalidad: '', tiempo_modalidad: '', contacto_empresa: '',\r\n    correos_electronicos: '', telefonos_empresa: '', direccion_empresa: '',\r\n    // Secciones texto\r\n    metodologia: '', descripcion_proceso_productivo: '', apreciacion_trabajador_proceso: '',\r\n    estandares_productividad: '', verificacion_acciones_correctivas: '', concepto_prueba_trabajo: '',\r\n    // Desempeño organizacional\r\n    jornada: '', ritmo: '', descansos_programados: '', turnos: '',\r\n    tiempos_efectivos: '', rotaciones: '', horas_extras: '', distribucion_semanal: '',\r\n    // Recomendaciones\r\n    para_trabajador: '', para_empresa: '',\r\n    // Registro\r\n    nombre_elaboro: '', firma_elaboro: '', nombre_revisor: '', firma_revisor: '', nombre_proveedor: '',\r\n};\r\n\r\n// ── Steps (Updated) ─────────────────────────────────────────────────\r\nconst STEPS = [\r\n    { id: 1, title: 'Identificación', icon: User, desc: 'Datos del trabajador' },\r\n    { id: 2, title: 'Metodología y Condiciones', icon: Briefcase, desc: 'Metodología y entorno' },\r\n    { id: 3, title: 'Tareas y Requerimientos', icon: Activity, desc: 'Análisis de tareas' },\r\n    { id: 4, title: 'Materiales y Peligros', icon: AlertTriangle, desc: 'Equipos y riesgos' },\r\n    { id: 5, title: 'Concepto y Registro', icon: FileText, desc: 'Conclusión y firmas' },\r\n];\r\n\r\n\r\nexport function PruebaTrabajoTOWizard({ mode, id, readOnly = false }: PruebaTrabajoTOWizardProps) {\r\n    const router = useRouter();\r\n    const { token } = useAuth();\r\n    const [currentStep, setCurrentStep] = useState(1);\r\n    const [formData, setFormData] = useState({ ...initialFormData });\r\n    const [tareas, setTareas] = useState([emptyTarea()]);\r\n    const [materiales, setMateriales] = useState([emptyMaterial()]);\r\n    const [peligros, setPeligros] = useState(\r\n        CATEGORIAS_PELIGRO.map(c => ({ categoria: c.value, descripcion: '', tipos_control_existente: '', recomendaciones_control: '' }))\r\n    );\r\n    const [pruebaId, setPruebaId] = useState<number | null>(id || null);\r\n    const [saving, setSaving] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [showDownloadModal, setShowDownloadModal] = useState(false);\r\n    const [downloadUrl, setDownloadUrl] = useState('');\r\n\r\n    // ── Load existing data ────────────────────────────────────────────\r\n    useEffect(() => {\r\n        if (!pruebaId || mode === 'create') return;\r\n        setLoading(true);\r\n        fetch(`${API_URL}/formatos-to/pruebas-trabajo/${pruebaId}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n        })\r\n            .then(r => { if (!r.ok) throw new Error('Error'); return r.json(); })\r\n            .then(data => {\r\n                const i = data.identificacion || {};\r\n                const s = data.secciones_texto || {};\r\n                const d = data.desempeno_organizacional || {};\r\n                const rec = data.recomendaciones || {};\r\n                const reg = data.registro || {};\r\n                setFormData({\r\n                    ...initialFormData,\r\n                    ...Object.fromEntries(Object.entries(i).filter(([_, v]) => v !== null).map(([k, v]) => [k, String(v)])),\r\n                    ...Object.fromEntries(Object.entries(s).filter(([_, v]) => v !== null).map(([k, v]) => [k, String(v)])),\r\n                    ...Object.fromEntries(Object.entries(d).filter(([_, v]) => v !== null).map(([k, v]) => [k, String(v)])),\r\n                    para_trabajador: rec.para_trabajador || '', para_empresa: rec.para_empresa || '',\r\n                    nombre_elaboro: reg.nombre_elaboro || '', nombre_revisor: reg.nombre_revisor || '',\r\n                    nombre_proveedor: reg.nombre_proveedor || '',\r\n                    firma_elaboro: reg.firma_elaboro || '', firma_revisor: reg.firma_revisor || '',\r\n                });\r\n                if (data.tareas?.length) setTareas(data.tareas);\r\n                if (data.materiales_equipos?.length) setMateriales(data.materiales_equipos);\r\n                if (data.peligros?.length) setPeligros(data.peligros);\r\n            })\r\n            .catch(e => toast.error(e.message))\r\n            .finally(() => setLoading(false));\r\n    }, [pruebaId]);\r\n\r\n    const updateField = (field: string, value: string) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    // ── Build payload ─────────────────────────────────────────────────\r\n    const buildPayload = (finalizar = false) => ({\r\n        estado: finalizar ? 'completada' : 'borrador',\r\n        identificacion: {\r\n            fecha_valoracion: formData.fecha_valoracion || null,\r\n            ultimo_dia_incapacidad: formData.ultimo_dia_incapacidad || null,\r\n            nombre_trabajador: formData.nombre_trabajador || null,\r\n            numero_documento: formData.numero_documento || null,\r\n            id_siniestro: formData.id_siniestro || null,\r\n            fecha_nacimiento: formData.fecha_nacimiento || null,\r\n            edad: formData.edad ? parseInt(formData.edad) : null,\r\n            dominancia: formData.dominancia || null,\r\n            estado_civil: formData.estado_civil || null,\r\n            nivel_educativo: formData.nivel_educativo || null,\r\n            telefonos_trabajador: formData.telefonos_trabajador || null,\r\n            direccion_residencia: formData.direccion_residencia || null,\r\n            diagnosticos_atel: formData.diagnosticos_atel || null,\r\n            fechas_eventos_atel: formData.fechas_eventos_atel || null,\r\n            eps_ips: formData.eps_ips || null,\r\n            afp: formData.afp || null,\r\n            tiempo_incapacidad_dias: formData.tiempo_incapacidad_dias ? parseInt(formData.tiempo_incapacidad_dias) : null,\r\n            empresa: formData.empresa || null,\r\n            nit_empresa: formData.nit_empresa || null,\r\n            cargo_actual: formData.cargo_actual || null,\r\n            cargo_unico: formData.cargo_unico === 'true' ? true : formData.cargo_unico === 'false' ? false : null,\r\n            area_seccion: formData.area_seccion || null,\r\n            fecha_ingreso_cargo: formData.fecha_ingreso_cargo || null,\r\n            antiguedad_cargo: formData.antiguedad_cargo || null,\r\n            fecha_ingreso_empresa: formData.fecha_ingreso_empresa || null,\r\n            antiguedad_empresa: formData.antiguedad_empresa || null,\r\n            forma_vinculacion: formData.forma_vinculacion || null,\r\n            modalidad: formData.modalidad || null,\r\n            tiempo_modalidad: formData.tiempo_modalidad || null,\r\n            contacto_empresa: formData.contacto_empresa || null,\r\n            correos_electronicos: formData.correos_electronicos || null,\r\n            telefonos_empresa: formData.telefonos_empresa || null,\r\n            direccion_empresa: formData.direccion_empresa || null,\r\n        },\r\n        secciones_texto: {\r\n            metodologia: formData.metodologia || null,\r\n            descripcion_proceso_productivo: formData.descripcion_proceso_productivo || null,\r\n            apreciacion_trabajador_proceso: formData.apreciacion_trabajador_proceso || null,\r\n            estandares_productividad: formData.estandares_productividad || null,\r\n            verificacion_acciones_correctivas: formData.verificacion_acciones_correctivas || null,\r\n            concepto_prueba_trabajo: formData.concepto_prueba_trabajo || null,\r\n        },\r\n        desempeno_organizacional: {\r\n            jornada: formData.jornada || null,\r\n            ritmo: formData.ritmo || null,\r\n            descansos_programados: formData.descansos_programados || null,\r\n            turnos: formData.turnos || null,\r\n            tiempos_efectivos: formData.tiempos_efectivos || null,\r\n            rotaciones: formData.rotaciones || null,\r\n            horas_extras: formData.horas_extras || null,\r\n            distribucion_semanal: formData.distribucion_semanal || null,\r\n        },\r\n        tareas: tareas.filter(t => t.actividad || t.subactividad),\r\n        materiales_equipos: materiales.filter(m => m.nombre),\r\n        peligros: peligros,\r\n        recomendaciones: {\r\n            para_trabajador: formData.para_trabajador || null,\r\n            para_empresa: formData.para_empresa || null,\r\n        },\r\n        registro: {\r\n            nombre_elaboro: formData.nombre_elaboro || null,\r\n            firma_elaboro: formData.firma_elaboro || null,\r\n            nombre_revisor: formData.nombre_revisor || null,\r\n            firma_revisor: formData.firma_revisor || null,\r\n            nombre_proveedor: formData.nombre_proveedor || null,\r\n        },\r\n    });\r\n\r\n    const handleSave = async (finalizar = false) => {\r\n        setSaving(true);\r\n        try {\r\n            const payload = buildPayload(finalizar);\r\n\r\n            if (finalizar) {\r\n                let saveId = pruebaId;\r\n                if (!saveId) {\r\n                    const res = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/`, {\r\n                        method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },\r\n                        body: JSON.stringify(payload),\r\n                    });\r\n                    if (!res.ok) throw new Error('Error al crear');\r\n                    const d = await res.json();\r\n                    saveId = d.id;\r\n                    setPruebaId(d.id);\r\n                } else {\r\n                    const res = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/${saveId}`, {\r\n                        method: 'PUT', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },\r\n                        body: JSON.stringify(payload),\r\n                    });\r\n                    if (!res.ok) throw new Error('Error al actualizar');\r\n                }\r\n                const finRes = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/${saveId}/finalizar`, {\r\n                    method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },\r\n                    body: JSON.stringify({}),\r\n                });\r\n                if (!finRes.ok) throw new Error('Error al finalizar');\r\n                const finData = await finRes.json();\r\n                setDownloadUrl(finData.pdf_url);\r\n                setShowDownloadModal(true);\r\n                toast.success('Prueba finalizada exitosamente');\r\n            } else {\r\n                if (pruebaId) {\r\n                    const res = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/${pruebaId}`, {\r\n                        method: 'PUT', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },\r\n                        body: JSON.stringify(payload),\r\n                    });\r\n                    if (!res.ok) throw new Error('Error al guardar');\r\n                    toast.success('Guardado correctamente');\r\n                } else {\r\n                    const res = await fetch(`${API_URL}/formatos-to/pruebas-trabajo/`, {\r\n                        method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },\r\n                        body: JSON.stringify(payload),\r\n                    });\r\n                    if (!res.ok) throw new Error('Error al crear');\r\n                    const d = await res.json();\r\n                    setPruebaId(d.id);\r\n                    toast.success('Prueba creada exitosamente');\r\n                }\r\n            }\r\n        } catch (e: any) {\r\n            toast.error(e.message);\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center py-32\">\r\n                <Loader2 className=\"h-10 w-10 animate-spin text-indigo-500\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"mb-10\">\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">\r\n                    Nueva Prueba de Trabajo\r\n                </h1>\r\n                <p className=\"text-sm text-gray-500 mt-1\">\r\n                    Complete el formulario de evaluación paso a paso\r\n                </p>\r\n            </div>\r\n\r\n            {/* Stepper (Orange Theme) */}\r\n            <div className=\"flex items-start justify-between relative mb-12 px-4\">\r\n                {/* Connecting Lines */}\r\n                <div className=\"absolute top-5 left-0 w-full h-0.5 bg-gray-200 -z-20\" />\r\n                <div\r\n                    className=\"absolute top-5 left-0 h-0.5 bg-orange-500 -z-10 transition-all duration-500 ease-in-out\"\r\n                    style={{ width: `${((currentStep - 1) / (STEPS.length - 1)) * 100}%` }}\r\n                />\r\n\r\n                {STEPS.map((step, idx) => {\r\n                    const StepIcon = step.icon;\r\n                    const isActive = currentStep === step.id;\r\n                    const isCompleted = currentStep > step.id;\r\n                    const isUpcoming = currentStep < step.id;\r\n\r\n                    return (\r\n                        <div key={step.id} className=\"flex flex-col items-center relative z-10\">\r\n                            <button\r\n                                onClick={() => setCurrentStep(step.id)}\r\n                                className={`\r\n                                    flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all duration-300 bg-white\r\n                                    ${isActive\r\n                                        ? 'border-orange-500 text-orange-500 shadow-lg scale-110'\r\n                                        : isCompleted\r\n                                            ? 'border-orange-500 bg-orange-500 text-white'\r\n                                            : 'border-gray-300 text-gray-400 hover:border-gray-400'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <StepIcon className=\"h-5 w-5\" />\r\n                            </button>\r\n                            <div className={`mt-3 text-center transition-all duration-300 ${isActive ? 'text-orange-600 font-bold' : 'text-gray-500'}`}>\r\n                                <span className=\"text-xs font-semibold block whitespace-nowrap\">{step.title}</span>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Form content */}\r\n            <div className=\"bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n\r\n                {currentStep === 1 && (\r\n                    <Step1Identificacion\r\n                        formData={formData}\r\n                        updateField={updateField}\r\n                        readOnly={readOnly}\r\n                    />\r\n                )}\r\n\r\n                {currentStep === 2 && (\r\n                    <Step2MetodologiaCondiciones\r\n                        formData={formData}\r\n                        updateField={updateField}\r\n                        readOnly={readOnly}\r\n                    />\r\n                )}\r\n\r\n                {currentStep === 3 && (\r\n                    <Step3Tareas\r\n                        tareas={tareas}\r\n                        setTareas={setTareas}\r\n                        readOnly={readOnly}\r\n                    />\r\n                )}\r\n\r\n                {currentStep === 4 && (\r\n                    <Step4MaterialesPeligros\r\n                        materiales={materiales}\r\n                        setMateriales={setMateriales}\r\n                        peligros={peligros}\r\n                        setPeligros={setPeligros}\r\n                        formData={formData}\r\n                        updateField={updateField}\r\n                        readOnly={readOnly}\r\n                    />\r\n                )}\r\n\r\n                {currentStep === 5 && (\r\n                    <Step5ConceptoRegistro\r\n                        formData={formData}\r\n                        updateField={updateField}\r\n                        readOnly={readOnly}\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {/* ── Navigation bar ─────────────────────────────────────────── */}\r\n            {/* ── Navigation bar ─────────────────────────────────────────── */}\r\n            <div className=\"flex items-center justify-between mt-6\">\r\n                <button\r\n                    onClick={() => setCurrentStep(prev => Math.max(1, prev - 1))}\r\n                    disabled={currentStep === 1}\r\n                    className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 disabled:opacity-40 disabled:cursor-not-allowed transition-colors\"\r\n                >\r\n                    <ChevronLeft className=\"h-4 w-4\" /> Anterior\r\n                </button>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    {!readOnly && (\r\n                        <>\r\n                            <button\r\n                                onClick={() => handleSave(false)}\r\n                                disabled={saving}\r\n                                className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-60 transition-colors shadow-sm\"\r\n                            >\r\n                                {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Save className=\"h-4 w-4\" />}\r\n                                Guardar Borrador\r\n                            </button>\r\n                            {currentStep === STEPS.length && (\r\n                                <button\r\n                                    onClick={() => handleSave(true)}\r\n                                    disabled={saving}\r\n                                    className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-60 transition-colors shadow-sm\"\r\n                                >\r\n                                    {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Download className=\"h-4 w-4\" />}\r\n                                    Finalizar y Generar PDF\r\n                                </button>\r\n                            )}\r\n                        </>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={() => setCurrentStep(prev => Math.min(STEPS.length, prev + 1))}\r\n                        disabled={currentStep === STEPS.length}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors shadow-sm\"\r\n                    >\r\n                        Siguiente <ChevronRight className=\"h-4 w-4\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Download modal */}\r\n            {showDownloadModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\r\n                    <div className=\"bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-xl\">\r\n                        <div className=\"text-center\">\r\n                            <CheckCircle2 className=\"h-12 w-12 text-green-500 mx-auto mb-3\" />\r\n                            <h3 className=\"text-lg font-bold text-gray-800 mb-2\">¡Prueba Finalizada!</h3>\r\n                            <p className=\"text-sm text-gray-500 mb-4\">El PDF ha sido generado exitosamente.</p>\r\n                            <div className=\"flex gap-2\">\r\n                                <a\r\n                                    href={`${API_URL}${downloadUrl}`}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors\"\r\n                                >\r\n                                    <Download className=\"h-4 w-4\" /> Descargar PDF\r\n                                </a>\r\n                                <button\r\n                                    onClick={() => { setShowDownloadModal(false); router.push('/dashboard/formatos-to/pruebas-trabajo'); }}\r\n                                    className=\"flex-1 px-4 py-2 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors\"\r\n                                >\r\n                                    Volver a Lista\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\FormComponents.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'noBorderBottom' is assigned a value but never used.","line":39,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'noBorderRight' is defined but never used.","line":58,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'col' is defined but never used.","line":58,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":82},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transparent' is defined but never used.","line":87,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transparent' is defined but never used.","line":104,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":104,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\n// ==========================================\r\n// Modern UI Components (Shadcn/Tailwind)\r\n// ==========================================\r\n\r\ninterface FormSectionProps {\r\n    title: string;\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}\r\n\r\nexport const FormSection = ({ title, children, className }: FormSectionProps) => {\r\n    return (\r\n        <Card className={cn(\"mb-6 shadow-sm border-slate-200\", className)}>\r\n            <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 pb-3 pt-3\">\r\n                <CardTitle className=\"text-sm font-semibold text-slate-700 uppercase tracking-wide\">\r\n                    {title}\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"p-4 space-y-4 pt-4\">\r\n                {children}\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n};\r\n\r\ninterface FormRowProps {\r\n    children: React.ReactNode;\r\n    className?: string;\r\n    noBorderBottom?: boolean; // Kept for type compatibility but ignored in usage\r\n}\r\n\r\nexport const FormRow = ({ children, className, noBorderBottom = false }: FormRowProps) => {\r\n    return (\r\n        <div className={cn(\"flex flex-col md:flex-row gap-4 w-full\", className)}>\r\n            {children}\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface FormFieldProps {\r\n    label?: string;\r\n    children?: React.ReactNode;\r\n    className?: string;\r\n    width?: string;\r\n    noBorderRight?: boolean; // Kept for compatibility, ignored\r\n    col?: boolean; // Kept for compatibility\r\n    center?: boolean; // Kept for compatibility\r\n    header?: boolean; // Kept for compatibility\r\n}\r\n\r\nexport const FormField = ({ label, children, className, width, noBorderRight, col, center, header }: FormFieldProps) => {\r\n    // If it's a \"header\" field (old table headers), render as a simple div or label\r\n    if (header) {\r\n        return (\r\n            <div className={cn(\"font-semibold text-sm text-slate-700 uppercase\", className)}>\r\n                {label}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={cn(\"flex flex-col space-y-1.5 w-full\", width, className)}>\r\n            {label && (\r\n                <Label className=\"text-xs font-medium text-slate-500 uppercase tracking-wide\">\r\n                    {label}\r\n                </Label>\r\n            )}\r\n            <div className={cn(\"flex-1\", center && \"flex justify-center\")}>\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n    transparent?: boolean; // Deprecated, kept for compatibility\r\n}\r\n\r\nexport const FormInput = React.forwardRef<HTMLInputElement, InputProps>(\r\n    ({ className, transparent, ...props }, ref) => {\r\n        return (\r\n            <Input\r\n                ref={ref}\r\n                className={cn(\"bg-white\", className)}\r\n                {...props}\r\n            />\r\n        );\r\n    }\r\n);\r\nFormInput.displayName = \"FormInput\";\r\n\r\ninterface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\r\n    transparent?: boolean; // Deprecated\r\n}\r\n\r\nexport const FormTextarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\r\n    ({ className, transparent, ...props }, ref) => {\r\n        return (\r\n            <Textarea\r\n                ref={ref}\r\n                className={cn(\"bg-white min-h-[80px]\", className)}\r\n                {...props}\r\n            />\r\n        );\r\n    }\r\n);\r\nFormTextarea.displayName = \"FormTextarea\";\r\n\r\nexport const DateInputs = ({\r\n    dateString,\r\n    onChange\r\n}: {\r\n    dateString: string,\r\n    onChange: (date: string) => void\r\n}) => {\r\n    return (\r\n        <div className=\"w-full\">\r\n            <Input\r\n                type=\"date\"\r\n                value={dateString}\r\n                onChange={(e) => onChange(e.target.value)}\r\n                className=\"w-full\"\r\n            />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\Step1Identificacion.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormRow' is defined but never used.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DateInputs' is defined but never used.","line":2,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[336,339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[336,339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { FormSection, FormRow, FormField, FormInput, DateInputs } from './FormComponents';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface Step1Props {\r\n    formData: any;\r\n    updateField: (field: string, value: any) => void;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport const Step1Identificacion = ({ formData, updateField, readOnly }: Step1Props) => {\r\n\r\n    // Helper for date calculations\r\n    const calculateAge = (dateString: string) => {\r\n        if (!dateString) return '';\r\n        const today = new Date();\r\n        const birthDate = new Date(dateString);\r\n        let age = today.getFullYear() - birthDate.getFullYear();\r\n        const m = today.getMonth() - birthDate.getMonth();\r\n        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\r\n            age--;\r\n        }\r\n        return age.toString();\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header Dates Card */}\r\n            <Card className=\"bg-slate-50 border-slate-200\">\r\n                <CardContent className=\"p-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <FormField label=\"Fecha de Valoración\">\r\n                        <FormInput\r\n                            type=\"date\"\r\n                            value={formData.fecha_valoracion}\r\n                            onChange={(e) => updateField('fecha_valoracion', e.target.value)}\r\n                            disabled={readOnly}\r\n                        />\r\n                    </FormField>\r\n                    <FormField label=\"Último Día de Incapacidad\">\r\n                        <FormInput\r\n                            type=\"date\"\r\n                            value={formData.ultimo_dia_incapacidad}\r\n                            onChange={(e) => updateField('ultimo_dia_incapacidad', e.target.value)}\r\n                            disabled={readOnly}\r\n                        />\r\n                    </FormField>\r\n                </CardContent>\r\n            </Card>\r\n\r\n\r\n            <FormSection title=\"1. IDENTIFICACIÓN DEL TRABAJADOR Y EMPRESA\">\r\n                <div className=\"space-y-6\">\r\n                    {/* Datos Trabajador Card */}\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">Datos del Trabajador</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                            <FormField label=\"Nombre del Trabajador\">\r\n                                <FormInput\r\n                                    value={formData.nombre_trabajador}\r\n                                    onChange={(e) => updateField('nombre_trabajador', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Número de Documento\">\r\n                                <FormInput\r\n                                    value={formData.numero_documento}\r\n                                    onChange={(e) => updateField('numero_documento', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormField label=\"Fecha de Nacimiento\">\r\n                                    <FormInput\r\n                                        type=\"date\"\r\n                                        value={formData.fecha_nacimiento}\r\n                                        onChange={(e) => updateField('fecha_nacimiento', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Edad Calculada\">\r\n                                    <div className=\"h-10 flex items-center px-3 bg-slate-100 rounded-md text-sm text-slate-600 border border-slate-200\">\r\n                                        {calculateAge(formData.fecha_nacimiento)} años\r\n                                    </div>\r\n                                </FormField>\r\n                            </div>\r\n\r\n                            <FormField label=\"Dominancia\">\r\n                                <div className=\"flex flex-wrap gap-4 mt-2\">\r\n                                    {['Derecha', 'Izquierda', 'Ambidiestra'].map((opt) => (\r\n                                        <label key={opt} className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"dominancia\"\r\n                                                value={opt}\r\n                                                checked={formData.dominancia === opt}\r\n                                                onChange={(e) => updateField('dominancia', e.target.value)}\r\n                                                disabled={readOnly}\r\n                                                className=\"accent-slate-900 h-4 w-4\"\r\n                                            />\r\n                                            {opt}\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Estado Civil\">\r\n                                <FormInput\r\n                                    value={formData.estado_civil}\r\n                                    onChange={(e) => updateField('estado_civil', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Dirección Residencia / Ciudad\" className=\"lg:col-span-1\">\r\n                                <FormInput\r\n                                    value={formData.direccion_residencia}\r\n                                    onChange={(e) => updateField('direccion_residencia', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Teléfonos Trabajador\">\r\n                                <FormInput\r\n                                    value={formData.telefonos_trabajador}\r\n                                    onChange={(e) => updateField('telefonos_trabajador', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Nivel Educativo\" className=\"col-span-full\">\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mt-2\">\r\n                                    {[\r\n                                        { val: 'formacion_empirica', label: 'Formación empírica' },\r\n                                        { val: 'basica_primaria', label: 'Básica primaria' },\r\n                                        { val: 'bachillerato_vocacional', label: 'Bachillerato' },\r\n                                        { val: 'tecnico', label: 'Técnico/Tecnológico' },\r\n                                        { val: 'profesional', label: 'Profesional' },\r\n                                        { val: 'postgrado', label: 'Especialización/Maestría' },\r\n                                        { val: 'formacion_informal', label: 'Formación informal' },\r\n                                        { val: 'analfabeta', label: 'Analfabeta' },\r\n                                    ].map((item) => (\r\n                                        <label key={item.val} className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer p-2 border rounded-md hover:bg-slate-50 transition-colors\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"educacion\"\r\n                                                value={item.val}\r\n                                                checked={formData.nivel_educativo === item.val}\r\n                                                onChange={(e) => updateField('nivel_educativo', e.target.value)}\r\n                                                disabled={readOnly}\r\n                                                className=\"accent-slate-900 h-4 w-4\"\r\n                                            />\r\n                                            {item.label}\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </FormField>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Datos ATEL y Empresa Card */}\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">Datos del Evento y Empresa</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n\r\n                            <FormField label=\"Identificación del Siniestro\">\r\n                                <FormInput\r\n                                    value={formData.id_siniestro}\r\n                                    onChange={(e) => updateField('id_siniestro', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Fecha(s) del Evento ATEL\">\r\n                                <FormInput\r\n                                    type=\"date\"\r\n                                    value={formData.fecha_evento_atel}\r\n                                    onChange={(e) => updateField('fecha_evento_atel', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Diagnósticos Clínicos\">\r\n                                <FormInput\r\n                                    value={formData.diagnosticos_clinicos}\r\n                                    onChange={(e) => updateField('diagnosticos_clinicos', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"EPS - IPS\">\r\n                                <FormInput\r\n                                    value={formData.eps}\r\n                                    onChange={(e) => updateField('eps', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"AFP\">\r\n                                <FormInput\r\n                                    value={formData.afp}\r\n                                    onChange={(e) => updateField('afp', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Tiempo Total Incapacidad\">\r\n                                <div className=\"flex gap-2 items-center\">\r\n                                    <FormInput\r\n                                        value={formData.tiempo_total_incapacidad}\r\n                                        onChange={(e) => updateField('tiempo_total_incapacidad', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                    <span className=\"text-sm text-slate-500\">días</span>\r\n                                </div>\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Empresa\">\r\n                                <FormInput\r\n                                    value={formData.empresa_labora}\r\n                                    onChange={(e) => updateField('empresa_labora', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"NIT Empresa\">\r\n                                <FormInput\r\n                                    value={formData.nit_empresa}\r\n                                    onChange={(e) => updateField('nit_empresa', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Dirección Empresa\">\r\n                                <FormInput\r\n                                    value={formData.direccion_empresa}\r\n                                    onChange={(e) => updateField('direccion_empresa', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Cargo Actual\">\r\n                                <FormInput\r\n                                    value={formData.cargo_actual}\r\n                                    onChange={(e) => updateField('cargo_actual', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Cargo Único (mismas características)\">\r\n                                <div className=\"flex gap-4 mt-2\">\r\n                                    {['Si', 'No'].map((opt) => (\r\n                                        <label key={opt} className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer border px-3 py-1 rounded-md hover:bg-slate-50 transition-colors\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"cargo_unico\"\r\n                                                value={opt}\r\n                                                checked={formData.cargo_unico == opt}\r\n                                                onChange={(e) => updateField('cargo_unico', e.target.value)}\r\n                                                disabled={readOnly}\r\n                                                className=\"accent-slate-900 h-4 w-4\"\r\n                                            />\r\n                                            {opt}\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Área / Sección\">\r\n                                <FormInput\r\n                                    value={formData.area_seccion}\r\n                                    onChange={(e) => updateField('area_seccion', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormField label=\"Fecha Ingreso Cargo\">\r\n                                    <FormInput\r\n                                        type=\"date\"\r\n                                        value={formData.fecha_ingreso_cargo}\r\n                                        onChange={(e) => updateField('fecha_ingreso_cargo', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Tiempo Cargo\">\r\n                                    <div className=\"h-10 flex items-center px-3 bg-slate-100 rounded-md text-sm text-slate-600 border border-slate-200\">\r\n                                        {calculateAge(formData.fecha_ingreso_cargo)} años\r\n                                    </div>\r\n                                </FormField>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormField label=\"Fecha Ingreso Empresa\">\r\n                                    <FormInput\r\n                                        type=\"date\"\r\n                                        value={formData.fecha_ingreso_empresa}\r\n                                        onChange={(e) => updateField('fecha_ingreso_empresa', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Tiempo Empresa\">\r\n                                    <div className=\"h-10 flex items-center px-3 bg-slate-100 rounded-md text-sm text-slate-600 border border-slate-200\">\r\n                                        {calculateAge(formData.fecha_ingreso_empresa)} años\r\n                                    </div>\r\n                                </FormField>\r\n                            </div>\r\n\r\n                            <FormField label=\"Forma Vinculación\">\r\n                                <FormInput\r\n                                    value={formData.forma_vinculacion}\r\n                                    onChange={(e) => updateField('forma_vinculacion', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Modalidad Trabajo\">\r\n                                <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                                    {['Presencial', 'Teletrabajo', 'Trabajo en casa'].map((opt) => (\r\n                                        <label key={opt} className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer border px-3 py-1 rounded-md hover:bg-slate-50 transition-colors\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"modalidad\"\r\n                                                value={opt}\r\n                                                checked={formData.modalidad === opt}\r\n                                                onChange={(e) => updateField('modalidad', e.target.value)}\r\n                                                disabled={readOnly}\r\n                                                className=\"accent-slate-900 h-4 w-4\"\r\n                                            />\r\n                                            {opt}\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Tiempo Modalidad\">\r\n                                <FormInput\r\n                                    value={formData.tiempo_modalidad}\r\n                                    onChange={(e) => updateField('tiempo_modalidad', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Contacto Empresa\">\r\n                                <FormInput\r\n                                    value={formData.contacto_empresa}\r\n                                    onChange={(e) => updateField('contacto_empresa', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Teléfono Contacto\">\r\n                                <FormInput\r\n                                    value={formData.telefonos_contacto_empresa}\r\n                                    onChange={(e) => updateField('telefonos_contacto_empresa', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                            <FormField label=\"Correo Contacto\">\r\n                                <FormInput\r\n                                    value={formData.correo_contacto}\r\n                                    onChange={(e) => updateField('correo_contacto', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </FormSection>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\Step2MetodologiaCondiciones.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormRow' is defined but never used.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[244,247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[244,247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { FormSection, FormRow, FormField, FormTextarea, FormInput } from './FormComponents';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\ninterface Step2Props {\r\n    formData: any;\r\n    updateField: (field: string, value: any) => void;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport const Step2MetodologiaCondiciones = ({ formData, updateField, readOnly }: Step2Props) => {\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <FormSection title=\"2. METODOLOGÍA\">\r\n                <FormTextarea\r\n                    className=\"min-h-[120px]\"\r\n                    placeholder=\"Describa la metodología utilizada...\"\r\n                    value={formData.metodologia}\r\n                    onChange={(e) => updateField('metodologia', e.target.value)}\r\n                    disabled={readOnly}\r\n                />\r\n            </FormSection>\r\n\r\n            <FormSection title=\"3. CONDICIONES DE TRABAJO\">\r\n                <div className=\"space-y-6\">\r\n\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">3.1 DESCRIPCIÓN DEL PROCESO PRODUCTIVO</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-6\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[100px]\"\r\n                                value={formData.descripcion_proceso_productivo}\r\n                                onChange={(e) => updateField('descripcion_proceso_productivo', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">3.2 APRECIACIÓN DEL TRABAJADOR FRENTE A SU PROCESO PRODUCTIVO</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-6\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[80px]\"\r\n                                value={formData.apreciacion_trabajador_proceso}\r\n                                onChange={(e) => updateField('apreciacion_trabajador_proceso', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">3.3 ESTÁNDARES DE PRODUCTIVIDAD ESTABLECIDO POR LA EMPRESA</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-6\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[80px]\"\r\n                                value={formData.estandares_productividad}\r\n                                onChange={(e) => updateField('estandares_productividad', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"border-slate-200 bg-slate-50/50\">\r\n                        <CardHeader className=\"py-3 border-b border-slate-100\">\r\n                            <CardTitle className=\"text-xs font-bold text-slate-700 uppercase\">\r\n                                3.4 REQUERIMIENTOS DEL DESEMPEÑO ORGANIZACIONAL\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div className=\"space-y-4\">\r\n                                <FormField label=\"Jornada\">\r\n                                    <FormInput\r\n                                        value={formData.jornada}\r\n                                        onChange={(e) => updateField('jornada', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Descansos programados\">\r\n                                    <FormInput\r\n                                        value={formData.descansos_programados}\r\n                                        onChange={(e) => updateField('descansos_programados', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Tiempos efectivos en jornada\">\r\n                                    <FormInput\r\n                                        value={formData.tiempos_efectivos}\r\n                                        onChange={(e) => updateField('tiempos_efectivos', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Horas extras\">\r\n                                    <FormInput\r\n                                        value={formData.horas_extras}\r\n                                        onChange={(e) => updateField('horas_extras', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <FormField label=\"Ritmo\">\r\n                                    <FormInput\r\n                                        value={formData.ritmo}\r\n                                        onChange={(e) => updateField('ritmo', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Turnos\">\r\n                                    <FormInput\r\n                                        value={formData.turnos}\r\n                                        onChange={(e) => updateField('turnos', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Rotaciones\">\r\n                                    <FormInput\r\n                                        value={formData.rotaciones}\r\n                                        onChange={(e) => updateField('rotaciones', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Distribución semanal\">\r\n                                    <FormInput\r\n                                        value={formData.distribucion_semanal}\r\n                                        onChange={(e) => updateField('distribucion_semanal', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </FormSection>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\Step3Tareas.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormSection' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormRow' is defined but never used.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[386,389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[386,389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1327,1330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1327,1330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { FormSection, FormRow, FormField, FormTextarea, FormInput } from './FormComponents';\r\nimport { Plus, Trash2 } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface Step3Props {\r\n    tareas: any[];\r\n    setTareas: React.Dispatch<React.SetStateAction<any[]>>;\r\n    readOnly?: boolean;\r\n}\r\n\r\nconst CONCLUSION_OPTIONS = [\r\n    { value: 'reintegro_sin_modificaciones', label: 'Reintegro sin modificaciones' },\r\n    { value: 'reintegro_con_modificaciones', label: 'Reintegro con modificaciones' },\r\n    { value: 'desarrollo_capacidades', label: 'Desarrollo de capacidades' },\r\n    { value: 'no_puede_desempenarla', label: 'No puede desempeñarla' },\r\n];\r\n\r\nexport const Step3Tareas = ({ tareas, setTareas, readOnly }: Step3Props) => {\r\n\r\n    // Helper to empty task\r\n    const emptyTarea = () => ({\r\n        actividad: '', ciclo: '', subactividad: '', estandar_productividad: '',\r\n        registro_fotografico: '', descripcion_biomecanica: '', apreciacion_trabajador: '',\r\n        apreciacion_profesional: '', conclusion: '', descripcion_conclusion: '', orden: 0,\r\n    });\r\n\r\n    const updateTarea = (index: number, field: string, value: any) => {\r\n        const newTareas = [...tareas];\r\n        newTareas[index] = { ...newTareas[index], [field]: value };\r\n        setTareas(newTareas);\r\n    };\r\n\r\n    const addTarea = () => setTareas([...tareas, emptyTarea()]);\r\n    const removeTarea = (index: number) => setTareas(tareas.filter((_, i) => i !== index));\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-semibold text-slate-800\">4. REQUERIMIENTOS DEL PROCESO PRODUCTIVO POR TAREA</h2>\r\n                {!readOnly && (\r\n                    <Button\r\n                        onClick={addTarea}\r\n                        size=\"sm\"\r\n                        className=\"bg-indigo-600 hover:bg-indigo-700 text-white\"\r\n                    >\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        AGREGAR TAREA\r\n                    </Button>\r\n                )}\r\n            </div>\r\n\r\n            {tareas.map((tarea, idx) => (\r\n                <Card key={idx} className=\"border-slate-200 shadow-sm mb-6\">\r\n                    <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 flex flex-row items-center justify-between py-3\">\r\n                        <CardTitle className=\"text-sm font-bold text-slate-700\">\r\n                            TAREA {idx + 1}\r\n                        </CardTitle>\r\n                        {!readOnly && tareas.length > 1 && (\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                onClick={() => removeTarea(idx)}\r\n                                className=\"text-red-500 hover:text-red-700 h-8 w-8 hover:bg-red-50\"\r\n                            >\r\n                                <Trash2 className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        )}\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-4 space-y-6\">\r\n                        {/* Basic Info Grid */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                            <FormField label=\"Actividad\">\r\n                                <FormInput\r\n                                    value={tarea.actividad}\r\n                                    onChange={(e) => updateTarea(idx, 'actividad', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Ciclo\">\r\n                                <FormInput\r\n                                    value={tarea.ciclo}\r\n                                    onChange={(e) => updateTarea(idx, 'ciclo', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Subactividad\">\r\n                                <FormInput\r\n                                    value={tarea.subactividad}\r\n                                    onChange={(e) => updateTarea(idx, 'subactividad', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Estándar de productividad\">\r\n                                <FormInput\r\n                                    value={tarea.estandar_productividad}\r\n                                    onChange={(e) => updateTarea(idx, 'estandar_productividad', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </div>\r\n\r\n                        {/* Descriptions */}\r\n                        <FormField label=\"DESCRIPCIÓN Y REQUERIMIENTOS BIOMECÁNICOS DEL PUESTO DE TRABAJO\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[80px]\"\r\n                                value={tarea.descripcion_biomecanica}\r\n                                onChange={(e) => updateTarea(idx, 'descripcion_biomecanica', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </FormField>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <FormField label=\"APRECIACIÓN DEL TRABAJADOR\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[80px]\"\r\n                                    value={tarea.apreciacion_trabajador}\r\n                                    onChange={(e) => updateTarea(idx, 'apreciacion_trabajador', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"APRECIACIÓN DEL PROFESIONAL\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[80px]\"\r\n                                    value={tarea.apreciacion_profesional}\r\n                                    onChange={(e) => updateTarea(idx, 'apreciacion_profesional', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </div>\r\n\r\n                        {/* Conclusion Section */}\r\n                        <div className=\"bg-slate-50 p-4 rounded-md border border-slate-100 space-y-4\">\r\n                            <Label className=\"text-xs font-bold text-slate-700 uppercase block text-center mb-2\">\r\n                                CONCLUSIÓN\r\n                            </Label>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                {CONCLUSION_OPTIONS.map((opt) => (\r\n                                    <label\r\n                                        key={opt.value}\r\n                                        className={`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-all ${tarea.conclusion === opt.value\r\n                                                ? 'bg-indigo-50 border-indigo-200 text-indigo-700'\r\n                                                : 'bg-white border-transparent hover:bg-slate-50 hover:border-slate-200'\r\n                                            }`}\r\n                                    >\r\n                                        <input\r\n                                            type=\"radio\"\r\n                                            name={`conclusion-${idx}`}\r\n                                            value={opt.value}\r\n                                            checked={tarea.conclusion === opt.value}\r\n                                            onChange={(e) => updateTarea(idx, 'conclusion', e.target.value)}\r\n                                            disabled={readOnly}\r\n                                            className=\"accent-indigo-600 h-4 w-4\"\r\n                                        />\r\n                                        <span className=\"text-sm font-medium\">{opt.label}</span>\r\n                                    </label>\r\n                                ))}\r\n                            </div>\r\n                            <FormField label=\"Descripción Conclusión\" className=\"mt-4\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[60px] bg-white\"\r\n                                    placeholder=\"Detalles adicionales sobre la conclusión...\"\r\n                                    value={tarea.descripcion_conclusion}\r\n                                    onChange={(e) => updateTarea(idx, 'descripcion_conclusion', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\Step4MaterialesPeligros.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[370,373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[370,373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[457,460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[457,460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[518,521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[518,521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[542,545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[542,545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[588,591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[588,591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1760,1763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1760,1763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { FormSection, FormField, FormTextarea } from './FormComponents';\r\nimport { Plus, Trash2 } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\n\r\ninterface Step4Props {\r\n    materiales: any[];\r\n    setMateriales: React.Dispatch<React.SetStateAction<any[]>>;\r\n    peligros: any[];\r\n    setPeligros: React.Dispatch<React.SetStateAction<any[]>>;\r\n    formData: any;\r\n    updateField: (field: string, value: any) => void;\r\n    readOnly?: boolean;\r\n}\r\n\r\nconst CATEGORIAS_PELIGRO = [\r\n    { value: 'fisicos', label: 'Físicos' },\r\n    { value: 'biologicos', label: 'Biológicos' },\r\n    { value: 'biomecanicos', label: 'Biomecánicos' },\r\n    { value: 'psicosociales', label: 'Psicosociales' },\r\n    { value: 'quimicos', label: 'Químicos' },\r\n    { value: 'cond_seguridad', label: 'Condiciones de Seguridad' },\r\n];\r\n\r\nexport const Step4MaterialesPeligros = ({ materiales, setMateriales, peligros, setPeligros, formData, updateField, readOnly }: Step4Props) => {\r\n\r\n    const emptyMaterial = () => ({\r\n        nombre: '', descripcion: '', requerimientos_operacion: '', observaciones: '', orden: 0,\r\n    });\r\n\r\n    const updateMaterial = (index: number, field: string, value: any) => {\r\n        const newMats = [...materiales];\r\n        newMats[index] = { ...newMats[index], [field]: value };\r\n        setMateriales(newMats);\r\n    };\r\n\r\n    const removeMaterial = (index: number) => setMateriales(materiales.filter((_, i) => i !== index));\r\n    const addMaterial = () => setMateriales([...materiales, emptyMaterial()]);\r\n\r\n    const updatePeligro = (index: number, field: string, value: any) => {\r\n        const newPelis = [...peligros];\r\n        newPelis[index] = { ...newPelis[index], [field]: value };\r\n        setPeligros(newPelis);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-semibold text-slate-800\">5. IDENTIFICACIÓN DE MATERIALES, EQUIPOS Y HERRAMIENTAS</h2>\r\n                {!readOnly && (\r\n                    <Button\r\n                        onClick={addMaterial}\r\n                        size=\"sm\"\r\n                        className=\"bg-indigo-600 hover:bg-indigo-700 text-white\"\r\n                    >\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        AGREGAR MATERIAL\r\n                    </Button>\r\n                )}\r\n            </div>\r\n\r\n            {materiales.length === 0 && (\r\n                <div className=\"text-center p-8 border-2 border-dashed border-slate-200 rounded-lg text-slate-500\">\r\n                    No hay materiales registrados.\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 gap-6\">\r\n                {materiales.map((mat, idx) => (\r\n                    <Card key={idx} className=\"border-slate-200 shadow-sm relative group\">\r\n                        <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-3 flex flex-row justify-between items-center\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">\r\n                                MATERIAL / EQUIPO #{idx + 1}\r\n                            </CardTitle>\r\n                            {!readOnly && (\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    onClick={() => removeMaterial(idx)}\r\n                                    className=\"text-red-500 hover:text-red-700 h-8 w-8 hover:bg-red-50\"\r\n                                >\r\n                                    <Trash2 className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            )}\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <FormField label=\"Nombre\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[60px]\"\r\n                                    value={mat.nombre}\r\n                                    onChange={(e) => updateMaterial(idx, 'nombre', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Descripción\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[60px]\"\r\n                                    value={mat.descripcion}\r\n                                    onChange={(e) => updateMaterial(idx, 'descripcion', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Requerimientos Operación\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[60px]\"\r\n                                    value={mat.requerimientos_operacion}\r\n                                    onChange={(e) => updateMaterial(idx, 'requerimientos_operacion', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"Observaciones\">\r\n                                <FormTextarea\r\n                                    className=\"min-h-[60px]\"\r\n                                    value={mat.observaciones}\r\n                                    onChange={(e) => updateMaterial(idx, 'observaciones', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </CardContent>\r\n                    </Card>\r\n                ))}\r\n            </div>\r\n\r\n            <FormSection title=\"6. IDENTIFICACIÓN DE PELIGROS\">\r\n                {peligros.map((pel, idx) => {\r\n                    const label = CATEGORIAS_PELIGRO.find(c => c.value === pel.categoria)?.label || pel.categoria;\r\n                    return (\r\n                        <Card key={idx} className=\"border-slate-200 shadow-sm mb-4\">\r\n                            <CardHeader className=\"bg-slate-50/50 border-b border-slate-100 py-2\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Badge variant=\"outline\" className=\"bg-white font-bold text-slate-700 uppercase tracking-wide\">\r\n                                        {label}\r\n                                    </Badge>\r\n                                </div>\r\n                            </CardHeader>\r\n                            <CardContent className=\"p-4 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                <FormField label=\"Descripción del Peligro\">\r\n                                    <FormTextarea\r\n                                        className=\"min-h-[80px]\"\r\n                                        value={pel.descripcion}\r\n                                        onChange={(e) => updatePeligro(idx, 'descripcion', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Tipos de Control Existente\">\r\n                                    <FormTextarea\r\n                                        className=\"min-h-[80px]\"\r\n                                        value={pel.tipos_control_existente}\r\n                                        onChange={(e) => updatePeligro(idx, 'tipos_control_existente', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                                <FormField label=\"Recomendaciones de Control\">\r\n                                    <FormTextarea\r\n                                        className=\"min-h-[80px]\"\r\n                                        value={pel.recomendaciones_control}\r\n                                        onChange={(e) => updatePeligro(idx, 'recomendaciones_control', e.target.value)}\r\n                                        disabled={readOnly}\r\n                                    />\r\n                                </FormField>\r\n                            </CardContent>\r\n                        </Card>\r\n                    );\r\n                })}\r\n\r\n                <div className=\"mt-8\">\r\n                    <FormField label=\"6.1 VERIFICACIÓN DE ACCIONES CORRECTIVAS DE ARL. IMPLEMENTACIÓN DE RECOMENDACIONES\">\r\n                        <FormTextarea\r\n                            className=\"min-h-[80px]\"\r\n                            value={formData.verificacion_acciones_correctivas}\r\n                            onChange={(e) => updateField('verificacion_acciones_correctivas', e.target.value)}\r\n                            disabled={readOnly}\r\n                        />\r\n                    </FormField>\r\n                </div>\r\n            </FormSection>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\formatos-to\\prueba-trabajo\\Step5ConceptoRegistro.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormRow' is defined but never used.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[244,247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[244,247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { FormSection, FormRow, FormField, FormTextarea, FormInput } from './FormComponents';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\ninterface Step5Props {\r\n    formData: any;\r\n    updateField: (field: string, value: any) => void;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport const Step5ConceptoRegistro = ({ formData, updateField, readOnly }: Step5Props) => {\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <FormSection title=\"7. CONCEPTO PARA PRUEBA DE TRABAJO\">\r\n                <FormField label=\"COMPETENCIA, SEGURIDAD, CONFORT, RELACIONES SOCIALES, OTROS ASPECTOS\">\r\n                    <FormTextarea\r\n                        className=\"min-h-[120px]\"\r\n                        value={formData.concepto_prueba_trabajo}\r\n                        onChange={(e) => updateField('concepto_prueba_trabajo', e.target.value)}\r\n                        disabled={readOnly}\r\n                    />\r\n                </FormField>\r\n            </FormSection>\r\n\r\n            <FormSection title=\"8. RECOMENDACIONES\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"py-3 border-b border-slate-100 bg-slate-50/50\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">PARA EL TRABAJADOR</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[150px] border-none focus-visible:ring-0 p-0 resize-none shadow-none\"\r\n                                placeholder=\"Escriba aquí las recomendaciones...\"\r\n                                value={formData.para_trabajador}\r\n                                onChange={(e) => updateField('para_trabajador', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"py-3 border-b border-slate-100 bg-slate-50/50\">\r\n                            <CardTitle className=\"text-sm font-bold text-slate-700\">PARA LA EMPRESA</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4\">\r\n                            <FormTextarea\r\n                                className=\"min-h-[150px] border-none focus-visible:ring-0 p-0 resize-none shadow-none\"\r\n                                placeholder=\"Escriba aquí las recomendaciones...\"\r\n                                value={formData.para_empresa}\r\n                                onChange={(e) => updateField('para_empresa', e.target.value)}\r\n                                disabled={readOnly}\r\n                            />\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </FormSection>\r\n\r\n            <FormSection title=\"9. REGISTRO\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                    {/* Elaboró */}\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"py-2 border-b border-slate-100 bg-slate-50 text-center\">\r\n                            <CardTitle className=\"text-xs font-bold text-slate-700 uppercase\">ELABORÓ</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 space-y-4\">\r\n                            <FormField label=\"NOMBRE\">\r\n                                <FormInput\r\n                                    value={formData.nombre_elaboro}\r\n                                    onChange={(e) => updateField('nombre_elaboro', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <div className=\"h-24 border border-dashed border-slate-200 rounded-md flex items-center justify-center text-slate-400 text-xs\">\r\n                                Espacio para firma\r\n                            </div>\r\n                            <FormField label=\"Licencia S.O\">\r\n                                <FormInput\r\n                                    value=\"\"\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Revisó */}\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"py-2 border-b border-slate-100 bg-slate-50 text-center\">\r\n                            <CardTitle className=\"text-xs font-bold text-slate-700 uppercase\">REVISÓ</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 space-y-4\">\r\n                            <FormField label=\"NOMBRE\">\r\n                                <FormInput\r\n                                    value={formData.nombre_revisor}\r\n                                    onChange={(e) => updateField('nombre_revisor', e.target.value)}\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                            <div className=\"h-24 border border-dashed border-slate-200 rounded-md flex items-center justify-center text-slate-400 text-xs\">\r\n                                Espacio para firma\r\n                            </div>\r\n                            <FormField label=\"Licencia S.O\">\r\n                                <FormInput\r\n                                    value=\"\"\r\n                                    disabled={readOnly}\r\n                                />\r\n                            </FormField>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Datos del Usuario */}\r\n                    <Card className=\"border-slate-200 shadow-sm\">\r\n                        <CardHeader className=\"py-2 border-b border-slate-100 bg-slate-50 text-center\">\r\n                            <CardTitle className=\"text-xs font-bold text-slate-700 uppercase\">DATOS DEL USUARIO</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 space-y-4\">\r\n                            <FormField label=\"NOMBRE\">\r\n                                <FormInput\r\n                                    value={formData.nombre_trabajador}\r\n                                    disabled={true}\r\n                                />\r\n                            </FormField>\r\n                            <FormField label=\"C.C\">\r\n                                <FormInput\r\n                                    value={formData.numero_documento}\r\n                                    disabled={true}\r\n                                />\r\n                            </FormField>\r\n                            <div className=\"h-24 border border-dashed border-slate-200 rounded-md flex items-end justify-center pb-2 text-slate-400 text-xs\">\r\n                                Firma del trabajador\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </FormSection>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\pruebas-trabajo\\PruebaTrabajoForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRiskColor' is assigned a value but never used.","line":118,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7917,7920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7917,7920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8027,8030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8027,8030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":214,"column":6,"nodeType":"ArrayExpression","endLine":214,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, params.id]","fix":{"range":[8117,8128],"text":"[fetchData, params.id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8501,8504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8501,8504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8832,8835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8832,8835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8870,8873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8870,8873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9189,9192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9189,9192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9227,9230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9227,9230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9432,9435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9432,9435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9556,9559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9556,9559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":268,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9989,9992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9989,9992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":925,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":925,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32906,32909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32906,32909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":926,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":926,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32974,32977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32974,32977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":966,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":966,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34279,34282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34279,34282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1198,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1198,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43916,43919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43916,43919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1199,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1199,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43982,43985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43982,43985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1200,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1200,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44013,44016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44013,44016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1220,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1220,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44692,44695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44692,44695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { api } from '@/app/services/api';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  Briefcase,\r\n  ArrowLeft,\r\n  ArrowRight,\r\n  Save,\r\n  Loader2,\r\n  CheckCircle2,\r\n  Sparkles\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\n// Definición de las dimensiones de riesgo y sus condiciones\r\nconst DIMENSIONES_RIESGO = {\r\n  demandas_cuantitativas: {\r\n    nombre: 'Demandas Cuantitativas de Trabajo',\r\n    items: [\r\n      { numero: 1, texto: 'Ritmo de trabajo acelerado' },\r\n      { numero: 2, texto: 'Volumen de tareas elevado' },\r\n      { numero: 3, texto: 'Tiempo insuficiente para completar tareas' },\r\n    ],\r\n  },\r\n  demandas_carga_mental: {\r\n    nombre: 'Demandas de Carga Mental',\r\n    items: [\r\n      { numero: 1, texto: 'Necesidad de atención sostenida' },\r\n      { numero: 2, texto: 'Complejidad de las tareas' },\r\n      { numero: 3, texto: 'Cantidad de información a procesar' },\r\n      { numero: 4, texto: 'Necesidad de tomar decisiones complejas' },\r\n      { numero: 5, texto: 'Concentración requerida' },\r\n    ],\r\n  },\r\n  demandas_emocionales: {\r\n    nombre: 'Demandas Emocionales',\r\n    items: [\r\n      { numero: 1, texto: 'Manejo de situaciones emocionalmente difíciles' },\r\n      { numero: 2, texto: 'Contacto con público o usuarios' },\r\n      { numero: 3, texto: 'Control de emociones ante situaciones laborales' },\r\n    ],\r\n  },\r\n  exigencias_responsabilidad: {\r\n    nombre: 'Exigencias de Responsabilidad del Cargo',\r\n    items: [\r\n      { numero: 1, texto: 'Responsabilidad sobre resultados críticos' },\r\n      { numero: 2, texto: 'Supervisión de otros trabajadores' },\r\n      { numero: 3, texto: 'Manejo de recursos importantes' },\r\n      { numero: 4, texto: 'Toma de decisiones importantes' },\r\n      { numero: 5, texto: 'Impacto de errores en la organización' },\r\n      { numero: 6, texto: 'Responsabilidad sobre la seguridad de otros' },\r\n    ],\r\n  },\r\n  consistencia_rol: {\r\n    nombre: 'Consistencia de Rol',\r\n    items: [\r\n      { numero: 1, texto: 'Claridad de las funciones del puesto' },\r\n      { numero: 2, texto: 'Instrucciones claras y consistentes' },\r\n      { numero: 3, texto: 'Definición de objetivos' },\r\n      { numero: 4, texto: 'Demandas contradictorias' },\r\n    ],\r\n  },\r\n  demandas_ambientales: {\r\n    nombre: 'Demandas Ambientales y de Esfuerzo Físico',\r\n    items: [\r\n      { numero: 1, texto: 'Ruido en el ambiente laboral' },\r\n      { numero: 2, texto: 'Iluminación inadecuada' },\r\n      { numero: 3, texto: 'Temperatura extrema' },\r\n      { numero: 4, texto: 'Exposición a agentes químicos' },\r\n      { numero: 5, texto: 'Esfuerzo físico intenso' },\r\n      { numero: 6, texto: 'Posturas forzadas' },\r\n      { numero: 7, texto: 'Movimientos repetitivos' },\r\n      { numero: 8, texto: 'Manipulación de cargas' },\r\n      { numero: 9, texto: 'Espacios de trabajo reducidos' },\r\n      { numero: 10, texto: 'Vibraciones' },\r\n    ],\r\n  },\r\n  demandas_jornada: {\r\n    nombre: 'Demandas de la Jornada de Trabajo',\r\n    items: [\r\n      { numero: 1, texto: 'Jornadas de trabajo extendidas' },\r\n      { numero: 2, texto: 'Trabajo en turnos rotativos o nocturnos' },\r\n    ],\r\n  },\r\n};\r\n\r\nconst BAREMOS: Record<string, { sin: number; bajo: number; medio: number; alto: number; muy_alto: number }> = {\r\n  demandas_cuantitativas: { sin: 12.6, bajo: 25.3, medio: 38, alto: 50.6, muy_alto: 63 },\r\n  demandas_carga_mental: { sin: 21, bajo: 42, medio: 63, alto: 84, muy_alto: 105 },\r\n  demandas_emocionales: { sin: 12.6, bajo: 25.3, medio: 38, alto: 50.6, muy_alto: 63 },\r\n  exigencias_responsabilidad: { sin: 25.2, bajo: 50.4, medio: 75.6, alto: 100.8, muy_alto: 126 },\r\n  consistencia_rol: { sin: 16.8, bajo: 33.6, medio: 50.4, alto: 67.2, muy_alto: 84 },\r\n  demandas_ambientales: { sin: 42, bajo: 84, medio: 126, alto: 168, muy_alto: 210 },\r\n  demandas_jornada: { sin: 8.4, bajo: 16.8, medio: 25.2, alto: 33.6, muy_alto: 42 },\r\n};\r\n\r\nconst getNivelRiesgo = (dimension: string, puntaje: number) => {\r\n  const rangos = BAREMOS[dimension];\r\n  if (!rangos) return { nivel: 'N/A', color: 'bg-gray-200 text-gray-800' };\r\n\r\n  if (puntaje <= rangos.sin) return { nivel: 'SIN RIESGO', color: 'bg-green-500 text-white' };\r\n  if (puntaje <= rangos.bajo) return { nivel: 'RIESGO BAJO', color: 'bg-yellow-400 text-black' };\r\n  if (puntaje <= rangos.medio) return { nivel: 'RIESGO MEDIO', color: 'bg-orange-500 text-white' };\r\n  if (puntaje <= rangos.alto) return { nivel: 'RIESGO ALTO', color: 'bg-red-500 text-white' };\r\n  return { nivel: 'RIESGO MUY ALTO', color: 'bg-red-900 text-white' };\r\n};\r\n\r\n// Helper para colores de riesgo (usado en el select)\r\nconst getRiskColor = (risk: string) => {\r\n  switch (risk) {\r\n    case 'sin_riesgo': return 'bg-green-100 text-green-800 border-green-200';\r\n    case 'riesgo_bajo': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n    case 'riesgo_medio': return 'bg-orange-100 text-orange-800 border-orange-200';\r\n    case 'riesgo_alto': return 'bg-red-100 text-red-800 border-red-200';\r\n    case 'riesgo_muy_alto': return 'bg-red-800 text-white border-red-900';\r\n    default: return 'bg-white border-gray-200';\r\n  }\r\n};\r\n\r\ninterface StepData {\r\n  // Paso 1: Metodología y Participantes\r\n  metodologia: string;\r\n  participante_trabajador: string;\r\n  participante_jefe: string;\r\n  participante_cargo_jefe: string;\r\n  fuente_trabajador_fecha: string;\r\n  fuente_jefe_fecha: string;\r\n  fuente_par_fecha: string;\r\n\r\n  // Paso 2: Revisión Documental y Descripción\r\n  revision_documental: string;\r\n  descripcion_puesto: string;\r\n  condicion_actual: string;\r\n\r\n  // Paso 3: Aspectos Ocupacionales y Funciones\r\n  nombre_puesto: string;\r\n  area_puesto: string;\r\n  antiguedad_cargo_ocupacional: string;\r\n  antiguedad_empresa_ocupacional: string;\r\n  nivel_educativo_requerido: string;\r\n  jornada_laboral: string;\r\n  horas_extras: string;\r\n  turnos: string;\r\n  descripcion_funciones: string;\r\n\r\n  // Pasos 4-10: Condiciones de Riesgo (se manejan por separado)\r\n  // Paso 11: Resumen de Factores (se maneja por separado)\r\n  // Paso 12: Conclusiones Finales\r\n  conclusion_evaluacion: string;\r\n  concordancia_items: string;\r\n  no_concordancia_items: string;\r\n  conclusiones_finales: string;\r\n  recomendaciones: string;\r\n}\r\n\r\ninterface PruebaTrabajoFormProps {\r\n  readOnly?: boolean;\r\n}\r\n\r\nexport function PruebaTrabajoForm({ readOnly = false }: PruebaTrabajoFormProps) {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const totalSteps = 12;\r\n\r\n  const [formData, setFormData] = useState<StepData>({\r\n    metodologia: '',\r\n    participante_trabajador: '',\r\n    participante_jefe: '',\r\n    participante_cargo_jefe: '',\r\n    fuente_trabajador_fecha: '',\r\n    fuente_jefe_fecha: '',\r\n    fuente_par_fecha: '',\r\n    revision_documental: '',\r\n    descripcion_puesto: '',\r\n    condicion_actual: '',\r\n    nombre_puesto: '',\r\n    area_puesto: '',\r\n    antiguedad_cargo_ocupacional: '',\r\n    antiguedad_empresa_ocupacional: '',\r\n    nivel_educativo_requerido: '',\r\n    jornada_laboral: '',\r\n    horas_extras: '',\r\n    turnos: '',\r\n    descripcion_funciones: '',\r\n    conclusion_evaluacion: '',\r\n    concordancia_items: '',\r\n    no_concordancia_items: '',\r\n    conclusiones_finales: '',\r\n    recomendaciones: '',\r\n  });\r\n\r\n  // Estado para condiciones de riesgo\r\n  const [condicionesRiesgo, setCondicionesRiesgo] = useState<any[]>([]);\r\n\r\n  // Estado para resumen de factores\r\n  const [resumenFactores, setResumenFactores] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (params.id) {\r\n      fetchData();\r\n    }\r\n  }, [params.id]);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Cargar datos de secciones\r\n      try {\r\n        const secciones = await api.get(`/pruebas-trabajo/${params.id}/secciones`);\r\n        if (secciones) {\r\n          setFormData((prev) => ({\r\n            ...prev,\r\n            ...secciones,\r\n          }));\r\n        }\r\n      } catch (error: any) {\r\n        if (error.response?.status !== 404) {\r\n          console.error('Error loading secciones:', error);\r\n        }\r\n      }\r\n\r\n      // Cargar condiciones de riesgo\r\n      try {\r\n        const condiciones = await api.get(`/pruebas-trabajo/${params.id}/condiciones-riesgo`);\r\n        setCondicionesRiesgo((condiciones as any[]) || []);\r\n      } catch (error: any) {\r\n        if (error.response?.status !== 404) {\r\n          console.error('Error loading condiciones:', error);\r\n        }\r\n      }\r\n\r\n      // Cargar resumen de factores\r\n      try {\r\n        const resumen = await api.get(`/pruebas-trabajo/${params.id}/resumen-factores`);\r\n        setResumenFactores((resumen as any[]) || []);\r\n      } catch (error: any) {\r\n        if (error.response?.status !== 404) {\r\n          console.error('Error loading resumen:', error);\r\n        }\r\n      }\r\n\r\n      // Cargar concepto final\r\n      try {\r\n        const concepto: any = await api.get(`/pruebas-trabajo/${params.id}/concepto-final`);\r\n        if (concepto) {\r\n          setFormData((prev: any) => ({\r\n            ...prev,\r\n            conclusion_evaluacion: concepto.conclusion_evaluacion || '',\r\n            concordancia_items: concepto.concordancia_items || '',\r\n            no_concordancia_items: concepto.no_concordancia_items || '',\r\n            conclusiones_finales: concepto.conclusiones_finales || '',\r\n            recomendaciones: concepto.recomendaciones || '',\r\n          }));\r\n        }\r\n      } catch (error: any) {\r\n        if (error.response?.status !== 404) {\r\n          console.error('Error loading concepto:', error);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al cargar los datos de la evaluación');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Efecto para auto-generar conclusiones de concordancia\r\n  useEffect(() => {\r\n    if (resumenFactores.length > 0) {\r\n      const concordancias: string[] = [];\r\n      const noConcordancias: string[] = [];\r\n\r\n      resumenFactores.forEach(r => {\r\n        const dimensionNombre = DIMENSIONES_RIESGO[r.dimension as keyof typeof DIMENSIONES_RIESGO]?.nombre;\r\n        if (dimensionNombre && r.nivel_riesgo_experto && r.nivel_riesgo_trabajador) {\r\n          if (r.nivel_riesgo_experto === r.nivel_riesgo_trabajador) {\r\n            concordancias.push(dimensionNombre);\r\n          } else {\r\n            noConcordancias.push(dimensionNombre);\r\n          }\r\n        }\r\n      });\r\n\r\n      const textoConcordancia = concordancias.length > 0\r\n        ? concordancias.join(', ')\r\n        : 'Ninguna';\r\n\r\n      const textoNoConcordancia = noConcordancias.length > 0\r\n        ? noConcordancias.join(', ')\r\n        : 'Ninguna';\r\n\r\n      setFormData(prev => {\r\n        // Solo actualizar si cambia para evitar ciclos infinitos\r\n        if (prev.concordancia_items === textoConcordancia && prev.no_concordancia_items === textoNoConcordancia) {\r\n          return prev;\r\n        }\r\n        return {\r\n          ...prev,\r\n          concordancia_items: textoConcordancia,\r\n          no_concordancia_items: textoNoConcordancia\r\n        };\r\n      });\r\n    }\r\n  }, [resumenFactores]);\r\n\r\n\r\n\r\n  const [generandoConcepto, setGenerandoConcepto] = useState(false);\r\n\r\n  const handleGenerarConcepto = async () => {\r\n    if (generandoConcepto) return;\r\n\r\n    setGenerandoConcepto(true);\r\n    try {\r\n      const response = await api.post<{\r\n        analisis_generado?: string;\r\n        recomendaciones_generadas?: string;\r\n        concepto?: string;\r\n      }>('/conceptos/generar', {\r\n        valoracion_id: parseInt(params.id as string)\r\n      });\r\n\r\n      if (response && response.analisis_generado) {\r\n        setFormData(prev => ({\r\n          ...prev,\r\n          conclusiones_finales: response.analisis_generado || '',\r\n          recomendaciones: response.recomendaciones_generadas || '',\r\n          // Actualizar también la conclusión breve si está vacía\r\n          conclusion_evaluacion: prev.conclusion_evaluacion || (response.concepto ? response.concepto.substring(0, 500) + '...' : '')\r\n        }));\r\n\r\n        // Guardar automáticamente para persistir los cambios\r\n        await api.post(`/pruebas-trabajo/${params.id}/concepto-final`, {\r\n          ...formData,\r\n          conclusiones_finales: response.analisis_generado || '',\r\n          recomendaciones: response.recomendaciones_generadas || ''\r\n        });\r\n\r\n        toast.success('Concepto generado exitosamente con IA');\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error generando concepto:', error);\r\n      toast.error('Error al generar el concepto');\r\n    } finally {\r\n      setGenerandoConcepto(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      setSaving(true);\r\n\r\n      // Guardar secciones (pasos 1, 2, 3)\r\n      await api.post(`/pruebas-trabajo/${params.id}/secciones`, formData);\r\n\r\n      toast.success('Datos guardados correctamente');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al guardar los datos');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleNext = async () => {\r\n    await handleSave();\r\n    if (currentStep < totalSteps) {\r\n      setCurrentStep(currentStep + 1);\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  };\r\n\r\n  const handlePrevious = () => {\r\n    if (currentStep > 1) {\r\n      setCurrentStep(currentStep - 1);\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  };\r\n\r\n  const handleFinish = async () => {\r\n    await handleSave();\r\n    toast.success('Evaluación completada');\r\n    router.push(`/dashboard/pruebas-trabajo/${params.id}`);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"flex items-center justify-center h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-violet-500\"></div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  const renderStep = () => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return <Step1Metodologia formData={formData} setFormData={setFormData} readOnly={readOnly} />;\r\n      case 2:\r\n        return <Step2RevisionDocumental formData={formData} setFormData={setFormData} readOnly={readOnly} />;\r\n      case 3:\r\n        return <Step3AspectosOcupacionales formData={formData} setFormData={setFormData} readOnly={readOnly} />;\r\n      case 4:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"demandas_cuantitativas\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 5:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"demandas_carga_mental\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 6:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"demandas_emocionales\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 7:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"exigencias_responsabilidad\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 8:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"consistencia_rol\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 9:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"demandas_ambientales\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 10:\r\n        return (\r\n          <StepCondicionesRiesgo\r\n            dimension=\"demandas_jornada\"\r\n            pruebaId={params.id as string}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            setCondicionesRiesgo={setCondicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 11:\r\n        return (\r\n          <StepResumenFactores\r\n            pruebaId={params.id as string}\r\n            resumenFactores={resumenFactores}\r\n            setResumenFactores={setResumenFactores}\r\n            condicionesRiesgo={condicionesRiesgo}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      case 12:\r\n        return (\r\n          <StepConceptoFinal\r\n            formData={formData}\r\n            setFormData={setFormData}\r\n            handleGenerarConcepto={handleGenerarConcepto}\r\n            generandoConcepto={generandoConcepto}\r\n            readOnly={readOnly}\r\n          />\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3\">\r\n              <Briefcase className=\"w-8 h-8 text-violet-500\" />\r\n              Completar Evaluación\r\n            </h1>\r\n            <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n              Paso {currentStep} de {totalSteps}\r\n            </p>\r\n          </div>\r\n          <Link href={`/dashboard/pruebas-trabajo/${params.id}`}>\r\n            <Button variant=\"outline\" className=\"border-gray-200 dark:border-[#333333]\">\r\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n              Volver\r\n            </Button>\r\n          </Link>\r\n        </div>\r\n\r\n        {/* Progress Bar */}\r\n        <div className=\"w-full bg-gray-200 dark:bg-[#333333] rounded-full h-2\">\r\n          <div\r\n            className=\"bg-violet-500 h-2 rounded-full transition-all duration-300\"\r\n            style={{ width: `${(currentStep / totalSteps) * 100}%` }}\r\n          ></div>\r\n        </div>\r\n\r\n        {/* Step Content */}\r\n        <Card className=\"border-gray-200 dark:border-[#333333]\">\r\n          <CardContent className=\"p-6\">{renderStep()}</CardContent>\r\n        </Card>\r\n\r\n        {/* Navigation Buttons */}\r\n        <div className=\"flex justify-between\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={handlePrevious}\r\n            disabled={currentStep === 1}\r\n            className=\"border-gray-200 dark:border-[#333333]\"\r\n          >\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Anterior\r\n          </Button>\r\n\r\n          <div className=\"flex gap-2\">\r\n            {!readOnly && (\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={handleSave}\r\n                disabled={saving}\r\n                className=\"border-gray-200 dark:border-[#333333]\"\r\n              >\r\n                {saving ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    Guardando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Save className=\"mr-2 h-4 w-4\" />\r\n                    Guardar\r\n                  </>\r\n                )}\r\n              </Button>\r\n            )}\r\n\r\n            {currentStep < totalSteps ? (\r\n              <Button\r\n                onClick={handleNext}\r\n                className=\"bg-violet-500 hover:bg-violet-600 text-white\"\r\n              >\r\n                Siguiente\r\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n              </Button>\r\n            ) : (\r\n              !readOnly && (\r\n                <Button\r\n                  onClick={handleFinish}\r\n                  className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                >\r\n                  <CheckCircle2 className=\"mr-2 h-4 w-4\" />\r\n                  Finalizar Evaluación\r\n                </Button>\r\n              )\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\n// ===== COMPONENTES DE PASOS =====\r\n\r\nfunction Step1Metodologia({\r\n  formData,\r\n  setFormData,\r\n  readOnly,\r\n}: {\r\n  formData: StepData;\r\n  setFormData: React.Dispatch<React.SetStateAction<StepData>>;\r\n  readOnly?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Metodología y Participantes\r\n        </h2>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <Label htmlFor=\"metodologia\">Metodología</Label>\r\n          <Textarea\r\n            id=\"metodologia\"\r\n            rows={4}\r\n            value={formData.metodologia}\r\n            onChange={(e) => setFormData({ ...formData, metodologia: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Describa la metodología utilizada para la evaluación...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div>\r\n            <Label htmlFor=\"participante_trabajador\">Participante Trabajador</Label>\r\n            <Input\r\n              id=\"participante_trabajador\"\r\n              value={formData.participante_trabajador}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, participante_trabajador: e.target.value })\r\n              }\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"participante_jefe\">Participante Jefe</Label>\r\n            <Input\r\n              id=\"participante_jefe\"\r\n              value={formData.participante_jefe}\r\n              onChange={(e) => setFormData({ ...formData, participante_jefe: e.target.value })}\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"participante_cargo_jefe\">Cargo del Jefe</Label>\r\n            <Input\r\n              id=\"participante_cargo_jefe\"\r\n              value={formData.participante_cargo_jefe}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, participante_cargo_jefe: e.target.value })\r\n              }\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3\">\r\n            Fuentes de Recolección de Información\r\n          </h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <Label htmlFor=\"fuente_trabajador_fecha\">Fecha Trabajador</Label>\r\n              <Input\r\n                id=\"fuente_trabajador_fecha\"\r\n                type=\"date\"\r\n                value={formData.fuente_trabajador_fecha}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, fuente_trabajador_fecha: e.target.value })\r\n                }\r\n                className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                disabled={readOnly}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"fuente_jefe_fecha\">Fecha Jefe</Label>\r\n              <Input\r\n                id=\"fuente_jefe_fecha\"\r\n                type=\"date\"\r\n                value={formData.fuente_jefe_fecha}\r\n                onChange={(e) => setFormData({ ...formData, fuente_jefe_fecha: e.target.value })}\r\n                className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                disabled={readOnly}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"fuente_par_fecha\">Fecha Par</Label>\r\n              <Input\r\n                id=\"fuente_par_fecha\"\r\n                type=\"date\"\r\n                value={formData.fuente_par_fecha}\r\n                onChange={(e) => setFormData({ ...formData, fuente_par_fecha: e.target.value })}\r\n                className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                disabled={readOnly}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Step2RevisionDocumental({\r\n  formData,\r\n  setFormData,\r\n  readOnly,\r\n}: {\r\n  formData: StepData;\r\n  setFormData: React.Dispatch<React.SetStateAction<StepData>>;\r\n  readOnly?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Revisión Documental y Descripción\r\n        </h2>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <Label htmlFor=\"revision_documental\">Revisión Documental</Label>\r\n          <Textarea\r\n            id=\"revision_documental\"\r\n            rows={5}\r\n            value={formData.revision_documental}\r\n            onChange={(e) => setFormData({ ...formData, revision_documental: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Documente la revisión de documentos relevantes...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"descripcion_puesto\">Descripción del Puesto</Label>\r\n          <Textarea\r\n            id=\"descripcion_puesto\"\r\n            rows={5}\r\n            value={formData.descripcion_puesto}\r\n            onChange={(e) => setFormData({ ...formData, descripcion_puesto: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Describa el puesto de trabajo evaluado...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"condicion_actual\">Condición Actual del Trabajador</Label>\r\n          <Textarea\r\n            id=\"condicion_actual\"\r\n            rows={5}\r\n            value={formData.condicion_actual}\r\n            onChange={(e) => setFormData({ ...formData, condicion_actual: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Describa la condición actual del trabajador...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Step3AspectosOcupacionales({\r\n  formData,\r\n  setFormData,\r\n  readOnly,\r\n}: {\r\n  formData: StepData;\r\n  setFormData: React.Dispatch<React.SetStateAction<StepData>>;\r\n  readOnly?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Aspectos Ocupacionales\r\n        </h2>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <Label htmlFor=\"nombre_puesto\">Nombre del Puesto</Label>\r\n            <Input\r\n              id=\"nombre_puesto\"\r\n              value={formData.nombre_puesto}\r\n              onChange={(e) => setFormData({ ...formData, nombre_puesto: e.target.value })}\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"area_puesto\">Área</Label>\r\n            <Input\r\n              id=\"area_puesto\"\r\n              value={formData.area_puesto}\r\n              onChange={(e) => setFormData({ ...formData, area_puesto: e.target.value })}\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"antiguedad_cargo_ocupacional\">Antigüedad en el Cargo</Label>\r\n            <Input\r\n              id=\"antiguedad_cargo_ocupacional\"\r\n              value={formData.antiguedad_cargo_ocupacional}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, antiguedad_cargo_ocupacional: e.target.value })\r\n              }\r\n              placeholder=\"Ej: 2 años 3 meses\"\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"antiguedad_empresa_ocupacional\">Antigüedad en la Empresa</Label>\r\n            <Input\r\n              id=\"antiguedad_empresa_ocupacional\"\r\n              value={formData.antiguedad_empresa_ocupacional}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, antiguedad_empresa_ocupacional: e.target.value })\r\n              }\r\n              placeholder=\"Ej: 5 años 1 mes\"\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"nivel_educativo_requerido\">Nivel Educativo Requerido</Label>\r\n            <Input\r\n              id=\"nivel_educativo_requerido\"\r\n              value={formData.nivel_educativo_requerido}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, nivel_educativo_requerido: e.target.value })\r\n              }\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"jornada_laboral\">Jornada Laboral</Label>\r\n            <Input\r\n              id=\"jornada_laboral\"\r\n              value={formData.jornada_laboral}\r\n              onChange={(e) => setFormData({ ...formData, jornada_laboral: e.target.value })}\r\n              placeholder=\"Ej: 8:00 AM - 5:00 PM\"\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"horas_extras\">Horas Extras</Label>\r\n            <Input\r\n              id=\"horas_extras\"\r\n              value={formData.horas_extras}\r\n              onChange={(e) => setFormData({ ...formData, horas_extras: e.target.value })}\r\n              placeholder=\"Ej: Ocasionales, 2-3 horas/semana\"\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"turnos\">Turnos</Label>\r\n            <Input\r\n              id=\"turnos\"\r\n              value={formData.turnos}\r\n              onChange={(e) => setFormData({ ...formData, turnos: e.target.value })}\r\n              placeholder=\"Ej: Diurno, Mixto, Rotativo\"\r\n              className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n              disabled={readOnly}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"descripcion_funciones\">Descripción de Funciones</Label>\r\n          <Textarea\r\n            id=\"descripcion_funciones\"\r\n            rows={6}\r\n            value={formData.descripcion_funciones}\r\n            onChange={(e) => setFormData({ ...formData, descripcion_funciones: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Describa las funciones principales del puesto...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StepCondicionesRiesgo({\r\n  dimension,\r\n  pruebaId,\r\n  condicionesRiesgo,\r\n  setCondicionesRiesgo,\r\n  readOnly,\r\n}: {\r\n  dimension: string;\r\n  pruebaId: string;\r\n  condicionesRiesgo: any[];\r\n  setCondicionesRiesgo: React.Dispatch<React.SetStateAction<any[]>>;\r\n  readOnly?: boolean;\r\n}) {\r\n  const dimensionData = DIMENSIONES_RIESGO[dimension as keyof typeof DIMENSIONES_RIESGO];\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const getCondicionData = (itemNumero: number) => {\r\n    const found = condicionesRiesgo.find(\r\n      (c) => c.dimension === dimension && c.item_numero === itemNumero\r\n    );\r\n\r\n    const defaultConfig = {\r\n      dimension,\r\n      item_numero: itemNumero,\r\n      condicion_texto: '',\r\n      descripcion_detallada: '',\r\n      frecuencia: 0,\r\n      exposicion: 0,\r\n      intensidad: 0,\r\n      total_condicion: 0,\r\n      fuentes_informacion: 'Entrevista con el trabajador y jefe inmediato',\r\n    };\r\n\r\n    if (found) {\r\n      return {\r\n        ...defaultConfig,\r\n        ...found,\r\n        // Ensure numeric fields are numbers (handle DB nulls)\r\n        frecuencia: found.frecuencia ?? 0,\r\n        exposicion: found.exposicion ?? 0,\r\n        intensidad: found.intensidad ?? 0,\r\n        total_condicion: found.total_condicion ?? 0,\r\n        // Default text for Fuentes de Información if empty\r\n        fuentes_informacion: found.fuentes_informacion || 'Entrevista con el trabajador y jefe inmediato',\r\n      };\r\n    }\r\n\r\n    return defaultConfig;\r\n  };\r\n\r\n  const updateCondicion = (itemNumero: number, field: string, rawValue: any) => {\r\n    const existingIndex = condicionesRiesgo.findIndex(\r\n      (c) => c.dimension === dimension && c.item_numero === itemNumero\r\n    );\r\n\r\n    let value = rawValue;\r\n\r\n    // Strict validation for numeric fields\r\n    if (['frecuencia', 'exposicion', 'intensidad'].includes(field)) {\r\n      // Force empty string if invalid or allow 0\r\n      if (rawValue === '' || rawValue === undefined) {\r\n        value = 0;\r\n      } else {\r\n        const parsed = parseInt(rawValue);\r\n        value = isNaN(parsed) ? 0 : parsed;\r\n        if (value > 7) value = 7;\r\n        if (value < 0) value = 0;\r\n      }\r\n    }\r\n\r\n    const updatedCondicion = {\r\n      ...getCondicionData(itemNumero),\r\n      [field]: value,\r\n    };\r\n\r\n    // Calcular total if change is in FR, EXP or INT\r\n    if (['frecuencia', 'exposicion', 'intensidad'].includes(field)) {\r\n      const sum =\r\n        (Number(updatedCondicion.frecuencia) || 0) +\r\n        (Number(updatedCondicion.exposicion) || 0) +\r\n        (Number(updatedCondicion.intensidad) || 0);\r\n\r\n      // Ensure total never exceeds 21 (fallback safety)\r\n      updatedCondicion.total_condicion = sum > 21 ? 21 : sum;\r\n    }\r\n\r\n    if (existingIndex >= 0) {\r\n      const newCondiciones = [...condicionesRiesgo];\r\n      newCondiciones[existingIndex] = updatedCondicion;\r\n      setCondicionesRiesgo(newCondiciones);\r\n    } else {\r\n      setCondicionesRiesgo([...condicionesRiesgo, updatedCondicion]);\r\n    }\r\n  };\r\n\r\n  // Helper for input onChange to enforce strict control\r\n  const handleNumericInput = (itemNumero: number, field: string, e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const inputValue = e.target.value;\r\n\r\n    // If empty, allow it momentarily as 0, or handle as delete\r\n    if (inputValue === '') {\r\n      updateCondicion(itemNumero, field, 0);\r\n      return;\r\n    }\r\n\r\n    let val = parseInt(inputValue);\r\n\r\n    // Strict clamping\r\n    if (isNaN(val)) val = 0;\r\n    if (val > 7) val = 7;\r\n    if (val < 0) val = 0;\r\n\r\n    // Force update with validated value\r\n    // We explicitly cast to number to ensure state is clean\r\n    updateCondicion(itemNumero, field, Number(val));\r\n  };\r\n\r\n  const handleSaveCondiciones = async () => {\r\n    try {\r\n      setSaving(true);\r\n\r\n      // Guardar todas las condiciones de esta dimensión\r\n      for (const item of dimensionData.items) {\r\n        const condicionData = getCondicionData(item.numero);\r\n\r\n        // Guardamos si tiene algún dato relevante\r\n        if (condicionData.descripcion_detallada || condicionData.total_condicion > 0 || condicionData.frecuencia !== undefined) {\r\n          // Asegurarnos de guardar incluso si es 0 pero ha sido editado, \r\n          // para este caso asumimos que si existe el objeto en el estado local, lo guardamos.\r\n          await api.post(`/pruebas-trabajo/${pruebaId}/condiciones-riesgo`, {\r\n            ...condicionData,\r\n            condicion_texto: item.texto,\r\n          });\r\n        }\r\n      }\r\n\r\n      toast.success('Condiciones guardadas correctamente');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al guardar las condiciones');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const totalDimension = dimensionData.items.reduce((acc, item) => acc + (getCondicionData(item.numero).total_condicion || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        {/* Title is now inside the table header, but we keep the save button here */}\r\n        <div className=\"flex-1\"></div>\r\n        {!readOnly && (\r\n          <Button\r\n            onClick={handleSaveCondiciones}\r\n            disabled={saving}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"border-gray-200 dark:border-[#333333] mb-2\"\r\n          >\r\n            {saving ? (\r\n              <>\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Guardando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Save className=\"mr-2 h-4 w-4\" />\r\n                Guardar Cambios\r\n              </>\r\n            )}\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"overflow-x-auto border border-gray-200 dark:border-[#333333] rounded-lg shadow-sm\">\r\n        <table className=\"w-full text-sm text-left\">\r\n          <thead>\r\n            <tr className=\"bg-violet-500 text-white\">\r\n              <th colSpan={6} className=\"px-6 py-3 text-lg font-bold uppercase tracking-wider text-center border-b border-[#e55a2b]\">\r\n                {dimensionData.nombre}\r\n              </th>\r\n            </tr>\r\n            <tr className=\"bg-gray-100 dark:bg-[#1a1a1a] text-gray-700 dark:text-gray-200 font-semibold border-b border-gray-200 dark:border-[#333333]\">\r\n              <th className=\"px-4 py-3 w-[30%]\">Condición</th>\r\n              <th className=\"px-2 py-3 text-center w-[10%]\">Frecuencia<br />(0-7)</th>\r\n              <th className=\"px-2 py-3 text-center w-[10%]\">Exposición<br />(0-7)</th>\r\n              <th className=\"px-2 py-3 text-center w-[10%]\">Intensidad<br />(0-7)</th>\r\n              <th className=\"px-2 py-3 text-center w-[8%]\">Total (Suma)</th>\r\n              <th className=\"px-4 py-3 w-[32%]\">Fuentes de Información</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"divide-y divide-gray-200 dark:divide-[#333333] bg-white dark:bg-[#0f0f0f]\">\r\n            {dimensionData.items.map((item) => {\r\n              const condicionData = getCondicionData(item.numero);\r\n              return (\r\n                <tr key={item.numero} className=\"hover:bg-gray-50 dark:hover:bg-[#151515]\">\r\n                  <td className=\"px-4 py-3 align-middle font-medium text-gray-900 dark:text-white\">\r\n                    {item.texto}\r\n                  </td>\r\n                  <td className=\"px-2 py-3 align-middle text-center\">\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      max=\"7\"\r\n                      value={condicionData.frecuencia}\r\n                      onChange={(e) => handleNumericInput(item.numero, 'frecuencia', e)}\r\n                      className=\"w-full text-center h-9 rounded-md border border-gray-300 dark:border-[#333333] bg-white dark:bg-[#1a1a1a] focus:ring-2 focus:ring-violet-500 focus:outline-none\"\r\n                      disabled={readOnly}\r\n                    />\r\n                  </td>\r\n                  <td className=\"px-2 py-3 align-middle text-center\">\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      max=\"7\"\r\n                      value={condicionData.exposicion}\r\n                      onChange={(e) => handleNumericInput(item.numero, 'exposicion', e)}\r\n                      className=\"w-full text-center h-9 rounded-md border border-gray-300 dark:border-[#333333] bg-white dark:bg-[#1a1a1a] focus:ring-2 focus:ring-violet-500 focus:outline-none\"\r\n                      disabled={readOnly}\r\n                    />\r\n                  </td>\r\n                  <td className=\"px-2 py-3 align-middle text-center\">\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      max=\"7\"\r\n                      value={condicionData.intensidad}\r\n                      onChange={(e) => handleNumericInput(item.numero, 'intensidad', e)}\r\n                      className=\"w-full text-center h-9 rounded-md border border-gray-300 dark:border-[#333333] bg-white dark:bg-[#1a1a1a] focus:ring-2 focus:ring-violet-500 focus:outline-none\"\r\n                      disabled={readOnly}\r\n                    />\r\n                  </td>\r\n                  <td className=\"px-2 py-3 align-middle text-center font-bold text-gray-900 dark:text-white\">\r\n                    {condicionData.total_condicion ?? 0}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 align-middle\">\r\n                    <Input\r\n                      value={condicionData.fuentes_informacion || 'Entrevista con el trabajador y el jefe inmediato'}\r\n                      onChange={(e) => updateCondicion(item.numero, 'fuentes_informacion', e.target.value)}\r\n                      className=\"w-full h-9 bg-white dark:bg-[#1a1a1a] border-gray-300 dark:border-[#333333] text-sm\"\r\n                      disabled={readOnly}\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n          <tfoot>\r\n            <tr className=\"bg-gray-50 dark:bg-[#1a1a1a] font-bold border-t-2 border-gray-200 dark:border-[#333333]\">\r\n              <td className=\"px-4 py-3 text-right text-gray-700 dark:text-gray-300\">TOTAL DEMANDA:</td>\r\n              <td colSpan={3} className=\"px-2 py-3\">\r\n                {/* Visualización del Nivel de Riesgo en el Footer */}\r\n                {(() => {\r\n                  const { nivel, color } = getNivelRiesgo(dimension, totalDimension);\r\n                  return (\r\n                    <div className={`text-center py-1 px-3 rounded text-sm ${color}`}>\r\n                      {nivel}\r\n                    </div>\r\n                  );\r\n                })()}\r\n              </td>\r\n              <td className=\"px-2 py-3 text-center text-lg text-violet-500\">\r\n                {totalDimension}\r\n              </td>\r\n              <td className=\"px-4 py-3\"></td>\r\n            </tr>\r\n          </tfoot>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StepResumenFactores({\r\n  pruebaId,\r\n  resumenFactores,\r\n  setResumenFactores,\r\n  condicionesRiesgo,\r\n  readOnly,\r\n}: {\r\n  pruebaId: string;\r\n  resumenFactores: any[];\r\n  setResumenFactores: React.Dispatch<React.SetStateAction<any[]>>;\r\n  condicionesRiesgo: any[];\r\n  readOnly?: boolean;\r\n}) {\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const dimensiones = Object.keys(DIMENSIONES_RIESGO);\r\n\r\n  const getResumenData = (dimension: string) => {\r\n    return resumenFactores.find((r) => r.dimension === dimension) || {\r\n      dimension,\r\n      num_items: DIMENSIONES_RIESGO[dimension as keyof typeof DIMENSIONES_RIESGO].items.length,\r\n      puntuacion_total: 0,\r\n      nivel_riesgo_trabajador: '',\r\n      nivel_riesgo_experto: '',\r\n      factores_detectados_trabajador: '',\r\n      factores_detectados_experto: '',\r\n      observaciones_experto: '',\r\n    };\r\n  };\r\n\r\n  const updateResumen = (dimension: string, field: string, value: any) => {\r\n    const existingIndex = resumenFactores.findIndex((r) => r.dimension === dimension);\r\n    const updatedResumen = {\r\n      ...getResumenData(dimension),\r\n      [field]: value,\r\n    };\r\n\r\n    if (existingIndex >= 0) {\r\n      const newResumen = [...resumenFactores];\r\n      newResumen[existingIndex] = updatedResumen;\r\n      setResumenFactores(newResumen);\r\n    } else {\r\n      setResumenFactores([...resumenFactores, updatedResumen]);\r\n    }\r\n  };\r\n\r\n  const handleSaveResumen = async () => {\r\n    try {\r\n      setSaving(true);\r\n\r\n      for (const dimension of dimensiones) {\r\n        const resumenData = { ...getResumenData(dimension) };\r\n\r\n        // --- INICIO AUTO-CALCULO --- \r\n        // Calculamos el nivel de riesgo en base a las condiciones actuales\r\n        const totalScore = condicionesRiesgo\r\n          .filter((c) => c.dimension === dimension)\r\n          .reduce((sum, c) => sum + (c.total_condicion || 0), 0);\r\n\r\n        const { nivel } = getNivelRiesgo(dimension, totalScore);\r\n\r\n        // Mapeamos a snake_case para el backend\r\n        let nivelInterno = '';\r\n        if (nivel === 'SIN RIESGO') nivelInterno = 'sin_riesgo';\r\n        else if (nivel === 'RIESGO BAJO') nivelInterno = 'riesgo_bajo';\r\n        else if (nivel === 'RIESGO MEDIO') nivelInterno = 'riesgo_medio';\r\n        else if (nivel === 'RIESGO ALTO') nivelInterno = 'riesgo_alto';\r\n        else if (nivel === 'RIESGO MUY ALTO') nivelInterno = 'riesgo_muy_alto';\r\n\r\n        // Asignamos el valor calculado\r\n        resumenData.nivel_riesgo_trabajador = nivelInterno;\r\n        resumenData.puntuacion_total = totalScore;\r\n        // --- FIN AUTO-CALCULO ---\r\n\r\n        if (resumenData.factores_detectados_experto || resumenData.nivel_riesgo_experto || resumenData.nivel_riesgo_trabajador || resumenData.puntuacion_total > 0) {\r\n          await api.post(`/pruebas-trabajo/${pruebaId}/resumen-factores`, resumenData);\r\n        }\r\n      }\r\n\r\n      toast.success('Resumen guardado correctamente');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      toast.error('Error al guardar el resumen');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\r\n          Resumen de Factores de Riesgo\r\n        </h2>\r\n        {!readOnly && (\r\n          <Button\r\n            onClick={handleSaveResumen}\r\n            disabled={saving}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"border-gray-200 dark:border-[#333333]\"\r\n          >\r\n            {saving ? (\r\n              <>\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Guardando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Save className=\"mr-2 h-4 w-4\" />\r\n                Guardar\r\n              </>\r\n            )}\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n        Compare la valoración subjetiva del trabajador con su valoración como experto para cada\r\n        dimensión de riesgo.\r\n      </p>\r\n\r\n      <div className=\"space-y-6\">\r\n        {dimensiones.map((dimension) => {\r\n          const dimensionData =\r\n            DIMENSIONES_RIESGO[dimension as keyof typeof DIMENSIONES_RIESGO];\r\n          const resumenData = getResumenData(dimension);\r\n\r\n          // Calculate total score for this dimension from condicionesRiesgo\r\n          const totalScore = condicionesRiesgo\r\n            .filter((c) => c.dimension === dimension)\r\n            .reduce((sum, c) => sum + (c.total_condicion || 0), 0);\r\n\r\n          const { nivel: calculatedRisk, color: riskColor } = getNivelRiesgo(dimension, totalScore);\r\n\r\n          return (\r\n            <Card key={dimension} className=\"border-gray-200 dark:border-[#333333]\">\r\n              <CardHeader className=\"pb-3 bg-gray-50 dark:bg-[#1a1a1a]\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <CardTitle className=\"text-base\">{dimensionData.nombre}</CardTitle>\r\n                  <span className=\"text-sm font-medium px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded\">\r\n                    Puntaje Total: {totalScore}\r\n                  </span>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"pt-4 space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Nivel de Riesgo (Cuestionario) - Calculado</Label>\r\n                    <div className={`p-2 rounded font-bold text-center border ${riskColor} mt-1`}>\r\n                      {calculatedRisk}\r\n                    </div>\r\n                    {/* Hidden input to keep logic if needed, but display is now custom div */}\r\n                    <input\r\n                      type=\"hidden\"\r\n                      value={calculatedRisk}\r\n                    // We might want to save this value to the state if it's meant to be persisted\r\n                    // But for now it's calculated on fly for display. \r\n                    // If it needs to be saved to DB as 'nivel_riesgo_trabajador', we should update the state.\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>Nivel de Riesgo - Experto</Label>\r\n                    <select\r\n                      value={resumenData.nivel_riesgo_experto || ''}\r\n                      onChange={(e) =>\r\n                        updateResumen(dimension, 'nivel_riesgo_experto', e.target.value)\r\n                      }\r\n                      className=\"w-full px-3 py-2 rounded-md border border-gray-200 dark:border-[#333333] bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-white\"\r\n                      disabled={readOnly}\r\n                    >\r\n                      <option value=\"\">Seleccionar...</option>\r\n                      <option value=\"sin_riesgo\">Sin Riesgo</option>\r\n                      <option value=\"riesgo_bajo\">Riesgo Bajo</option>\r\n                      <option value=\"riesgo_medio\">Riesgo Medio</option>\r\n                      <option value=\"riesgo_alto\">Riesgo Alto</option>\r\n                      <option value=\"riesgo_muy_alto\">Riesgo Muy Alto</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Factores Detectados por el Trabajador</Label>\r\n                  <Textarea\r\n                    rows={3}\r\n                    value={resumenData.factores_detectados_trabajador || ''}\r\n                    onChange={(e) =>\r\n                      updateResumen(dimension, 'factores_detectados_trabajador', e.target.value)\r\n                    }\r\n                    className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                    placeholder=\"Liste los factores reportados por el trabajador...\"\r\n                    disabled={readOnly}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Factores Detectados por el Experto</Label>\r\n                  <Textarea\r\n                    rows={3}\r\n                    value={resumenData.factores_detectados_experto || ''}\r\n                    onChange={(e) =>\r\n                      updateResumen(dimension, 'factores_detectados_experto', e.target.value)\r\n                    }\r\n                    className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                    placeholder=\"Liste los factores identificados por el experto...\"\r\n                    disabled={readOnly}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Observaciones del Experto</Label>\r\n                  <Textarea\r\n                    rows={2}\r\n                    value={resumenData.observaciones_experto || ''}\r\n                    onChange={(e) =>\r\n                      updateResumen(dimension, 'observaciones_experto', e.target.value)\r\n                    }\r\n                    className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n                    placeholder=\"Agregue observaciones adicionales...\"\r\n                    disabled={readOnly}\r\n                  />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StepConceptoFinal({\r\n  formData,\r\n  setFormData,\r\n  handleGenerarConcepto,\r\n  generandoConcepto,\r\n  readOnly,\r\n}: {\r\n  formData: StepData;\r\n  setFormData: React.Dispatch<React.SetStateAction<StepData>>;\r\n  handleGenerarConcepto: () => void;\r\n  generandoConcepto: boolean;\r\n  readOnly?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Conclusiones Finales\r\n        </h2>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <Label htmlFor=\"conclusion_evaluacion\">Conclusión de la Evaluación</Label>\r\n          <Textarea\r\n            id=\"conclusion_evaluacion\"\r\n            rows={4}\r\n            value={formData.conclusion_evaluacion}\r\n            onChange={(e) => setFormData({ ...formData, conclusion_evaluacion: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Resuma la conclusión general de la evaluación...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"concordancia_items\">Ítems con Concordancia</Label>\r\n          <Textarea\r\n            id=\"concordancia_items\"\r\n            rows={3}\r\n            value={formData.concordancia_items}\r\n            onChange={(e) => setFormData({ ...formData, concordancia_items: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Liste los ítems donde hay concordancia entre trabajador y experto...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"no_concordancia_items\">Ítems sin Concordancia</Label>\r\n          <Textarea\r\n            id=\"no_concordancia_items\"\r\n            rows={3}\r\n            value={formData.no_concordancia_items}\r\n            onChange={(e) => setFormData({ ...formData, no_concordancia_items: e.target.value })}\r\n            className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n            placeholder=\"Liste los ítems donde NO hay concordancia...\"\r\n            disabled={readOnly}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex justify-between items-center mb-2 mt-6\">\r\n          <Label htmlFor=\"conclusiones_finales\" className=\"text-lg font-semibold\">\r\n            Conclusiones Finales de la Prueba de Trabajo de Esfera Mental\r\n          </Label>\r\n          {!readOnly && (\r\n            <Button\r\n              onClick={handleGenerarConcepto}\r\n              disabled={generandoConcepto}\r\n              className=\"bg-purple-600 hover:bg-purple-700 text-white shadow-sm\"\r\n              size=\"sm\"\r\n            >\r\n              {generandoConcepto ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Generando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Sparkles className=\"mr-2 h-4 w-4 text-yellow-300\" /> Generar con IA\r\n                </>\r\n              )}\r\n            </Button>\r\n          )}\r\n        </div>\r\n        <Textarea\r\n          id=\"conclusiones_finales\"\r\n          rows={6}\r\n          value={formData.conclusiones_finales}\r\n          onChange={(e) => setFormData({ ...formData, conclusiones_finales: e.target.value })}\r\n          className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n          placeholder=\"Escriba las conclusiones finales completas...\"\r\n          disabled={readOnly}\r\n        />\r\n        <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n          Este campo puede ser generado automáticamente por el modelo de ML en el futuro\r\n        </p>\r\n      </div>\r\n\r\n      <div>\r\n        <Label htmlFor=\"recomendaciones\">Recomendaciones</Label>\r\n        <Textarea\r\n          id=\"recomendaciones\"\r\n          rows={4}\r\n          value={formData.recomendaciones}\r\n          onChange={(e) => setFormData({ ...formData, recomendaciones: e.target.value })}\r\n          className=\"bg-white dark:bg-[#1a1a1a] border-gray-200 dark:border-[#333333]\"\r\n          placeholder=\"Agregue las recomendaciones finales...\"\r\n          disabled={readOnly}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\pruebas-trabajo\\PruebaTrabajoWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":304,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14360,14363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14360,14363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":381,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17041,17044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17041,17044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":393,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17500,17503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17500,17503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'formData.concordancia_items' and 'formData.no_concordancia_items'. Either include them or remove the dependency array.","line":429,"column":6,"nodeType":"ArrayExpression","endLine":429,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [formData.concordancia_items, formData.no_concordancia_items, formData.resumen_factores]","fix":{"range":[18993,19020],"text":"[formData.concordancia_items, formData.no_concordancia_items, formData.resumen_factores]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":431,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19071,19074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19071,19074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20311,20314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20311,20314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":464,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":464,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20608,20611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20608,20611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":467,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":467,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20714,20717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20714,20717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25488,25491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25488,25491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":544,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":544,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25981,25984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25981,25984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":560,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":560,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26729,26732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26729,26732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":565,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27042,27045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27042,27045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":597,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":597,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28313,28316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28313,28316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":601,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":601,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28447,28450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28447,28450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":627,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":627,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30056,30059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30056,30059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":644,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":644,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30697,30700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30697,30700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":662,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31582,31585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31582,31585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":770,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":770,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37672,37675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37672,37675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":777,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":777,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37907,37910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37907,37910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":786,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":786,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38325,38328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38325,38328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":791,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":791,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38506,38509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38506,38509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1570,"column":29,"nodeType":"JSXOpeningElement","endLine":1574,"endColumn":31}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { DashboardLayout } from '@/app/components/layout/DashboardLayout';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { api } from '@/app/services/api';\r\nimport { toast } from 'sonner';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n  User,\r\n  Briefcase,\r\n  Activity,\r\n  AlertTriangle,\r\n  FileText,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Save,\r\n  Loader2,\r\n  Download,\r\n  X,\r\n  AlertCircle,\r\n  Sparkles,\r\n  Upload\r\n} from 'lucide-react';\r\n\r\n// ─── Steps ───────────────────────────────────────────────────────────\r\nconst steps = [\r\n  { id: 1, title: 'Identificación', icon: User },\r\n  { id: 2, title: 'Contexto y Participantes', icon: Briefcase },\r\n  { id: 3, title: 'Descripción del Cargo', icon: Activity },\r\n  { id: 4, title: 'Factores de Riesgo', icon: AlertTriangle },\r\n  { id: 5, title: 'Resumen y Concepto', icon: FileText },\r\n];\r\n\r\n// ─── Condiciones de Riesgo (33 condiciones en 7 dimensiones) ─────────\r\ninterface CondicionItem {\r\n  numero: number;\r\n  nombre: string;\r\n  descripcion: string;\r\n}\r\n\r\nconst factoresRiesgo: Record<string, { titulo: string; items: CondicionItem[] }> = {\r\n  demandas_cuantitativas: {\r\n    titulo: 'Demandas Cuantitativas de Trabajo',\r\n    items: [\r\n      {\r\n        numero: 1,\r\n        nombre: 'Ritmo de trabajo acelerado o bajo presión de tiempo',\r\n        descripcion: 'Esta condición considera la velocidad con la que se realizan las tareas y/o el ritmo acelerado de trabajo con el fin de cumplir con la cantidad de responsabilidades, lo que podría constituir un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 2,\r\n        nombre: 'Imposibilidad de hacer pausas dentro de la jornada',\r\n        descripcion: 'Esta condición examina la posibilidad que tiene un trabajador de detener su actividad laboral para tomar un descanso o hacer una pausa, dependiendo de la cantidad de trabajo que tiene que hacer.'\r\n      },\r\n      {\r\n        numero: 3,\r\n        nombre: 'Tiempo adicional para cumplir con el trabajo asignado',\r\n        descripcion: 'Esta condición considera la cantidad de tiempo que se debe invertir para realizar todas las actividades de las tareas asignadas. Trabajar tiempo adicional al de la jornada establecida para lograr cumplir con el trabajo asignado se constituye en un factor de riesgo.'\r\n      },\r\n    ]\r\n  },\r\n  demandas_carga_mental: {\r\n    titulo: 'Demandas de Carga Mental',\r\n    items: [\r\n      {\r\n        numero: 4,\r\n        nombre: 'Exigencia de memoria, atención y concentración',\r\n        descripcion: 'Esta condición considera si se debe realizar un esfuerzo mental importante de memoria, atención o concentración para el desarrollo de sus actividades.'\r\n      },\r\n      {\r\n        numero: 5,\r\n        nombre: 'Exigencia de altos niveles de detalle o precisión',\r\n        descripcion: 'Esta condición considera si se debe realizar un esfuerzo mental importante para atender información detallada o debe manipular con precisión materiales, equipos o herramientas para el desarrollo de sus actividades.'\r\n      },\r\n      {\r\n        numero: 6,\r\n        nombre: 'Elevada cantidad de información que se usa bajo presión de tiempo',\r\n        descripcion: 'Esta condición evalúa si se debe realizar un esfuerzo mental importante derivado del uso de mucha información en poco tiempo.'\r\n      },\r\n      {\r\n        numero: 7,\r\n        nombre: 'Elevada cantidad de información que se usa de forma simultánea',\r\n        descripcion: 'Esta condición considera si para el cargo se debe realizar un esfuerzo mental importante derivado del uso simultáneo de mucha información proveniente de diferentes fuentes.'\r\n      },\r\n      {\r\n        numero: 8,\r\n        nombre: 'La información necesaria para realizar el trabajo es compleja',\r\n        descripcion: 'Para el desarrollo de las funciones del cargo, se evalúa si se debe realizar un esfuerzo mental importante derivado del uso de información compleja.'\r\n      },\r\n    ]\r\n  },\r\n  demandas_emocionales: {\r\n    titulo: 'Demandas emocionales',\r\n    items: [\r\n      {\r\n        numero: 9,\r\n        nombre: 'Exposición a sentimientos, emociones y trato negativo de usuarios o clientes',\r\n        descripcion: 'Esta condición considera si en virtud de su trabajo, la persona se expone al estado emocional alterado (tristeza, irritabilidad, agresividad) de clientes o usuarios.'\r\n      },\r\n      {\r\n        numero: 10,\r\n        nombre: 'Exposición a situaciones emocionalmente devastadoras',\r\n        descripcion: 'En el desarrollo de las labores, se evalúa si el trabajador experimenta situaciones emocionalmente devastadoras.'\r\n      },\r\n      {\r\n        numero: 11,\r\n        nombre: 'Requerimiento de ocultar o simular emociones o sentimientos',\r\n        descripcion: 'En virtud de su trabajo, se evalúa si el funcionario recibe directrices que limitan la expresión de sentimientos y emociones de su naturaleza humana.'\r\n      },\r\n    ]\r\n  },\r\n  exigencias_responsabilidad: {\r\n    titulo: 'Exigencias de Responsabilidad del Cargo',\r\n    items: [\r\n      {\r\n        numero: 12,\r\n        nombre: 'Responsabilidad directa por la vida, salud o seguridad de otras personas',\r\n        descripcion: 'Esta condición está presente cuando el puesto que ocupa el servidor responde directamente por la vida, salud o seguridad de otras personas. Indaga si las actividades que se desarrollan en el puesto pueden tener un impacto directo sobre la promoción de la vida, el cuidado de la salud o la seguridad de otras personas.'\r\n      },\r\n      {\r\n        numero: 13,\r\n        nombre: 'Responsabilidad directa por supervisión de personal',\r\n        descripcion: 'Esta condición indaga si el puesto tiene bajo su directa responsabilidad la jefatura de otras personas.'\r\n      },\r\n      {\r\n        numero: 14,\r\n        nombre: 'Responsabilidad directa por resultados del área de trabajo',\r\n        descripcion: 'Esta condición indaga si en el puesto que se desempeña está la responsabilidad final de alcanzar los resultados generales del área.'\r\n      },\r\n      {\r\n        numero: 15,\r\n        nombre: 'Responsabilidad directa por bienes de elevada cuantía',\r\n        descripcion: 'Esta condición revisa la tenencia bajo su responsabilidad de elementos cuyo costo sea considerable y su afectación pueda resultar en un detrimento patrimonial de la institución.'\r\n      },\r\n      {\r\n        numero: 16,\r\n        nombre: 'Responsabilidad directa por dinero de la organización',\r\n        descripcion: 'Se evalúa si el cargo desempeñado es responsable de la tenencia o custodia de dinero en efectivo o papeles valor.'\r\n      },\r\n      {\r\n        numero: 17,\r\n        nombre: 'Responsabilidad directa por información confidencial',\r\n        descripcion: 'El cargo exige mantener secretismo sobre información sensible.'\r\n      },\r\n    ]\r\n  },\r\n  consistencia_rol: {\r\n    titulo: 'Consistencia de Rol',\r\n    items: [\r\n      {\r\n        numero: 18,\r\n        nombre: 'Falta de recursos, personas o herramientas necesarias para desarrollar el trabajo',\r\n        descripcion: 'La condición examina si para el desarrollo de las funciones existen falencias en algunos recursos que la tarea requiere.'\r\n      },\r\n      {\r\n        numero: 19,\r\n        nombre: 'Órdenes contradictorias provenientes de una o varias personas',\r\n        descripcion: 'En esta condición, el funcionario se somete a recibir órdenes o requerimientos que pueden ser contradictorios dentro de la cadena de mando.'\r\n      },\r\n      {\r\n        numero: 20,\r\n        nombre: 'Solicitudes o requerimientos innecesarios en el trabajo',\r\n        descripcion: 'Se refiere a solicitudes o requerimientos innecesarios dentro del desarrollo de las actividades.'\r\n      },\r\n      {\r\n        numero: 21,\r\n        nombre: 'Solicitudes o requerimientos que van en contra de principios éticos, técnicos, de seguridad o de calidad o servicio del producto',\r\n        descripcion: 'La naturaleza de la tarea puede estar permeada por demandas no asertivas que coloquen en riesgo la integridad moral, profesional o física del trabajador.'\r\n      },\r\n    ]\r\n  },\r\n  demandas_ambientales: {\r\n    titulo: 'Demandas Ambientales y de Esfuerzo Físico',\r\n    items: [\r\n      {\r\n        numero: 22,\r\n        nombre: 'Ruido que afecta negativamente',\r\n        descripcion: 'En el puesto de trabajo el ruido puede ser un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 23,\r\n        nombre: 'Iluminación que afecta negativamente',\r\n        descripcion: 'La presencia de luz artificial o la escasez de luz natural, así como el exceso de las mismas, pueden ser un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 24,\r\n        nombre: 'Temperatura que afecta negativamente',\r\n        descripcion: 'La temperatura puede ser un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 25,\r\n        nombre: 'Condiciones de Ventilación que afecten negativamente',\r\n        descripcion: 'La ventilación natural en su exceso o escasez puede ser un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 26,\r\n        nombre: 'Distribución y características del puesto, equipos o herramientas que afectan negativamente',\r\n        descripcion: 'La distribución y características del puesto, equipos o herramientas pueden convertirse en un factor estresante e incluso en un factor de riesgo físico.'\r\n      },\r\n      {\r\n        numero: 27,\r\n        nombre: 'Condiciones de orden y aseo que afecten negativamente',\r\n        descripcion: 'Las condiciones de orden y aseo pueden constituir un factor de riesgo.'\r\n      },\r\n      {\r\n        numero: 28,\r\n        nombre: 'Preocupación por exposición a agentes biológicos',\r\n        descripcion: 'La persona percibe la posibilidad de estar expuesto a virus, bacterias, hongos y otros patógenos.'\r\n      },\r\n      {\r\n        numero: 29,\r\n        nombre: 'Preocupación por exposición a agentes químicos',\r\n        descripcion: 'Se evalúan las características de la tarea respecto a la exposición a agentes químicos.'\r\n      },\r\n      {\r\n        numero: 30,\r\n        nombre: 'Preocupación ante la posibilidad de sufrir un accidente de trabajo',\r\n        descripcion: 'La persona percibe que puede estar sujeta a la ocurrencia de un accidente de trabajo en el cumplimiento de sus tareas.'\r\n      },\r\n      {\r\n        numero: 31,\r\n        nombre: 'Exigencias de esfuerzo físico que afectan negativamente',\r\n        descripcion: 'Para el desarrollo de las tareas se requiere esfuerzo físico que puede constituir un factor de riesgo.'\r\n      },\r\n    ]\r\n  },\r\n  demandas_jornada: {\r\n    titulo: 'Demandas de la Jornada de Trabajo',\r\n    items: [\r\n      {\r\n        numero: 32,\r\n        nombre: 'Trabajo en horario nocturno',\r\n        descripcion: 'A razón del cargo, el trabajador puede requerir laborar en horario nocturno.'\r\n      },\r\n      {\r\n        numero: 33,\r\n        nombre: 'Días de trabajo consecutivo sin descanso',\r\n        descripcion: 'Se evalúa si se refieren días de trabajo consecutivos sin descanso.'\r\n      },\r\n    ]\r\n  }\r\n};\r\n\r\n// ─── Baremos ─────────────────────────────────────────────────────────\r\nconst BAREMOS: Record<string, { sin: number; bajo: number; medio: number; alto: number; muy_alto: number }> = {\r\n  demandas_cuantitativas: { sin: 12.6, bajo: 25.3, medio: 38, alto: 50.6, muy_alto: 63 },\r\n  demandas_carga_mental: { sin: 21, bajo: 42, medio: 63, alto: 84, muy_alto: 105 },\r\n  demandas_emocionales: { sin: 12.6, bajo: 25.3, medio: 38, alto: 50.6, muy_alto: 63 },\r\n  exigencias_responsabilidad: { sin: 25.2, bajo: 50.4, medio: 75.6, alto: 100.8, muy_alto: 126 },\r\n  consistencia_rol: { sin: 16.8, bajo: 33.6, medio: 50.4, alto: 67.2, muy_alto: 84 },\r\n  demandas_ambientales: { sin: 42, bajo: 84, medio: 126, alto: 168, muy_alto: 210 },\r\n  demandas_jornada: { sin: 8.4, bajo: 16.8, medio: 25.2, alto: 33.6, muy_alto: 42 },\r\n};\r\n\r\nconst getNivelRiesgo = (dimension: string, puntaje: number) => {\r\n  const rangos = BAREMOS[dimension];\r\n  if (!rangos) return { nivel: 'N/A', color: 'bg-gray-200 text-gray-800' };\r\n  if (puntaje <= rangos.sin) return { nivel: 'SIN RIESGO', color: 'bg-green-500 text-white' };\r\n  if (puntaje <= rangos.bajo) return { nivel: 'RIESGO BAJO', color: 'bg-yellow-400 text-black' };\r\n  if (puntaje <= rangos.medio) return { nivel: 'RIESGO MEDIO', color: 'bg-orange-500 text-white' };\r\n  if (puntaje <= rangos.alto) return { nivel: 'RIESGO ALTO', color: 'bg-red-500 text-white' };\r\n  return { nivel: 'RIESGO MUY ALTO', color: 'bg-red-900 text-white' };\r\n};\r\n\r\nconst getRiskColor = (risk: string) => {\r\n  switch (risk) {\r\n    case 'sin_riesgo': return 'bg-green-100 text-green-800 border-green-200';\r\n    case 'riesgo_bajo': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n    case 'riesgo_medio': return 'bg-orange-100 text-orange-800 border-orange-200';\r\n    case 'riesgo_alto': return 'bg-red-100 text-red-800 border-red-200';\r\n    case 'riesgo_muy_alto': return 'bg-red-800 text-white border-red-900';\r\n    default: return 'bg-white border-gray-200';\r\n  }\r\n};\r\n\r\nconst NIVELES_RIESGO = [\r\n  { value: 'riesgo_muy_alto', label: 'RIESGO MUY ALTO', color: 'bg-red-900 text-white' },\r\n  { value: 'riesgo_alto', label: 'RIESGO ALTO', color: 'bg-red-500 text-white' },\r\n  { value: 'riesgo_medio', label: 'RIESGO MEDIO', color: 'bg-orange-500 text-white' },\r\n  { value: 'riesgo_bajo', label: 'RIESGO BAJO', color: 'bg-yellow-400 text-black' },\r\n  { value: 'sin_riesgo', label: 'SIN RIESGO', color: 'bg-green-500 text-white' },\r\n];\r\n\r\n// ─── Component ───────────────────────────────────────────────────────\r\ninterface PruebaTrabajoWizardProps {\r\n  id?: number | null;\r\n  mode?: 'create' | 'edit' | 'view';\r\n  readOnly?: boolean;\r\n}\r\n\r\nexport function PruebaTrabajoWizard({ id, mode = 'create', readOnly = false }: PruebaTrabajoWizardProps) {\r\n  const router = useRouter();\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [saving, setSaving] = useState(false);\r\n  const [cargando, setCargando] = useState(false);\r\n  const [pruebaId, setPruebaId] = useState<number | null>(id || null);\r\n  const [showDownloadModal, setShowDownloadModal] = useState(false);\r\n  const [downloadUrls, setDownloadUrls] = useState<any>(null);\r\n  const [showValidationModal, setShowValidationModal] = useState(false);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n  const [generandoConcepto, setGenerandoConcepto] = useState(false);\r\n\r\n  const [formData, setFormData] = useState({\r\n    fecha_valoracion: new Date().toISOString().split('T')[0],\r\n    // Empresa\r\n    empresa: '',\r\n    tipo_documento_empresa: 'NIT',\r\n    nit: '',\r\n    persona_contacto: '',\r\n    email_notificaciones: '',\r\n    direccion_empresa: '',\r\n    arl: '', // Nuevo campo\r\n    ciudad_empresa: '', // Nuevo campo\r\n    // Trabajador\r\n    nombre_trabajador: '',\r\n    identificacion_trabajador: '',\r\n    edad: '',\r\n    genero: '',\r\n    fecha_nacimiento: '',\r\n    escolaridad: '',\r\n    nivel_educativo: '', // Nuevo campo\r\n    eps: '',\r\n    puesto_trabajo_evaluado: '',\r\n    cargo: '', // Nuevo campo\r\n    area: '', // Nuevo campo\r\n    fecha_ingreso_puesto_evaluado: '',\r\n    fecha_ingreso_empresa: '',\r\n    antiguedad_empresa: '',\r\n    antiguedad_puesto_evaluado: '',\r\n    antiguedad_cargo: '', // Nuevo campo\r\n    diagnostico: '',\r\n    codigo_cie10: '',\r\n    fecha_siniestro: '',\r\n    // Evaluador\r\n    nombre_evaluador: 'William Fernando Romero Suarez',\r\n    identificacion_evaluador: '79.247.156',\r\n    formacion_evaluador: 'Psicólogo especialista en Seguridad y Salud en el Trabajo',\r\n    tarjeta_profesional: '140039',\r\n    licencia_sst: '13828',\r\n    // Secciones\r\n    metodologia: '',\r\n    participante_trabajador: '',\r\n    participante_jefe: '',\r\n    participante_cargo_jefe: '',\r\n    fuente_trabajador_fecha: '',\r\n    fuente_jefe_fecha: '',\r\n    fuente_par_fecha: '',\r\n    revision_documental: '',\r\n    descripcion_puesto: '',\r\n    condicion_actual: '',\r\n    nombre_puesto_ocupacional: '',\r\n    area_puesto: '',\r\n    antiguedad_cargo_ocupacional: '',\r\n    antiguedad_empresa_ocupacional: '',\r\n    nivel_educativo_requerido: '',\r\n    jornada_laboral: '',\r\n    horas_extras: '',\r\n    turnos: '',\r\n    descripcion_funciones: '',\r\n    // Factores de riesgo\r\n    factores_riesgo: {} as Record<string, { fr: string; exp: string; int: string; total: string; fuentes: string; observaciones: string }>,\r\n    // Resumen\r\n    resumen_factores: {} as Record<string, { nivel_trabajador: string; nivel_experto: string; factores_trabajador: string; factores_experto: string; observaciones: string }>,\r\n    // Concepto final\r\n    concepto_generado_ml: '',\r\n    conclusiones_finales: '',\r\n    recomendaciones: '',\r\n    firma_evaluador: '',\r\n    concordancia_items: '',\r\n    no_concordancia_items: '',\r\n  });\r\n\r\n  // Initialize factores_riesgo and resumen_factores\r\n  useState(() => {\r\n    const factoresInit: Record<string, any> = {};\r\n    Object.entries(factoresRiesgo).forEach(([, categoria]) => {\r\n      categoria.items.forEach(item => {\r\n        factoresInit[item.nombre] = {\r\n          fr: '', exp: '', int: '', total: '',\r\n          fuentes: 'Entrevista con funcionario y jefe inmediato',\r\n          observaciones: item.descripcion\r\n        };\r\n      });\r\n    });\r\n    setFormData(prev => ({ ...prev, factores_riesgo: factoresInit }));\r\n\r\n    const resumenInit: Record<string, any> = {};\r\n    Object.keys(factoresRiesgo).forEach(key => {\r\n      resumenInit[key] = { nivel_trabajador: '', nivel_experto: '', factores_trabajador: '', factores_experto: '', observaciones: '' };\r\n    });\r\n    setFormData(prev => ({ ...prev, resumen_factores: resumenInit }));\r\n  });\r\n\r\n  // Efecto para recalcular automáticamente concordancia\r\n  useEffect(() => {\r\n    const concordancias: string[] = [];\r\n    const noConcordancias: string[] = [];\r\n\r\n    Object.entries(formData.resumen_factores).forEach(([key, values]) => {\r\n      if (values.nivel_trabajador && values.nivel_experto) {\r\n        // Encontrar título legible\r\n        const categoria = Object.values(factoresRiesgo).find(c => c.titulo === factoresRiesgo[key]?.titulo);\r\n        const nombreTitulo = categoria ? categoria.titulo : key;\r\n\r\n        if (values.nivel_trabajador === values.nivel_experto) {\r\n          concordancias.push(nombreTitulo);\r\n        } else {\r\n          noConcordancias.push(nombreTitulo);\r\n        }\r\n      }\r\n    });\r\n\r\n    const txtConcordancia = concordancias.length > 0 ? concordancias.join(', ') : 'Ninguna';\r\n    const txtNoConcordancia = noConcordancias.length > 0 ? noConcordancias.join(', ') : 'Ninguna';\r\n\r\n    if (txtConcordancia !== formData.concordancia_items || txtNoConcordancia !== formData.no_concordancia_items) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        concordancia_items: txtConcordancia,\r\n        no_concordancia_items: txtNoConcordancia\r\n      }));\r\n    }\r\n  }, [formData.resumen_factores]);\r\n\r\n  const updateField = (field: string, value: any) => setFormData(prev => ({ ...prev, [field]: value }));\r\n\r\n  const updateFactorRiesgo = (itemNombre: string, field: string, value: string) => {\r\n    setFormData(prev => {\r\n      const currentFactor = prev.factores_riesgo[itemNombre] || { fr: '', exp: '', int: '', total: '', fuentes: '', observaciones: '' };\r\n      const updatedFactor = { ...currentFactor, [field]: value };\r\n      if (['fr', 'exp', 'int'].includes(field)) {\r\n        if (updatedFactor.fr !== '' && updatedFactor.exp !== '' && updatedFactor.int !== '') {\r\n          const fr = parseInt(updatedFactor.fr) || 0;\r\n          const exp = parseInt(updatedFactor.exp) || 0;\r\n          const intVal = parseInt(updatedFactor.int) || 0;\r\n          updatedFactor.total = (fr + exp + intVal).toString();\r\n        }\r\n      }\r\n      return { ...prev, factores_riesgo: { ...prev.factores_riesgo, [itemNombre]: updatedFactor } };\r\n    });\r\n  };\r\n\r\n  const updateResumenFactor = (dimension: string, field: string, value: string) => {\r\n    setFormData(prev => {\r\n      const currentResumen = prev.resumen_factores;\r\n      const updatedDimension = { ...(currentResumen[dimension] || {}), [field]: value };\r\n      const nextResumen = { ...currentResumen, [dimension]: updatedDimension as any };\r\n      return { ...prev, resumen_factores: nextResumen };\r\n    });\r\n  };\r\n\r\n  // ─── Load existing data ───────────────────────────────────────────\r\n  useEffect(() => {\r\n    if (id) {\r\n      setCargando(true);\r\n      const cargarPrueba = async () => {\r\n        try {\r\n          const data: any = await api.get(`/pruebas-trabajo/${id}`);\r\n          setPruebaId(id);\r\n\r\n          const mappedData: any = {\r\n            empresa: data.datos_empresa?.empresa || '',\r\n            tipo_documento_empresa: data.datos_empresa?.tipo_documento || 'NIT',\r\n            nit: data.datos_empresa?.nit || '',\r\n            persona_contacto: data.datos_empresa?.persona_contacto || '',\r\n            email_notificaciones: data.datos_empresa?.email_notificaciones || '',\r\n            direccion_empresa: data.datos_empresa?.direccion || '',\r\n            arl: data.datos_empresa?.arl || '', // Mapped\r\n            ciudad_empresa: data.datos_empresa?.ciudad || '', // Mapped\r\n\r\n            nombre_trabajador: data.trabajador?.nombre || '',\r\n            identificacion_trabajador: data.trabajador?.identificacion || '',\r\n            fecha_nacimiento: data.trabajador?.fecha_nacimiento ? data.trabajador.fecha_nacimiento.split('T')[0] : '',\r\n            edad: data.trabajador?.edad ? data.trabajador.edad.toString() : '',\r\n            genero: data.trabajador?.genero || '',\r\n            escolaridad: data.trabajador?.escolaridad || '',\r\n            nivel_educativo: data.trabajador?.nivel_educativo || '', // Mapped\r\n            eps: data.trabajador?.eps || '',\r\n            puesto_trabajo_evaluado: data.trabajador?.puesto_trabajo_evaluado || '',\r\n            cargo: data.trabajador?.cargo || '', // Mapped\r\n            area: data.trabajador?.area || '', // Mapped\r\n            fecha_ingreso_empresa: data.trabajador?.fecha_ingreso_empresa ? data.trabajador.fecha_ingreso_empresa.split('T')[0] : '',\r\n            fecha_ingreso_puesto_evaluado: data.trabajador?.fecha_ingreso_puesto_evaluado ? data.trabajador.fecha_ingreso_puesto_evaluado.split('T')[0] : '',\r\n            antiguedad_empresa: data.trabajador?.antiguedad_empresa || '',\r\n            antiguedad_puesto_evaluado: data.trabajador?.antiguedad_puesto_evaluado || '',\r\n            antiguedad_cargo: data.trabajador?.antiguedad_cargo || '', // Mapped\r\n            diagnostico: data.trabajador?.diagnostico || '',\r\n            codigo_cie10: data.trabajador?.codigo_cie10 || '',\r\n            fecha_siniestro: data.trabajador?.fecha_siniestro ? data.trabajador.fecha_siniestro.split('T')[0] : '',\r\n\r\n            nombre_evaluador: data.evaluador?.nombre || '',\r\n            identificacion_evaluador: data.evaluador?.identificacion || '',\r\n            formacion_evaluador: data.evaluador?.formacion || '',\r\n            tarjeta_profesional: data.evaluador?.tarjeta_profesional || '',\r\n            licencia_sst: data.evaluador?.licencia_sst || '',\r\n\r\n            fecha_valoracion: data.fecha_valoracion ? data.fecha_valoracion.split('T')[0] : new Date().toISOString().split('T')[0],\r\n            metodologia: data.secciones?.metodologia || '',\r\n            participante_trabajador: data.secciones?.participante_trabajador || '',\r\n            participante_jefe: data.secciones?.participante_jefe || '',\r\n            participante_cargo_jefe: data.secciones?.participante_cargo_jefe || '',\r\n            fuente_trabajador_fecha: data.secciones?.fuente_trabajador_fecha ? data.secciones.fuente_trabajador_fecha.split('T')[0] : '',\r\n            fuente_jefe_fecha: data.secciones?.fuente_jefe_fecha ? data.secciones.fuente_jefe_fecha.split('T')[0] : '',\r\n            fuente_par_fecha: data.secciones?.fuente_par_fecha ? data.secciones.fuente_par_fecha.split('T')[0] : '',\r\n            revision_documental: data.secciones?.revision_documental || '',\r\n            descripcion_puesto: data.secciones?.descripcion_puesto || '',\r\n            condicion_actual: data.secciones?.condicion_actual || '',\r\n            nombre_puesto_ocupacional: data.secciones?.nombre_puesto || '',\r\n            area_puesto: data.secciones?.area_puesto || '',\r\n            antiguedad_cargo_ocupacional: data.secciones?.antiguedad_cargo_ocupacional || '',\r\n            antiguedad_empresa_ocupacional: data.secciones?.antiguedad_empresa_ocupacional || '',\r\n            nivel_educativo_requerido: data.secciones?.nivel_educativo_requerido || '',\r\n            jornada_laboral: data.secciones?.jornada_laboral || '',\r\n            horas_extras: data.secciones?.horas_extras || '',\r\n            turnos: data.secciones?.turnos || '',\r\n            descripcion_funciones: data.secciones?.descripcion_funciones || '',\r\n\r\n            concepto_generado_ml: data.concepto_final?.concepto_generado_ml || '',\r\n            conclusiones_finales: data.concepto_final?.conclusiones_finales || '',\r\n            recomendaciones: data.concepto_final?.recomendaciones || '',\r\n            concordancia_items: data.concepto_final?.concordancia_items || '',\r\n            no_concordancia_items: data.concepto_final?.no_concordancia_items || '',\r\n            firma_evaluador: data.concepto_final?.firma_evaluador || '',\r\n          };\r\n\r\n          // Map condiciones de riesgo\r\n          const factoresMapa: any = {};\r\n          Object.entries(factoresRiesgo).forEach(([, categoria]) => {\r\n            categoria.items.forEach(item => {\r\n              factoresMapa[item.nombre] = {\r\n                fr: '', exp: '', int: '', total: '',\r\n                fuentes: 'Entrevista con funcionario y jefe inmediato',\r\n                observaciones: item.descripcion\r\n              };\r\n            });\r\n          });\r\n          if (data.condiciones_riesgo) {\r\n            data.condiciones_riesgo.forEach((cond: any) => {\r\n              if (factoresMapa[cond.condicion_texto]) {\r\n                factoresMapa[cond.condicion_texto] = {\r\n                  fr: cond.frecuencia?.toString() || '',\r\n                  exp: cond.exposicion?.toString() || '',\r\n                  int: cond.intensidad?.toString() || '',\r\n                  total: cond.total_condicion?.toString() || '',\r\n                  fuentes: cond.fuentes_informacion || '',\r\n                  observaciones: cond.descripcion_detallada || cond.observaciones || factoresMapa[cond.condicion_texto].observaciones\r\n                };\r\n              }\r\n            });\r\n          }\r\n          mappedData.factores_riesgo = factoresMapa;\r\n\r\n          // Map resumen factores\r\n          const resumenMapa: any = {};\r\n          Object.keys(factoresRiesgo).forEach(key => {\r\n            resumenMapa[key] = { nivel_trabajador: '', nivel_experto: '', factores_trabajador: '', factores_experto: '', observaciones: '' };\r\n          });\r\n          if (data.resumen_factores) {\r\n            data.resumen_factores.forEach((res: any) => {\r\n              if (resumenMapa[res.dimension]) {\r\n                resumenMapa[res.dimension] = {\r\n                  nivel_trabajador: res.nivel_riesgo_trabajador || '',\r\n                  nivel_experto: res.nivel_riesgo_experto || '',\r\n                  factores_trabajador: res.factores_detectados_trabajador || '',\r\n                  factores_experto: res.factores_detectados_experto || '',\r\n                  observaciones: res.observaciones_experto || ''\r\n                };\r\n              }\r\n            });\r\n          }\r\n          mappedData.resumen_factores = resumenMapa;\r\n\r\n          setFormData(prev => ({ ...prev, ...mappedData }));\r\n        } catch (error) {\r\n          console.error(\"Error cargando prueba:\", error);\r\n          toast.error(\"No se pudo cargar la información de la prueba\");\r\n        } finally {\r\n          setCargando(false);\r\n        }\r\n      };\r\n      cargarPrueba();\r\n    }\r\n  }, [id]);\r\n\r\n  // ─── Generate AI Concept ──────────────────────────────────────────\r\n  const handleGenerarConcepto = async () => {\r\n    if (generandoConcepto) return;\r\n    if (!formData.nombre_trabajador) { toast.error('Debe ingresar el nombre del trabajador primero'); return; }\r\n    setGenerandoConcepto(true);\r\n    try {\r\n      let requestPayload: any = {};\r\n      if (pruebaId) {\r\n        requestPayload = { prueba_id: pruebaId };\r\n      } else {\r\n        const condicionesRiesgo: any[] = [];\r\n        Object.entries(factoresRiesgo).forEach(([key, categoria]) => {\r\n          categoria.items.forEach((item, index) => {\r\n            const values = formData.factores_riesgo[item.nombre];\r\n            if (values && (values.fr || values.exp || values.int)) {\r\n              condicionesRiesgo.push({\r\n                dimension: key, item_numero: index + 1, item_texto: item.nombre, condicion_texto: item.nombre,\r\n                frecuencia: values.fr ? parseInt(values.fr) : null, exposicion: values.exp ? parseInt(values.exp) : null,\r\n                intensidad: values.int ? parseInt(values.int) : null, total_condicion: values.total ? parseInt(values.total) : null,\r\n                fuentes_informacion: values.fuentes, descripcion_detallada: values.observaciones || ''\r\n              });\r\n            }\r\n          });\r\n        });\r\n        if (condicionesRiesgo.length === 0) {\r\n          toast.warning('Por favor diligencie al menos un factor de riesgo para generar conclusiones.');\r\n          setGenerandoConcepto(false);\r\n          return;\r\n        }\r\n        requestPayload = { nombre_trabajador: formData.nombre_trabajador, condiciones_riesgo: condicionesRiesgo };\r\n      }\r\n      const response = await api.post<{ analisis: string; recomendaciones: string }>('/pruebas-trabajo/generar-concepto-ia', requestPayload);\r\n      if (response && response.analisis) {\r\n        setFormData(prev => ({ ...prev, conclusiones_finales: response.analisis, recomendaciones: response.recomendaciones }));\r\n        toast.success('Concepto generado exitosamente con IA');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error generando concepto:', error);\r\n      const errorMsg = error.response?.data?.detail || 'Error al generar concepto';\r\n      toast.error(errorMsg);\r\n    } finally {\r\n      setGenerandoConcepto(false);\r\n    }\r\n  };\r\n\r\n  // ─── Save ─────────────────────────────────────────────────────────\r\n  const handleSave = async (finalizar = false) => {\r\n    if (finalizar && (!formData.empresa || !formData.nombre_trabajador || !formData.identificacion_evaluador)) {\r\n      toast.error('Por favor complete los campos obligatorios');\r\n      return;\r\n    }\r\n    setSaving(true);\r\n    try {\r\n      const condicionesRiesgo: any[] = [];\r\n      Object.entries(factoresRiesgo).forEach(([key, categoria]) => {\r\n        categoria.items.forEach((item, index) => {\r\n          const values = formData.factores_riesgo[item.nombre];\r\n          if (values && (values.fr || values.exp || values.int)) {\r\n            condicionesRiesgo.push({\r\n              dimension: key, item_numero: index + 1, condicion_texto: item.nombre,\r\n              descripcion_detallada: values.observaciones || null,\r\n              frecuencia: values.fr ? parseInt(values.fr) : null,\r\n              exposicion: values.exp ? parseInt(values.exp) : null,\r\n              intensidad: values.int ? parseInt(values.int) : null,\r\n              total_condicion: values.total ? parseInt(values.total) : null,\r\n              fuentes_informacion: values.fuentes\r\n            });\r\n          }\r\n        });\r\n      });\r\n\r\n      const resumenFactoresPayload: any[] = [];\r\n      Object.entries(formData.resumen_factores).forEach(([dimension, values]) => {\r\n        if (values.nivel_trabajador || values.nivel_experto || values.factores_experto) {\r\n          const dimItems = factoresRiesgo[dimension as keyof typeof factoresRiesgo]?.items || [];\r\n          const totalPuntaje = dimItems.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0);\r\n          resumenFactoresPayload.push({\r\n            dimension, num_items: dimItems.length, puntuacion_total: totalPuntaje || null,\r\n            nivel_riesgo_trabajador: values.nivel_trabajador || null,\r\n            nivel_riesgo_experto: values.nivel_experto || null,\r\n            factores_detectados_trabajador: values.factores_trabajador || null,\r\n            factores_detectados_experto: values.factores_experto || null,\r\n            observaciones_experto: values.observaciones || null\r\n          });\r\n        }\r\n      });\r\n\r\n\r\n\r\n      // Calcular concordancia explícitamente antes de guardar\r\n      const concordanciasCalc: string[] = [];\r\n      const noConcordanciasCalc: string[] = [];\r\n\r\n      const nivelToValue: Record<string, string> = {\r\n        'SIN RIESGO': 'sin_riesgo',\r\n        'RIESGO BAJO': 'riesgo_bajo',\r\n        'RIESGO MEDIO': 'riesgo_medio',\r\n        'RIESGO ALTO': 'riesgo_alto',\r\n        'RIESGO MUY ALTO': 'riesgo_muy_alto',\r\n      };\r\n\r\n      Object.entries(factoresRiesgo).forEach(([key, config]) => {\r\n        // 1. Calcular nivel riesgo trabajador (igual que en el render)\r\n        const total = config.items.reduce((acc, item) =>\r\n          acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0\r\n        );\r\n        const { nivel: nivelCalculado } = getNivelRiesgo(key, total);\r\n        const nivelTrabajadorValue = nivelToValue[nivelCalculado];\r\n\r\n        // 2. Obtener nivel experto del form state\r\n        const nivelExpertoValue = formData.resumen_factores[key]?.nivel_experto;\r\n\r\n        // 3. Comparar si ambos existen\r\n        if (nivelTrabajadorValue && nivelExpertoValue) {\r\n          const titulo = config.titulo;\r\n          if (nivelTrabajadorValue === nivelExpertoValue) {\r\n            concordanciasCalc.push(titulo);\r\n          } else {\r\n            noConcordanciasCalc.push(titulo);\r\n          }\r\n        }\r\n      });\r\n\r\n      const txtConcordanciaFinal = concordanciasCalc.length > 0 ? concordanciasCalc.join(', ') : 'Ninguna';\r\n      const txtNoConcordanciaFinal = noConcordanciasCalc.length > 0 ? noConcordanciasCalc.join(', ') : 'Ninguna';\r\n\r\n      const payload = {\r\n        fecha_valoracion: formData.fecha_valoracion || null,\r\n        estado: finalizar ? 'completada' : 'borrador',\r\n        datos_empresa: {\r\n          empresa: formData.empresa, tipo_documento: formData.tipo_documento_empresa, nit: formData.nit,\r\n          persona_contacto: formData.persona_contacto, email_notificaciones: formData.email_notificaciones,\r\n          direccion: formData.direccion_empresa, arl: formData.arl, ciudad: formData.ciudad_empresa\r\n        },\r\n        trabajador: {\r\n          nombre: formData.nombre_trabajador, identificacion: formData.identificacion_trabajador,\r\n          fecha_nacimiento: formData.fecha_nacimiento || null, edad: formData.edad ? parseInt(formData.edad) : null,\r\n          genero: formData.genero, escolaridad: formData.escolaridad, eps: formData.eps,\r\n          puesto_trabajo_evaluado: formData.puesto_trabajo_evaluado,\r\n          cargo: formData.cargo, area: formData.area, nivel_educativo: formData.nivel_educativo,\r\n          fecha_ingreso_empresa: formData.fecha_ingreso_empresa || null,\r\n          fecha_ingreso_puesto_evaluado: formData.fecha_ingreso_puesto_evaluado || null,\r\n          antiguedad_empresa: formData.antiguedad_empresa, antiguedad_puesto_evaluado: formData.antiguedad_puesto_evaluado,\r\n          antiguedad_cargo: formData.antiguedad_cargo,\r\n          diagnostico: formData.diagnostico, codigo_cie10: formData.codigo_cie10,\r\n          fecha_siniestro: formData.fecha_siniestro || null\r\n        },\r\n        evaluador: {\r\n          nombre: formData.nombre_evaluador, identificacion: formData.identificacion_evaluador,\r\n          formacion: formData.formacion_evaluador, tarjeta_profesional: formData.tarjeta_profesional,\r\n          licencia_sst: formData.licencia_sst, fecha_evaluacion: formData.fecha_valoracion || null\r\n        },\r\n        secciones: {\r\n          metodologia: formData.metodologia, participante_trabajador: formData.participante_trabajador,\r\n          participante_jefe: formData.participante_jefe, participante_cargo_jefe: formData.participante_cargo_jefe,\r\n          fuente_trabajador_fecha: formData.fuente_trabajador_fecha || null,\r\n          fuente_jefe_fecha: formData.fuente_jefe_fecha || null,\r\n          fuente_par_fecha: formData.fuente_par_fecha || null,\r\n          revision_documental: formData.revision_documental,\r\n          descripcion_puesto: formData.descripcion_puesto, condicion_actual: formData.condicion_actual,\r\n          nombre_puesto: formData.nombre_puesto_ocupacional, area_puesto: formData.area_puesto,\r\n          antiguedad_cargo_ocupacional: formData.antiguedad_cargo_ocupacional,\r\n          antiguedad_empresa_ocupacional: formData.antiguedad_empresa_ocupacional,\r\n          nivel_educativo_requerido: formData.nivel_educativo_requerido,\r\n          jornada_laboral: formData.jornada_laboral, horas_extras: formData.horas_extras,\r\n          turnos: formData.turnos, descripcion_funciones: formData.descripcion_funciones\r\n        },\r\n        condiciones_riesgo: condicionesRiesgo,\r\n        resumen_factores: resumenFactoresPayload,\r\n        concepto_final: {\r\n          concepto_generado_ml: formData.concepto_generado_ml, conclusiones_finales: formData.conclusiones_finales,\r\n          recomendaciones: formData.recomendaciones, concordancia_items: txtConcordanciaFinal,\r\n          no_concordancia_items: txtNoConcordanciaFinal, firma_evaluador: formData.firma_evaluador\r\n        }\r\n      };\r\n\r\n      if (finalizar) {\r\n        let saveId = pruebaId;\r\n        if (!saveId) {\r\n          const res: any = await api.post('/pruebas-trabajo/', payload);\r\n          saveId = res.id;\r\n          setPruebaId(res.id);\r\n        } else {\r\n          await api.put(`/pruebas-trabajo/${pruebaId}`, payload);\r\n        }\r\n\r\n        const finalRes: any = await api.post(`/pruebas-trabajo/${saveId}/finalizar`, {});\r\n        setDownloadUrls({ pdf_url: finalRes.pdf_url });\r\n        setShowDownloadModal(true);\r\n        toast.success('Prueba finalizada exitosamente');\r\n      } else {\r\n        if (pruebaId) {\r\n          await api.put(`/pruebas-trabajo/${pruebaId}`, payload);\r\n          toast.success('Guardado correctamente');\r\n        } else {\r\n          const res: any = await api.post('/pruebas-trabajo/', payload);\r\n          setPruebaId(res.id);\r\n          toast.success('Prueba creada exitosamente');\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      console.error(error);\r\n      toast.error('Error al guardar: ' + error.message);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // ─── Validation ───────────────────────────────────────────────────\r\n  const validateStep = (stepId: number): { isValid: boolean; errors: string[] } => {\r\n    if (readOnly) return { isValid: true, errors: [] };\r\n    const errors: string[] = [];\r\n    switch (stepId) {\r\n      case 1:\r\n        if (!formData.empresa) errors.push('Nombre de la Empresa');\r\n        if (!formData.nit) errors.push('NIT');\r\n        if (!formData.nombre_trabajador) errors.push('Nombre del Trabajador');\r\n        if (!formData.identificacion_trabajador) errors.push('Identificación del Trabajador');\r\n        if (!formData.nombre_evaluador) errors.push('Nombre del Evaluador');\r\n        if (!formData.identificacion_evaluador) errors.push('Identificación del Evaluador');\r\n        break;\r\n      case 2:\r\n        if (!formData.participante_trabajador) errors.push('Nombre del Participante (Trabajador)');\r\n        if (!formData.participante_jefe) errors.push('Nombre del Participante (Jefe)');\r\n        break;\r\n    }\r\n    return { isValid: errors.length === 0, errors };\r\n  };\r\n\r\n  const attemptNavigation = (targetStep: number) => {\r\n    if (targetStep < currentStep) { setCurrentStep(targetStep); return; }\r\n    const validation = validateStep(currentStep);\r\n    if (validation.isValid) setCurrentStep(targetStep);\r\n    else { setValidationErrors(validation.errors); setShowValidationModal(true); }\r\n  };\r\n\r\n  const nextStep = () => attemptNavigation(currentStep + 1);\r\n  const prevStep = () => attemptNavigation(currentStep - 1);\r\n\r\n  // ─── Helper: Section Header ───────────────────────────────────────\r\n  const SectionHeader = ({ children, icon: Icon }: { children: React.ReactNode; icon?: React.ComponentType<{ className?: string }> }) => (\r\n    <div className=\"bg-gradient-to-r from-orange-500 to-orange-600 text-white p-3 font-bold text-sm uppercase tracking-wide rounded-lg shadow-md flex items-center gap-2 mb-4\">\r\n      {Icon && <Icon className=\"h-5 w-5\" />}\r\n      <span>{children}</span>\r\n    </div>\r\n  );\r\n\r\n  // ─── Loading ──────────────────────────────────────────────────────\r\n  if (cargando) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"flex justify-center items-center h-screen\">\r\n          <Loader2 className=\"animate-spin h-10 w-10 text-orange-500\" />\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  // ─── Render ───────────────────────────────────────────────────────\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"max-w-7xl mx-auto space-y-6 pb-20\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold tracking-tight\">\r\n              {mode === 'create' ? 'Nueva Prueba de Trabajo' : mode === 'edit' ? 'Editar Prueba' : 'Detalle de Prueba'}\r\n            </h1>\r\n            <p className=\"text-muted-foreground\">\r\n              {mode === 'view' ? 'Visualización de la evaluación' : 'Complete el formulario de evaluación paso a paso'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Step Navigation */}\r\n        <div className=\"flex items-center justify-center py-4 mb-4\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {steps.map((step, index) => {\r\n              const StepIcon = step.icon;\r\n              const isCompleted = step.id < currentStep;\r\n              const isCurrent = step.id === currentStep;\r\n              const isPending = step.id > currentStep;\r\n\r\n              return (\r\n                <div key={step.id} className=\"flex items-center\">\r\n                  {/* Step Box */}\r\n                  <div\r\n                    onClick={() => setCurrentStep(step.id)}\r\n                    className={cn(\r\n                      \"flex flex-col items-center cursor-pointer group w-20\"\r\n                    )}\r\n                  >\r\n                    <div className={cn(\r\n                      \"w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200\",\r\n                      isCompleted && \"bg-green-500 text-white\",\r\n                      isCurrent && \"bg-orange-500 text-white shadow-sm\",\r\n                      isPending && \"bg-gray-100 dark:bg-gray-800 text-gray-400 group-hover:bg-gray-200 dark:group-hover:bg-gray-700\"\r\n                    )}>\r\n                      {isCompleted ? (\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                        </svg>\r\n                      ) : (\r\n                        <StepIcon className=\"w-5 h-5\" />\r\n                      )}\r\n                    </div>\r\n                    <span className={cn(\r\n                      \"mt-2 text-[11px] font-medium text-center leading-tight\",\r\n                      isCurrent && \"text-orange-600 dark:text-orange-400 font-semibold\",\r\n                      isCompleted && \"text-green-600 dark:text-green-400\",\r\n                      isPending && \"text-gray-400\"\r\n                    )}>\r\n                      {step.title}\r\n                    </span>\r\n                  </div>\r\n                  {/* Connector line */}\r\n                  {index < steps.length - 1 && (\r\n                    <div className={cn(\r\n                      \"w-8 h-0.5\",\r\n                      step.id < currentStep ? \"bg-green-400\" : \"bg-gray-200 dark:bg-gray-700\"\r\n                    )} />\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Card Content */}\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {/* PASO 1: IDENTIFICACIÓN                                     */}\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {currentStep === 1 && (\r\n              <div className=\"space-y-6\">\r\n                {/* Empresa Section */}\r\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-xl p-5 border border-gray-100 dark:border-gray-800\">\r\n                  <SectionHeader icon={Briefcase}>DATOS DE IDENTIFICACIÓN DE LA EMPRESA</SectionHeader>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Empresa <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.empresa} onChange={e => updateField('empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Tipo de Documento</Label>\r\n                      <Input disabled={readOnly} value={formData.tipo_documento_empresa} onChange={e => updateField('tipo_documento_empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">NIT <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.nit} onChange={e => updateField('nit', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Persona de Contacto</Label>\r\n                      <Input disabled={readOnly} value={formData.persona_contacto} onChange={e => updateField('persona_contacto', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">E-mail para Notificaciones</Label>\r\n                      <Input disabled={readOnly} type=\"email\" value={formData.email_notificaciones} onChange={e => updateField('email_notificaciones', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Dirección</Label>\r\n                      <Input disabled={readOnly} value={formData.direccion_empresa} onChange={e => updateField('direccion_empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">ARL</Label>\r\n                      <Input disabled={readOnly} value={formData.arl} onChange={e => updateField('arl', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Ciudad</Label>\r\n                      <Input disabled={readOnly} value={formData.ciudad_empresa} onChange={e => updateField('ciudad_empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Trabajador Section */}\r\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-xl p-5 border border-gray-100 dark:border-gray-800\">\r\n                  <SectionHeader icon={User}>DATOS DEL TRABAJADOR</SectionHeader>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Nombre <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.nombre_trabajador} onChange={e => updateField('nombre_trabajador', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Identificación <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.identificacion_trabajador} onChange={e => updateField('identificacion_trabajador', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Edad</Label>\r\n                      <Input disabled={readOnly} type=\"number\" value={formData.edad} onChange={e => updateField('edad', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Género</Label>\r\n                      <select disabled={readOnly} className=\"w-full border rounded-md p-2.5 text-sm bg-white dark:bg-gray-800 dark:border-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500\" value={formData.genero} onChange={e => updateField('genero', e.target.value)}>\r\n                        <option value=\"\">Seleccione...</option>\r\n                        <option value=\"Masculino\">Masculino</option>\r\n                        <option value=\"Femenino\">Femenino</option>\r\n                        <option value=\"Otro\">Otro</option>\r\n                      </select>\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Fecha de Nacimiento</Label>\r\n                      <Input disabled={readOnly} type=\"date\" value={formData.fecha_nacimiento} onChange={e => updateField('fecha_nacimiento', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Escolaridad</Label>\r\n                      <Input disabled={readOnly} value={formData.escolaridad} onChange={e => updateField('escolaridad', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Nivel Educativo</Label>\r\n                      <Input disabled={readOnly} value={formData.nivel_educativo} onChange={e => updateField('nivel_educativo', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">EPS</Label>\r\n                      <Input disabled={readOnly} value={formData.eps} onChange={e => updateField('eps', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Puesto de Trabajo Evaluado</Label>\r\n                      <Input disabled={readOnly} value={formData.puesto_trabajo_evaluado} onChange={e => updateField('puesto_trabajo_evaluado', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Cargo</Label>\r\n                      <Input disabled={readOnly} value={formData.cargo} onChange={e => updateField('cargo', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Área</Label>\r\n                      <Input disabled={readOnly} value={formData.area} onChange={e => updateField('area', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Fecha Ingreso a Puesto</Label>\r\n                      <Input disabled={readOnly} type=\"date\" value={formData.fecha_ingreso_puesto_evaluado} onChange={e => updateField('fecha_ingreso_puesto_evaluado', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Fecha Ingreso a Empresa</Label>\r\n                      <Input disabled={readOnly} type=\"date\" value={formData.fecha_ingreso_empresa} onChange={e => updateField('fecha_ingreso_empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Antigüedad en la Empresa</Label>\r\n                      <Input disabled={readOnly} value={formData.antiguedad_empresa} onChange={e => updateField('antiguedad_empresa', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Antigüedad en Puesto</Label>\r\n                      <Input disabled={readOnly} value={formData.antiguedad_puesto_evaluado} onChange={e => updateField('antiguedad_puesto_evaluado', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Diagnóstico</Label>\r\n                      <Input disabled={readOnly} value={formData.diagnostico} onChange={e => updateField('diagnostico', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Código CIE 10</Label>\r\n                      <Input disabled={readOnly} value={formData.codigo_cie10} onChange={e => updateField('codigo_cie10', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Fecha de Siniestro</Label>\r\n                      <Input disabled={readOnly} type=\"date\" value={formData.fecha_siniestro} onChange={e => updateField('fecha_siniestro', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Evaluador Section */}\r\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-xl p-5 border border-gray-100 dark:border-gray-800\">\r\n                  <SectionHeader icon={FileText}>DATOS DEL EVALUADOR</SectionHeader>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Nombre <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.nombre_evaluador} onChange={e => updateField('nombre_evaluador', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Identificación <span className=\"text-red-500\">*</span></Label>\r\n                      <Input disabled={readOnly} value={formData.identificacion_evaluador} onChange={e => updateField('identificacion_evaluador', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">Formación</Label>\r\n                      <Input disabled={readOnly} value={formData.formacion_evaluador} onChange={e => updateField('formacion_evaluador', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">N° Tarjeta Profesional</Label>\r\n                      <Input disabled={readOnly} value={formData.tarjeta_profesional} onChange={e => updateField('tarjeta_profesional', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-sm font-medium\">N° Licencia en SST</Label>\r\n                      <Input disabled={readOnly} value={formData.licencia_sst} onChange={e => updateField('licencia_sst', e.target.value)} className=\"bg-white dark:bg-gray-800\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {/* PASO 2: CONTEXTO Y PARTICIPANTES                           */}\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {currentStep === 2 && (\r\n              <div className=\"space-y-4\">\r\n                <SectionHeader>METODOLOGÍA</SectionHeader>\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[120px]\"\r\n                  value={formData.metodologia}\r\n                  onChange={e => updateField('metodologia', e.target.value)}\r\n                  placeholder=\"El siguiente instrumento establecido para la realización de Pruebas de Trabajo de Esfera Mental basa su estructura en el apartado del Dominio Demandas del Trabajo de la Batería de instrumentos para la evaluación de factores de riesgo psicosocial del ministerio de protección social...\"\r\n                />\r\n\r\n                <SectionHeader>PARTICIPANTES</SectionHeader>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  <div><Label>Trabajador(a) <span className=\"text-red-500\">*</span></Label><Input disabled={readOnly} value={formData.participante_trabajador} onChange={e => updateField('participante_trabajador', e.target.value)} /></div>\r\n                  <div><Label>Jefe Inmediato <span className=\"text-red-500\">*</span></Label><Input disabled={readOnly} value={formData.participante_jefe} onChange={e => updateField('participante_jefe', e.target.value)} /></div>\r\n                  <div><Label>Cargo Jefe</Label><Input disabled={readOnly} value={formData.participante_cargo_jefe} onChange={e => updateField('participante_cargo_jefe', e.target.value)} /></div>\r\n                </div>\r\n\r\n                <SectionHeader>FUENTES DE RECOLECCIÓN DE LA INFORMACIÓN</SectionHeader>\r\n                <p className=\"text-sm text-gray-600 mb-2\">Se llevaron a cabo las siguientes entrevistas</p>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm border-collapse border border-gray-300\">\r\n                    <thead>\r\n                      <tr className=\"bg-gray-100\">\r\n                        <th className=\"border border-gray-300 p-2 text-center font-bold\">Trabajador</th>\r\n                        <th className=\"border border-gray-300 p-2 text-center font-bold\">Jefe</th>\r\n                        <th className=\"border border-gray-300 p-2 text-center font-bold\">Par</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      <tr>\r\n                        <td className=\"border border-gray-300 p-2 text-center font-medium\">Fecha</td>\r\n                        <td className=\"border border-gray-300 p-2 text-center font-medium\">Fecha</td>\r\n                        <td className=\"border border-gray-300 p-2 text-center font-medium\">Fecha</td>\r\n                      </tr>\r\n                      <tr>\r\n                        <td className=\"border border-gray-300 p-2\"><Input disabled={readOnly} type=\"date\" value={formData.fuente_trabajador_fecha} onChange={e => updateField('fuente_trabajador_fecha', e.target.value)} /></td>\r\n                        <td className=\"border border-gray-300 p-2\"><Input disabled={readOnly} type=\"date\" value={formData.fuente_jefe_fecha} onChange={e => updateField('fuente_jefe_fecha', e.target.value)} /></td>\r\n                        <td className=\"border border-gray-300 p-2\"><Input disabled={readOnly} type=\"date\" value={formData.fuente_par_fecha} onChange={e => updateField('fuente_par_fecha', e.target.value)} /></td>\r\n                      </tr>\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                <SectionHeader>REVISIÓN DOCUMENTAL</SectionHeader>\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[80px]\"\r\n                  value={formData.revision_documental}\r\n                  onChange={e => updateField('revision_documental', e.target.value)}\r\n                  placeholder=\"Se verifica documentación clínica...\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {/* PASO 3: DESCRIPCIÓN DEL CARGO                              */}\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {currentStep === 3 && (\r\n              <div className=\"space-y-4\">\r\n                <SectionHeader>DESCRIPCIÓN DEL PUESTO DE TRABAJO</SectionHeader>\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[120px]\"\r\n                  value={formData.descripcion_puesto}\r\n                  onChange={e => updateField('descripcion_puesto', e.target.value)}\r\n                  placeholder=\"Describa el puesto de trabajo evaluado...\"\r\n                />\r\n\r\n                <SectionHeader>CONDICIÓN ACTUAL</SectionHeader>\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[100px]\"\r\n                  value={formData.condicion_actual}\r\n                  onChange={e => updateField('condicion_actual', e.target.value)}\r\n                  placeholder=\"Describa la condición actual del trabajador...\"\r\n                />\r\n\r\n                <SectionHeader>ASPECTOS OCUPACIONALES</SectionHeader>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  <div><Label>Nombre o Denominación del Puesto</Label><Input disabled={readOnly} value={formData.nombre_puesto_ocupacional} onChange={e => updateField('nombre_puesto_ocupacional', e.target.value)} /></div>\r\n                  <div><Label>Área a la que pertenece el puesto</Label><Input disabled={readOnly} value={formData.area_puesto} onChange={e => updateField('area_puesto', e.target.value)} /></div>\r\n\r\n                  <div><Label>Antigüedad en la Empresa</Label><Input disabled={readOnly} value={formData.antiguedad_empresa_ocupacional} onChange={e => updateField('antiguedad_empresa_ocupacional', e.target.value)} /></div>\r\n                  <div><Label>Nivel Educativo Requerido para el Cargo</Label><Input disabled={readOnly} value={formData.nivel_educativo_requerido} onChange={e => updateField('nivel_educativo_requerido', e.target.value)} /></div>\r\n                  <div><Label>Jornada Laboral</Label><Input disabled={readOnly} value={formData.jornada_laboral} onChange={e => updateField('jornada_laboral', e.target.value)} /></div>\r\n                  <div><Label>Horas Extras</Label><Input disabled={readOnly} value={formData.horas_extras} onChange={e => updateField('horas_extras', e.target.value)} /></div>\r\n                  <div><Label>Turnos</Label><Input disabled={readOnly} value={formData.turnos} onChange={e => updateField('turnos', e.target.value)} /></div>\r\n                </div>\r\n\r\n                <SectionHeader>DESCRIPCIÓN DE FUNCIONES</SectionHeader>\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[120px]\"\r\n                  value={formData.descripcion_funciones}\r\n                  onChange={e => updateField('descripcion_funciones', e.target.value)}\r\n                  placeholder=\"Describa las funciones del cargo...\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {/* PASO 4: FACTORES DE RIESGO                                 */}\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {currentStep === 4 && (\r\n              <div className=\"space-y-6\">\r\n                {/* Header */}\r\n                <div className=\"text-center space-y-3\">\r\n                  <h2 className=\"text-xl font-bold text-gray-800 dark:text-gray-200 flex items-center justify-center gap-2\">\r\n                    <AlertTriangle className=\"w-6 h-6 text-orange-500\" />\r\n                    Factores de Riesgo Psicosociales\r\n                  </h2>\r\n                  <span className=\"inline-flex items-center gap-2 px-5 py-2 bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 rounded-full text-base font-medium\">\r\n                    <Activity className=\"w-5 h-5\" /> Demandas de Trabajo\r\n                  </span>\r\n                </div>\r\n\r\n                {Object.entries(factoresRiesgo).map(([key, categoria]) => (\r\n                  <div key={key} className=\"bg-white dark:bg-[#1a1a1a] rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden\">\r\n                    {/* Category Header */}\r\n                    <div className=\"bg-orange-500 text-white px-5 py-4 font-bold text-base uppercase tracking-wide flex items-center gap-2\">\r\n                      <AlertTriangle className=\"w-5 h-5\" />\r\n                      {categoria.titulo}\r\n                    </div>\r\n\r\n                    {/* Table */}\r\n                    <div className=\"overflow-x-auto\">\r\n                      <table className=\"w-full\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50 dark:bg-gray-800/50 border-b-2 border-gray-200 dark:border-gray-700\">\r\n                            <th className=\"text-left px-4 py-3 font-bold text-sm text-gray-700 dark:text-gray-300 w-[180px]\">Condición</th>\r\n                            <th className=\"text-left px-4 py-3 font-bold text-sm text-gray-700 dark:text-gray-300 min-w-[250px]\">Descripción</th>\r\n                            <th className=\"text-center px-3 py-3 font-bold text-sm text-orange-600 dark:text-orange-400 w-[75px]\">FR</th>\r\n                            <th className=\"text-center px-3 py-3 font-bold text-sm text-orange-600 dark:text-orange-400 w-[75px]\">EXP</th>\r\n                            <th className=\"text-center px-3 py-3 font-bold text-sm text-orange-600 dark:text-orange-400 w-[75px]\">INT</th>\r\n                            <th className=\"text-center px-3 py-3 font-bold text-sm text-gray-800 dark:text-gray-200 w-[75px]\">Total</th>\r\n                            <th className=\"text-left px-4 py-3 font-bold text-sm text-gray-700 dark:text-gray-300 w-[160px]\">Fuentes</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {categoria.items.map((item, index) => (\r\n                            <tr\r\n                              key={item.numero}\r\n                              className={cn(\r\n                                \"border-b border-gray-100 dark:border-gray-800\",\r\n                                index % 2 === 1 && \"bg-gray-50/50 dark:bg-gray-900/20\"\r\n                              )}\r\n                            >\r\n                              <td className=\"px-4 py-3 align-top\">\r\n                                <div className=\"flex items-start gap-2\">\r\n                                  <span className=\"inline-flex items-center justify-center min-w-[22px] h-6 text-xs bg-orange-100 dark:bg-orange-900/50 text-orange-600 dark:text-orange-400 rounded font-bold\">\r\n                                    {item.numero}\r\n                                  </span>\r\n                                  <span className=\"text-sm font-medium text-gray-800 dark:text-gray-200 leading-snug\">\r\n                                    {item.nombre}\r\n                                  </span>\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-4 py-2\">\r\n                                <Textarea\r\n                                  disabled={readOnly}\r\n                                  className=\"min-h-[80px] text-sm resize-y bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 w-full\"\r\n                                  placeholder=\"Describa la condición...\"\r\n                                  value={formData.factores_riesgo[item.nombre]?.observaciones || ''}\r\n                                  onChange={e => updateFactorRiesgo(item.nombre, 'observaciones', e.target.value)}\r\n                                />\r\n                              </td>\r\n                              <td className=\"px-3 py-2 text-center align-middle\">\r\n                                <Input\r\n                                  disabled={readOnly}\r\n                                  type=\"number\"\r\n                                  className=\"h-11 w-14 text-center text-base font-bold bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 mx-auto\"\r\n                                  min={0} max={7}\r\n                                  value={formData.factores_riesgo[item.nombre]?.fr || ''}\r\n                                  onChange={e => updateFactorRiesgo(item.nombre, 'fr', e.target.value)}\r\n                                />\r\n                              </td>\r\n                              <td className=\"px-3 py-2 text-center align-middle\">\r\n                                <Input\r\n                                  disabled={readOnly}\r\n                                  type=\"number\"\r\n                                  className=\"h-11 w-14 text-center text-base font-bold bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 mx-auto\"\r\n                                  min={0} max={7}\r\n                                  value={formData.factores_riesgo[item.nombre]?.exp || ''}\r\n                                  onChange={e => updateFactorRiesgo(item.nombre, 'exp', e.target.value)}\r\n                                />\r\n                              </td>\r\n                              <td className=\"px-3 py-2 text-center align-middle\">\r\n                                <Input\r\n                                  disabled={readOnly}\r\n                                  type=\"number\"\r\n                                  className=\"h-11 w-14 text-center text-base font-bold bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 mx-auto\"\r\n                                  min={0} max={7}\r\n                                  value={formData.factores_riesgo[item.nombre]?.int || ''}\r\n                                  onChange={e => updateFactorRiesgo(item.nombre, 'int', e.target.value)}\r\n                                />\r\n                              </td>\r\n                              <td className=\"px-3 py-2 text-center align-middle\">\r\n                                <span className=\"inline-flex items-center justify-center w-12 h-11 rounded-lg bg-gray-100 dark:bg-gray-800 font-bold text-gray-800 dark:text-gray-200 text-base border border-gray-200 dark:border-gray-700\">\r\n                                  {formData.factores_riesgo[item.nombre]?.total || '-'}\r\n                                </span>\r\n                              </td>\r\n                              <td className=\"px-4 py-2 align-middle\">\r\n                                <Input\r\n                                  disabled={readOnly}\r\n                                  className=\"h-10 text-sm bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 w-full\"\r\n                                  placeholder=\"Entrevista...\"\r\n                                  value={formData.factores_riesgo[item.nombre]?.fuentes || ''}\r\n                                  onChange={e => updateFactorRiesgo(item.nombre, 'fuentes', e.target.value)}\r\n                                />\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Category Total */}\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800/50 px-5 py-4 flex items-center justify-end gap-4 border-t border-gray-200 dark:border-gray-700\">\r\n                      <span className=\"text-base font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2\">\r\n                        <Activity className=\"w-5 h-5 text-orange-500\" />\r\n                        Total {categoria.titulo}:\r\n                      </span>\r\n                      <span className=\"inline-flex items-center justify-center min-w-[56px] h-12 px-4 rounded-lg bg-white dark:bg-gray-900 font-bold text-xl text-orange-600 dark:text-orange-400 border-2 border-orange-200 dark:border-orange-800\">\r\n                        {categoria.items.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0)}\r\n                      </span>\r\n                      {(() => {\r\n                        const total = categoria.items.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0);\r\n                        const { nivel, color } = getNivelRiesgo(key, total);\r\n                        return (\r\n                          <span className={cn(\"px-4 py-2 rounded-lg font-bold text-sm uppercase\", color)}>\r\n                            {nivel}\r\n                          </span>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {/* PASO 5: RESUMEN Y CONCEPTO                                 */}\r\n            {/* ═══════════════════════════════════════════════════════════ */}\r\n            {currentStep === 5 && (\r\n              <div className=\"space-y-6\">\r\n                {/* Per-dimension editing table */}\r\n                <SectionHeader>FACTORES DE RIESGO PSICOSOCIAL</SectionHeader>\r\n                <div className=\"overflow-x-auto bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                  <table className=\"w-full min-w-[900px]\">\r\n                    <thead>\r\n                      <tr className=\"bg-gray-100 dark:bg-gray-800\">\r\n                        <th className=\"border-b border-r border-gray-200 dark:border-gray-700 p-3 text-left text-sm font-bold text-gray-700 dark:text-gray-300 w-[220px]\" rowSpan={2}>\r\n                          Factores de Riesgo Psicosocial\r\n                        </th>\r\n                        <th className=\"border-b border-r border-gray-200 dark:border-gray-700 p-3 text-center text-sm font-bold text-orange-600 dark:text-orange-400\" colSpan={2}>\r\n                          Valoración Subjetiva del Trabajador\r\n                        </th>\r\n                        <th className=\"border-b border-gray-200 dark:border-gray-700 p-3 text-center text-sm font-bold text-blue-600 dark:text-blue-400\" colSpan={2}>\r\n                          Valoración del Experto\r\n                        </th>\r\n                      </tr>\r\n                      <tr className=\"bg-gray-50 dark:bg-gray-800/50\">\r\n                        <th className=\"border-b border-r border-gray-200 dark:border-gray-700 p-2 text-center text-xs font-semibold text-gray-600 dark:text-gray-400 w-[140px]\">Nivel de Riesgo</th>\r\n                        <th className=\"border-b border-r border-gray-200 dark:border-gray-700 p-2 text-center text-xs font-semibold text-gray-600 dark:text-gray-400\">Factores Detectados</th>\r\n                        <th className=\"border-b border-r border-gray-200 dark:border-gray-700 p-2 text-center text-xs font-semibold text-gray-600 dark:text-gray-400 w-[140px]\">Nivel de Riesgo</th>\r\n                        <th className=\"border-b border-gray-200 dark:border-gray-700 p-2 text-center text-xs font-semibold text-gray-600 dark:text-gray-400\">Factores / Observaciones</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {Object.entries(factoresRiesgo).map(([key, categoria], index) => (\r\n                        <tr key={key} className={cn(\r\n                          \"border-b border-gray-100 dark:border-gray-800\",\r\n                          index % 2 === 1 && \"bg-gray-50/50 dark:bg-gray-900/30\"\r\n                        )}>\r\n                          <td className=\"border-r border-gray-200 dark:border-gray-700 p-3 font-medium text-sm text-gray-800 dark:text-gray-200\">\r\n                            {categoria.titulo}\r\n                          </td>\r\n                          {/* Worker risk level - Auto calculated from Step 4 */}\r\n                          <td className=\"border-r border-gray-200 dark:border-gray-700 p-3 text-center\">\r\n                            {(() => {\r\n                              const cat = factoresRiesgo[key];\r\n                              const total = cat.items.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0);\r\n                              const { nivel, color } = getNivelRiesgo(key, total);\r\n                              return (\r\n                                <span className={cn(\"inline-block px-3 py-1.5 rounded-md text-[10px] font-bold whitespace-nowrap\", color)}>\r\n                                  {nivel}\r\n                                </span>\r\n                              );\r\n                            })()}\r\n                          </td>\r\n                          {/* Worker factors */}\r\n                          <td className=\"border-r border-gray-200 dark:border-gray-700 p-2\">\r\n                            <Textarea\r\n                              disabled={readOnly}\r\n                              className=\"min-h-[60px] text-sm bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700\"\r\n                              placeholder=\"Factores detectados...\"\r\n                              value={formData.resumen_factores[key]?.factores_trabajador || ''}\r\n                              onChange={e => updateResumenFactor(key, 'factores_trabajador', e.target.value)}\r\n                            />\r\n                          </td>\r\n                          {/* Expert risk level */}\r\n                          <td className=\"border-r border-gray-200 dark:border-gray-700 p-3 text-center\">\r\n                            <select\r\n                              disabled={readOnly}\r\n                              className={cn(\r\n                                \"w-full border rounded-md p-2 text-xs font-semibold text-center\",\r\n                                getRiskColor(formData.resumen_factores[key]?.nivel_experto || '')\r\n                              )}\r\n                              value={formData.resumen_factores[key]?.nivel_experto || ''}\r\n                              onChange={e => updateResumenFactor(key, 'nivel_experto', e.target.value)}\r\n                            >\r\n                              <option value=\"\">Seleccione...</option>\r\n                              <option value=\"riesgo_muy_alto\">Muy Alto</option>\r\n                              <option value=\"riesgo_alto\">Alto</option>\r\n                              <option value=\"riesgo_medio\">Medio</option>\r\n                              <option value=\"riesgo_bajo\">Bajo</option>\r\n                              <option value=\"sin_riesgo\">Sin Riesgo</option>\r\n                            </select>\r\n                          </td>\r\n                          {/* Expert factors */}\r\n                          <td className=\"p-2\">\r\n                            <Textarea\r\n                              disabled={readOnly}\r\n                              className=\"min-h-[60px] text-sm bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700\"\r\n                              placeholder=\"Factores / Observaciones...\"\r\n                              value={formData.resumen_factores[key]?.factores_experto || ''}\r\n                              onChange={e => updateResumenFactor(key, 'factores_experto', e.target.value)}\r\n                            />\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                {/* Summary grouped by risk level (matching PDF) */}\r\n                <div className=\"border rounded-lg overflow-hidden\">\r\n                  <div className=\"bg-orange-100 border-b border-orange-200\">\r\n                    <div className=\"grid grid-cols-3 gap-0\">\r\n                      <div className=\"p-2 font-bold text-center text-sm border-r border-orange-200\">Factores de Riesgo Psicosocial</div>\r\n                      <div className=\"p-2 font-bold text-center text-xs border-r border-orange-200\">\r\n                        Factores de Riesgo Detectados por la Valoración Subjetiva del Trabajador\r\n                        <div className=\"font-normal text-[10px] mt-1\">De acuerdo a los resultados arrojados por el cuestionario intralaboral forma A se encontró:</div>\r\n                      </div>\r\n                      <div className=\"p-2 font-bold text-center text-xs\">\r\n                        Factores Detectados por la Valoración del Experto\r\n                        <div className=\"font-normal text-[10px] mt-1\">De acuerdo con el análisis psicosocial del puesto de trabajo se encontró:</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  {NIVELES_RIESGO.map(nivel => {\r\n                    // Calculate worker risk level from Step 4 totals\r\n                    const nivelToValue: Record<string, string> = {\r\n                      'SIN RIESGO': 'sin_riesgo',\r\n                      'RIESGO BAJO': 'riesgo_bajo',\r\n                      'RIESGO MEDIO': 'riesgo_medio',\r\n                      'RIESGO ALTO': 'riesgo_alto',\r\n                      'RIESGO MUY ALTO': 'riesgo_muy_alto',\r\n                    };\r\n\r\n                    const trabajadorDims = Object.entries(factoresRiesgo)\r\n                      .filter(([key, cat]) => {\r\n                        const total = cat.items.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0);\r\n                        const { nivel: nivelCalculado } = getNivelRiesgo(key, total);\r\n                        return nivelToValue[nivelCalculado] === nivel.value;\r\n                      })\r\n                      .map(([, cat]) => cat.titulo);\r\n\r\n                    const expertoDims = Object.entries(factoresRiesgo)\r\n                      .filter(([key]) => formData.resumen_factores[key]?.nivel_experto === nivel.value)\r\n                      .map(([, cat]) => cat.titulo);\r\n\r\n                    return (\r\n                      <div key={nivel.value} className=\"grid grid-cols-3 gap-0 border-b border-gray-200\">\r\n                        <div className=\"p-2 border-r border-gray-200 flex items-center justify-center\">\r\n                          <span className={`px-3 py-1 rounded text-xs font-bold ${nivel.color}`}>{nivel.label}</span>\r\n                        </div>\r\n                        <div className=\"p-2 border-r border-gray-200 text-xs\">\r\n                          {trabajadorDims.length > 0 ? trabajadorDims.join(', ') : <span className=\"text-gray-400\">ninguno</span>}\r\n                        </div>\r\n                        <div className=\"p-2 text-xs\">\r\n                          {expertoDims.length > 0 ? expertoDims.join(', ') : <span className=\"text-gray-400\">ninguno</span>}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                {/* Concordance - Auto calculated */}\r\n                <SectionHeader>CONCLUSIÓN DE LA EVALUACIÓN</SectionHeader>\r\n                {(() => {\r\n                  // Map getNivelRiesgo text to value format\r\n                  const nivelToValue: Record<string, string> = {\r\n                    'SIN RIESGO': 'sin_riesgo',\r\n                    'RIESGO BAJO': 'riesgo_bajo',\r\n                    'RIESGO MEDIO': 'riesgo_medio',\r\n                    'RIESGO ALTO': 'riesgo_alto',\r\n                    'RIESGO MUY ALTO': 'riesgo_muy_alto',\r\n                  };\r\n\r\n                  const concordancias: string[] = [];\r\n                  const noConcordancias: string[] = [];\r\n\r\n                  Object.entries(factoresRiesgo).forEach(([key, cat]) => {\r\n                    // Calculate worker level from Step 4 totals\r\n                    const total = cat.items.reduce((acc, item) => acc + (parseFloat(formData.factores_riesgo[item.nombre]?.total || '0') || 0), 0);\r\n                    const { nivel: nivelTrabajadorTexto } = getNivelRiesgo(key, total);\r\n                    const nivelTrabajador = nivelToValue[nivelTrabajadorTexto];\r\n\r\n                    // Get expert level from form\r\n                    const nivelExperto = formData.resumen_factores[key]?.nivel_experto;\r\n\r\n                    if (nivelExperto) {\r\n                      if (nivelTrabajador === nivelExperto) {\r\n                        concordancias.push(cat.titulo);\r\n                      } else {\r\n                        noConcordancias.push(cat.titulo);\r\n                      }\r\n                    }\r\n                  });\r\n\r\n                  return (\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <Label className=\"font-semibold\">Se encuentra concordancia entre la percepción del evaluado y la valoración del profesional para los ítems:</Label>\r\n                        <div className=\"mt-2 p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 min-h-[60px] text-sm\">\r\n                          {concordancias.length > 0 ? concordancias.join(', ') : <span className=\"text-gray-400\">Ninguna (complete la valoración del experto)</span>}\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"font-semibold\">No se encuentra concordancia entre la percepción del evaluado y la valoración del profesional para los ítems:</Label>\r\n                        <div className=\"mt-2 p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 min-h-[60px] text-sm\">\r\n                          {noConcordancias.length > 0 ? noConcordancias.join(', ') : <span className=\"text-gray-400\">Ninguna (complete la valoración del experto)</span>}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })()}\r\n\r\n                {/* Conclusions */}\r\n                <div className=\"flex justify-between items-center mt-8\">\r\n                  <SectionHeader>CONCLUSIONES FINALES DE LA PRUEBA DE TRABAJO DE ESFERA MENTAL</SectionHeader>\r\n                </div>\r\n                {!readOnly && (\r\n                  <div className=\"flex justify-end\">\r\n                    <Button onClick={handleGenerarConcepto} disabled={generandoConcepto} className=\"bg-purple-600 hover:bg-purple-700 text-white shadow-sm\" size=\"sm\">\r\n                      {generandoConcepto ? <><Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Generando...</> : <><Sparkles className=\"mr-2 h-4 w-4 text-yellow-300\" /> Generar con IA</>}\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <Textarea\r\n                  disabled={readOnly}\r\n                  className=\"min-h-[200px]\"\r\n                  value={formData.conclusiones_finales}\r\n                  onChange={e => updateField('conclusiones_finales', e.target.value)}\r\n                  placeholder=\"Realizada la Prueba de Trabajo de Esfera Mental, analizados todos los ítems propios del instrumento y contrastada la información con otras fuentes...\"\r\n                />\r\n\r\n                <div>\r\n                  <Label className=\"font-semibold\">Recomendaciones</Label>\r\n                  <Textarea\r\n                    disabled={readOnly}\r\n                    className=\"min-h-[120px] mt-1\"\r\n                    value={formData.recomendaciones}\r\n                    onChange={e => updateField('recomendaciones', e.target.value)}\r\n                    placeholder=\"Escriba las recomendaciones...\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Signature Section */}\r\n                <div className=\"border-t-2 border-gray-300 pt-6 mt-8\">\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 items-start\">\r\n                    <div>\r\n                      <Label className=\"font-semibold\">Psicólogo Especialista</Label>\r\n                      <Input disabled className=\"mt-1 bg-gray-50\" value={formData.nombre_evaluador} />\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"font-semibold\">Licencia SST</Label>\r\n                      <Input disabled className=\"mt-1 bg-gray-50\" value={formData.licencia_sst} />\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"font-semibold\">Firma del Evaluador</Label>\r\n                      <div className=\"mt-1 space-y-2\">\r\n                        {formData.firma_evaluador ? (\r\n                          <div className=\"relative border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-2 bg-white dark:bg-gray-800\">\r\n                            <img\r\n                              src={formData.firma_evaluador}\r\n                              alt=\"Firma del evaluador\"\r\n                              className=\"max-h-[80px] mx-auto object-contain\"\r\n                            />\r\n                            {!readOnly && (\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => updateField('firma_evaluador', '')}\r\n                                className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600\"\r\n                              >\r\n                                ×\r\n                              </button>\r\n                            )}\r\n                          </div>\r\n                        ) : (\r\n                          <label className={cn(\r\n                            \"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:border-orange-400 transition-colors\",\r\n                            readOnly && \"cursor-not-allowed opacity-60\"\r\n                          )}>\r\n                            <Upload className=\"w-6 h-6 text-gray-400 mb-1\" />\r\n                            <span className=\"text-xs text-gray-500\">Subir imagen de firma</span>\r\n                            <input\r\n                              type=\"file\"\r\n                              accept=\"image/*\"\r\n                              disabled={readOnly}\r\n                              className=\"hidden\"\r\n                              onChange={(e) => {\r\n                                const file = e.target.files?.[0];\r\n                                if (file) {\r\n                                  const reader = new FileReader();\r\n                                  reader.onloadend = () => {\r\n                                    // Process image to look like scanned signature\r\n                                    const img = new Image();\r\n                                    img.onload = () => {\r\n                                      const canvas = document.createElement('canvas');\r\n                                      canvas.width = img.width;\r\n                                      canvas.height = img.height;\r\n                                      const ctx = canvas.getContext('2d');\r\n                                      if (ctx) {\r\n                                        // Draw original image\r\n                                        ctx.drawImage(img, 0, 0);\r\n\r\n                                        // Get image data\r\n                                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                                        const data = imageData.data;\r\n\r\n                                        // Process pixels: increase contrast and make background transparent\r\n                                        for (let i = 0; i < data.length; i += 4) {\r\n                                          const r = data[i];\r\n                                          const g = data[i + 1];\r\n                                          const b = data[i + 2];\r\n\r\n                                          // Calculate brightness\r\n                                          const brightness = (r + g + b) / 3;\r\n\r\n                                          // If pixel is light (background), make it transparent\r\n                                          if (brightness > 200) {\r\n                                            data[i + 3] = 0; // Set alpha to 0\r\n                                          } else {\r\n                                            // Increase contrast for dark pixels (signature)\r\n                                            const factor = 1.5;\r\n                                            data[i] = Math.min(255, Math.max(0, (r - 128) * factor + 128));\r\n                                            data[i + 1] = Math.min(255, Math.max(0, (g - 128) * factor + 128));\r\n                                            data[i + 2] = Math.min(255, Math.max(0, (b - 128) * factor + 128));\r\n                                          }\r\n                                        }\r\n\r\n                                        ctx.putImageData(imageData, 0, 0);\r\n                                        updateField('firma_evaluador', canvas.toDataURL('image/png'));\r\n                                      }\r\n                                    };\r\n                                    img.src = reader.result as string;\r\n                                  };\r\n                                  reader.readAsDataURL(file);\r\n                                }\r\n                              }}\r\n                            />\r\n                          </label>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        {/* Navigation                                                 */}\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        <div className=\"flex justify-between items-center mt-6 pt-4 border-t border-gray-100 dark:border-gray-800\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            onClick={prevStep}\r\n            disabled={currentStep === 1}\r\n            className={cn(\r\n              \"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800\",\r\n              currentStep === 1 && 'invisible'\r\n            )}\r\n          >\r\n            <ChevronLeft className=\"mr-1 h-4 w-4\" /> Anterior\r\n          </Button>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            {!readOnly && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                onClick={() => handleSave(false)}\r\n                disabled={saving}\r\n                className=\"text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20\"\r\n              >\r\n                <Save className=\"mr-1 h-4 w-4\" /> Guardar\r\n              </Button>\r\n            )}\r\n            {currentStep < 5 ? (\r\n              <Button\r\n                onClick={nextStep}\r\n                className=\"bg-orange-500 hover:bg-orange-600 text-white px-6\"\r\n              >\r\n                Siguiente <ChevronRight className=\"ml-1 h-4 w-4\" />\r\n              </Button>\r\n            ) : (\r\n              !readOnly && (\r\n                <Button\r\n                  onClick={() => handleSave(true)}\r\n                  disabled={saving}\r\n                  className=\"bg-green-500 hover:bg-green-600 text-white px-6\"\r\n                >\r\n                  <Save className=\"mr-1 h-4 w-4\" /> Finalizar\r\n                </Button>\r\n              )\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        {/* Download Modal                                             */}\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        {showDownloadModal && (\r\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n            <Card className=\"w-full max-w-md p-6 bg-white dark:bg-gray-900 shadow-xl rounded-xl\">\r\n              <div className=\"text-center\">\r\n                <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <svg className=\"w-8 h-8 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                </div>\r\n                <h2 className=\"text-xl font-bold mb-2 text-gray-900 dark:text-gray-100\">Prueba Finalizada</h2>\r\n                <p className=\"mb-6 text-gray-600 dark:text-gray-400\">La prueba se ha guardado correctamente.</p>\r\n                <div className=\"flex flex-col sm:flex-row justify-center gap-3\">\r\n                  {downloadUrls?.pdf_url && (\r\n                    <a\r\n                      href={downloadUrls.pdf_url.startsWith('http') ? downloadUrls.pdf_url : `${process.env.NEXT_PUBLIC_API_URL || 'https://mentis-production.up.railway.app'}${downloadUrls.pdf_url}`}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                    >\r\n                      <Button className=\"w-full bg-orange-500 hover:bg-orange-600 text-white\">\r\n                        <Download className=\"mr-2 h-4 w-4\" /> Descargar PDF ReportLab\r\n                      </Button>\r\n                    </a>\r\n                  )}\r\n                  <Button variant=\"outline\" onClick={() => router.push('/dashboard/pruebas-trabajo')}>\r\n                    Volver al listado\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          </div>\r\n        )}\r\n\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        {/* Validation Modal                                           */}\r\n        {/* ═══════════════════════════════════════════════════════════ */}\r\n        {showValidationModal && (\r\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n            <Card className=\"w-full max-w-md p-6 bg-white shadow-xl rounded-xl\">\r\n              <div className=\"flex justify-between items-center mb-4 border-b pb-2\">\r\n                <h3 className=\"text-lg font-bold text-gray-900\">Campos Requeridos</h3>\r\n                <button onClick={() => setShowValidationModal(false)} className=\"text-gray-400 hover:text-gray-500\">\r\n                  <X className=\"h-5 w-5\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"bg-red-50 border border-red-200 rounded-md p-4 mb-6\">\r\n                <p className=\"text-red-800 font-semibold flex items-center mb-2\">\r\n                  <AlertCircle className=\"h-5 w-5 mr-2\" /> Por favor complete los siguientes campos:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-sm text-red-700 space-y-1 ml-1\">\r\n                  {validationErrors.map((error, idx) => (<li key={idx}>{error}</li>))}\r\n                </ul>\r\n              </div>\r\n              <div className=\"flex justify-end\">\r\n                <Button onClick={() => setShowValidationModal(false)} className=\"bg-orange-500 hover:bg-orange-600 text-white\">Entendido</Button>\r\n              </div>\r\n            </Card>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\file-upload.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1667,1670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1667,1670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1919,1922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1919,1922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, ChangeEvent } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Upload, X, FileCheck, Loader2, Eye } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { api } from '@/app/services/api';\r\nimport Image from 'next/image';\r\n\r\ninterface FileUploadProps {\r\n  value?: string; // URL del archivo actual\r\n  onChange: (url: string) => void;\r\n  label?: string;\r\n  accept?: string;\r\n  maxSize?: number; // en MB\r\n  preview?: boolean; // Mostrar preview de la imagen\r\n  className?: string;\r\n}\r\n\r\nexport function FileUpload({\r\n  value,\r\n  onChange,\r\n  label = 'Subir archivo',\r\n  accept = 'image/*,.pdf',\r\n  maxSize = 5,\r\n  preview = true,\r\n  className = '',\r\n}: FileUploadProps) {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [previewUrl, setPreviewUrl] = useState<string | null>(value || null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileSelect = async (e: ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validar tamaño\r\n    if (file.size > maxSize * 1024 * 1024) {\r\n      toast.error(`El archivo debe ser menor a ${maxSize} MB`);\r\n      return;\r\n    }\r\n\r\n    // Crear preview local antes de subir\r\n    if (preview && file.type.startsWith('image/')) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setPreviewUrl(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n\r\n    // Subir archivo\r\n    setUploading(true);\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n\r\n      const response: any = await api.postFormData('/uploads/firma', formData);\r\n\r\n      // Actualizar valor con la URL del servidor\r\n      onChange(response.url);\r\n      setPreviewUrl(response.url);\r\n      toast.success('Archivo subido exitosamente');\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Error al subir el archivo');\r\n      setPreviewUrl(null);\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = () => {\r\n    setPreviewUrl(null);\r\n    onChange('');\r\n    if (inputRef.current) {\r\n      inputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  const handleView = () => {\r\n    if (previewUrl) {\r\n      window.open(previewUrl, '_blank');\r\n    }\r\n  };\r\n\r\n  const isImage = previewUrl && (\r\n    previewUrl.endsWith('.png') ||\r\n    previewUrl.endsWith('.jpg') ||\r\n    previewUrl.endsWith('.jpeg') ||\r\n    previewUrl.endsWith('.gif') ||\r\n    previewUrl.endsWith('.webp')\r\n  );\r\n\r\n  return (\r\n    <div className={`space-y-3 ${className}`}>\r\n      {/* Área de preview/upload */}\r\n      <div className=\"border-2 border-dashed border-gray-300 rounded-lg overflow-hidden\">\r\n        {previewUrl ? (\r\n          <div className=\"relative bg-gray-50 min-h-[120px] flex items-center justify-center p-4\">\r\n            {isImage && preview ? (\r\n              <div className=\"relative w-full h-32\">\r\n                <Image\r\n                  src={previewUrl}\r\n                  alt=\"Preview\"\r\n                  fill\r\n                  className=\"object-contain\"\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center gap-3\">\r\n                <FileCheck className=\"h-12 w-12 text-green-500\" />\r\n                <div className=\"text-sm text-gray-600\">\r\n                  <p className=\"font-medium\">Archivo cargado</p>\r\n                  <p className=\"text-xs text-gray-400\">\r\n                    {previewUrl.split('/').pop()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Botones de acción sobre el archivo */}\r\n            <div className=\"absolute top-2 right-2 flex gap-2\">\r\n              <Button\r\n                type=\"button\"\r\n                size=\"icon\"\r\n                variant=\"secondary\"\r\n                className=\"h-8 w-8 bg-white hover:bg-gray-100\"\r\n                onClick={handleView}\r\n              >\r\n                <Eye className=\"h-4 w-4\" />\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                size=\"icon\"\r\n                variant=\"destructive\"\r\n                className=\"h-8 w-8\"\r\n                onClick={handleRemove}\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => inputRef.current?.click()}\r\n            disabled={uploading}\r\n            className=\"w-full p-6 text-center hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {uploading ? (\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <Loader2 className=\"h-8 w-8 text-indigo-500 animate-spin\" />\r\n                <p className=\"text-sm text-gray-500\">Subiendo archivo...</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <Upload className=\"h-8 w-8 text-gray-400\" />\r\n                <p className=\"text-sm text-gray-600 font-medium\">{label}</p>\r\n                <p className=\"text-xs text-gray-400\">\r\n                  Haz clic para seleccionar un archivo\r\n                </p>\r\n                <p className=\"text-xs text-gray-400\">\r\n                  Tamaño máximo: {maxSize} MB\r\n                </p>\r\n              </div>\r\n            )}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Input oculto */}\r\n      <input\r\n        ref={inputRef}\r\n        type=\"file\"\r\n        accept={accept}\r\n        onChange={handleFileSelect}\r\n        className=\"hidden\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\modal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\modal.tsx:20:5\n  18 |\n  19 |   useEffect(() => {\n> 20 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |   }, []);\n  22 |\n  23 |   useEffect(() => {","line":20,"column":5,"nodeType":null,"endLine":20,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { X } from 'lucide-react';\r\nimport { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\ninterface ModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title: string;\r\n  children: React.ReactNode;\r\n  footer?: React.ReactNode;\r\n  size?: 'sm' | 'md' | 'lg' | 'xl';\r\n}\r\n\r\nexport function Modal({ isOpen, onClose, title, children, footer, size = 'md' }: ModalProps) {\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      document.body.style.overflow = 'hidden';\r\n    } else {\r\n      document.body.style.overflow = 'unset';\r\n    }\r\n    return () => {\r\n      document.body.style.overflow = 'unset';\r\n    };\r\n  }, [isOpen]);\r\n\r\n  useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    };\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleEscape);\r\n      return () => document.removeEventListener('keydown', handleEscape);\r\n    }\r\n  }, [isOpen, onClose]);\r\n\r\n  if (!isOpen || !mounted) return null;\r\n\r\n  const sizeClasses = {\r\n    sm: 'max-w-sm',\r\n    md: 'max-w-md',\r\n    lg: 'max-w-lg',\r\n    xl: 'max-w-xl',\r\n  };\r\n\r\n  const modalContent = (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\r\n      {/* Backdrop */}\r\n      <div\r\n        className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      ></div>\r\n\r\n      {/* Modal */}\r\n      <div className={`relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-slate-700 w-full ${sizeClasses[size]} mx-4 max-h-[90vh] overflow-hidden flex flex-col`}>\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-slate-700\">\r\n          <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\r\n            {title}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors\"\r\n          >\r\n            <X className=\"h-5 w-5 text-gray-500 dark:text-gray-400\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <div className=\"flex-1 overflow-y-auto px-6 py-4\">\r\n          {children}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        {footer && (\r\n          <div className=\"px-6 py-4 border-t border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50\">\r\n            {footer}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return createPortal(modalContent, document.body);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\daniel.romero\\OneDrive - GESTAR INNOVACION S.A.S\\Documentos\\william-romero\\frontend\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]